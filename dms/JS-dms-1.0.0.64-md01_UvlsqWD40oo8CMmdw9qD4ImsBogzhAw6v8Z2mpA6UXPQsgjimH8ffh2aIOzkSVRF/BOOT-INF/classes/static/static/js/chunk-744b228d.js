(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-744b228d"],{"10d2":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"device-channel-selector"},[a("a-cascader",{staticStyle:{width:"100%"},attrs:{options:e.processedOptions,placeholder:"请选择设备与通道","field-names":{label:"name",value:"id",children:"children"},disabled:e.disabled,allowClear:!1},on:{change:e.handleChange},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}})],1)},i=[],r=a("3835"),o=a("b85c"),s=a("2909"),c=a("5530"),l=(a("25eb"),a("a9e3"),a("d81d"),a("99af"),a("b0c0"),a("d7b0")),d={name:"DeviceChannelSelector",props:{showAllChannels:{type:Boolean,default:!1},clearOnInit:{type:Boolean,default:!1},flag:{type:Boolean,default:!1},activeKeyFlag:{type:String,default:""}},data:function(){var e=localStorage.getItem("dmsType"),t=3;return"1"!==e&&"2"!==e||(t=Number.parseInt(e,10)),{selectedValue:[],dmsType:t,disabled:!1,loading:!1,options:[]}},created:function(){var e=this;this.loading=!0,Object(l["d"])(this.activeKeyFlag).then((function(t){var a=t.data;e.options=a||[],e.loading=!1})).catch((function(){e.options=[],e.loading=!1}))},computed:{processedOptions:function(){return this.showAllChannels&&0!==this.options.length?this.options.map((function(e){var t={id:"",name:"全部通道"};return Object(c["a"])(Object(c["a"])({},e),{},{children:e.children?[t].concat(Object(s["a"])(e.children)):[]})})):this.options}},watch:{options:{immediate:!0,handler:function(e){e&&e.length>0?this.setDefaultSelection():this.selectedValue=[]}},dmsType:function(){this.setDefaultSelection()}},methods:{findNodeById:function(e,t){var a,n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.id===t)return i;if(i.children&&i.children.length>0){var r=this.findNodeById(i.children,t);if(r)return r}}}catch(s){n.e(s)}finally{n.f()}return null},getChannelInfoByValue:function(e){if(!e||e.length<2)return null;var t=Object(r["a"])(e,2),a=t[0],n=t[1],i=this.findNodeById(this.options,a);if(!i||!i.children)return null;var o=this.findNodeById(i.children,n);return o?{sn:o.sn||"",channelName:o.name||"",channelType:o.channelType||"",deviceNodeName:o.deviceNodeName||"",deviceType:o.deviceType||"",deviceId:a,channelInfoId:n}:null},setDefaultSelection:function(){var e=this;this.loading=!0,this.$nextTick((function(){if(e.clearOnInit)return e.selectedValue=[],void(e.loading=!1);if(0===e.processedOptions.length)return e.selectedValue=[],void(e.loading=!1);var t=e.processedOptions[0];switch(e.dmsType){case 1:e.disabled=!0,t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;case 2:t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;case 3:t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;default:e.selectedValue=[]}if(e.loading=!1,e.selectedValue.length>0){var a=e.getChannelInfoByValue(e.selectedValue);e.$emit("change",e.selectedValue,a)}}))},resetSelection:function(){this.selectedValue=[],this.setDefaultSelection()},clearSelection:function(){this.selectedValue=[]},handleChange:function(e){this.selectedValue=e;var t=this.getChannelInfoByValue(e);this.$emit("change",e,t)},getSelectedValue:function(){return this.selectedValue},getSelectedChannelInfo:function(){return this.getChannelInfoByValue(this.selectedValue)}}},m=d,u=(a("296d"),a("2877")),f=Object(u["a"])(m,n,i,!1,null,"5ab0cc82",null);t["a"]=f.exports},2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a("6b75");function i(e){if(Array.isArray(e))return Object(n["a"])(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var o=a("06c5");a("d9e2");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return i(e)||r(e)||Object(o["a"])(e)||s()}},"296d":function(e,t,a){"use strict";a("e9bd")},3835:function(e,t,a){"use strict";function n(e){if(Array.isArray(e))return e}a.d(t,"a",(function(){return s}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function i(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){s=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(s)throw i}}return r}}var r=a("06c5");a("d9e2");function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){return n(e)||i(e,t)||Object(r["a"])(e,t)||o()}},"43d6":function(e,t,a){},"6d6e":function(e,t,a){},"7af7":function(e,t,a){"use strict";a("6d6e")},"7f25":function(e,t,a){"use strict";a("43d6")},e9bd:function(e,t,a){},f7bb:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",{staticStyle:{"margin-top":"30px"}},[a("div",{staticClass:"search"},[a("div",{staticClass:"title"},[e._v("查询条件")]),a("div",{staticClass:"content"},[a("span",{staticClass:"outer"},[e._v("查询参数:")]),1!=e.dmsType?a("span",{staticClass:"inner"},[a("b-cascader",{ref:"cascaderRef",attrs:{"show-all-channels":!1,"clear-on-init":!1},on:{change:e.cascaderHandler}})],1):e._e(),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入文件名"},model:{value:e.search.fileName,callback:function(t){e.$set(e.search,"fileName",t)},expression:"search.fileName"}})],1),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入事件描述"},model:{value:e.search.detail,callback:function(t){e.$set(e.search,"detail",t)},expression:"search.detail"}})],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.clickSearch}},[e._v("查询")])],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",on:{click:e.resetSearch}},[e._v("重置")])],1)])]),a("div",{staticClass:"body"},[a("div",{staticClass:"buttons"},[a("b-date-range",{attrs:{value:e.dateValue},on:{change:e.dateRangeChange1}}),e.readOnly||"secadmin"!=e.userName?e._e():a("a-button",{attrs:{type:"primary",icon:"export"},on:{click:function(t){return e.exportData()}}},[e._v("批量导出")]),"secadmin"==e.userName?[a("a-button",{attrs:{type:"primary",icon:"delete"},on:{click:e.batchDelete}},[e._v("批量删除")])]:e._e(),a("a-button",{attrs:{type:"primary",icon:"sync"},on:{click:e.clickSearch}},[e._v("刷新")])],2),a("div",{staticClass:"title"},[e._v("查询结果")]),a("a-row",{staticClass:"table"},[a("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[a("span",{staticStyle:{position:"absolute",top:"-25px",left:"12px",color:"#c8c8c8"}},[e.operations.selectedRowKeys.length>0?[e._v(e._s("已选中 "+e.operations.selectedRowKeys.length+" 项"))]:e._e()],2),a("b-fixed-table",{attrs:{columns:e.columns,rowKey:"path",data:e.table.data,total:e.table.total,loading:e.loading,"init-page":e.page,"row-selection":e.rowSelection},on:{change:e.tableParamChanged},scopedSlots:e._u([{key:"time",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertTime")(n.time)))])]}},{key:"operations",fn:function(t){var n=t.record;return[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper"},[a("span",{on:{click:function(t){return e.download(n.path)}}},[e._v("导出")])])]),a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red"},[a("span",{on:{click:function(t){return e.deleteRecord(n.path)}}},[e._v("删除")])])])]}}])})],1)],1)],1)])],1)},i=[],r=(a("b0c0"),a("ac1f"),a("841c"),a("99af"),a("c1df")),o=a.n(r),s=a("e6e5"),c=a("c2f2"),l=a("0618"),d=a("8cff"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.form.init.show?a("div",[a("a-modal",{attrs:{closable:!0,title:e.form.init.title,width:e.form.init.width,footer:"batchDelete"===e.form.name?null:void 0,"mask-closable":!1},model:{value:e.form.init.show,callback:function(t){e.$set(e.form.init,"show",t)},expression:"form.init.show"}},["delete"===e.form.name?a("div",[e._v(" 确定删除？ ")]):"batchDelete"===e.form.name?a("div",[a("div",{staticStyle:{height:"50px","line-height":"50px","font-size":"16px",color:"#0ab1c5"}},[a("span",[e._v(e._s(e.form.init.data.msg))])]),a("a-table",{attrs:{pagination:{pageSize:20,size:"small"},rowKey:"number",columns:e.importColumns,"data-source":e.form.init.data.rows}})],1):"view"===e.form.name?a("a-form-model",{ref:"form",class:{views:"view"===e.form.name},attrs:{model:e.form.init.data,rules:e.form.init.rules,"label-col":{span:e.form.init.labelSpan||6},"wrapper-col":{span:e.form.init.wrapperSpan||18}}},[void 0!==e.form.init.data.sendType?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"下发类型",prop:"sendType"}},[a("span",[e._v(e._s(e.form.init.data.sendType))])]):e._e(),void 0!==e.form.init.data.visitName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"服务名称",prop:"visitName"}},[a("span",[e._v(e._s(e.form.init.data.visitName))])]):e._e(),void 0!==e.form.init.data.deviceName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"设备名称",prop:"deviceName"}},[a("span",[e._v(e._s(e.form.init.data.deviceName))])]):e._e(),void 0!==e.form.init.data.strategyName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"策略名称",prop:"strategyName"}},[a("span",[e._v(e._s(e.form.init.data.strategyName))])]):e._e(),void 0!==e.form.init.data.userName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"下发用户",prop:"userName"}},[a("span",[e._v(e._s(e.form.init.data.userName))])]):e._e(),void 0!==e.form.init.data.state?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"状态",prop:"state"}},[a("span",[e._v(e._s(e.form.init.data.state))])]):e._e(),void 0!==e.form.init.data.errorMsg?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"错误信息",prop:"errorMsg"}},[a("span",[e._v(e._s(e.form.init.data.errorMsg))])]):e._e(),void 0!==e.form.init.data.sendTime?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"下发时间",prop:"sendTime"}},[a("span",[e._v(e._s(e.form.init.data.sendTime))])]):e._e()],1):"export"===e.form.name?a("a-form-model",{attrs:{model:e.form.init.data,rules:e.form.init.rules,"label-col":{span:e.form.init.labelSpan||6},"wrapper-col":{span:e.form.init.wrapperSpan||18}}},[void 0!==e.form.init.data.limit?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"条数",prop:"limit"}},[a("a-input",{staticStyle:{width:"100%"},attrs:{maxLength:10},model:{value:e.form.init.data.limit,callback:function(t){e.$set(e.form.init.data,"limit",t)},expression:"form.init.data.limit"}})],1):e._e()],1):e._e(),a("template",{slot:"footer"},["delete"===e.form.name?a("a-button",{attrs:{type:"primary",loading:e.form.init.confirmLoading},on:{click:function(t){return e.clickSave()}}},[e._v("确定")]):e._e(),"export"===e.form.name?a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportData()}}},[e._v("导出")]):e._e(),a("a-button",{on:{click:function(t){return e.clickCancel()}}},[e._v(e._s("delete"===e.form.name?"取消":"关闭"))])],1)],2)],1):e._e()},u=[],f=(a("00b4"),a("eb60")),h=a("1da1"),p=(a("96cf"),a("b775"));function b(e,t,a,n){return g.apply(this,arguments)}function g(){return g=Object(h["a"])(regeneratorRuntime.mark((function e(t,a,n,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(p["f"])("pcap-log/logs?offset=".concat((t-1)*a,"&limit=").concat(a).concat(n,"&total=").concat(i),p["a"].GET));case 1:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return y=Object(h["a"])(regeneratorRuntime.mark((function e(t){var a,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.path,n=t.deviceId,i=t.channelInfoId,e.abrupt("return",Object(p["f"])("pcap-log/log?path=".concat(a,"&deviceId=").concat(n,"&channelInfoId=").concat(i),p["a"].DELETE));case 2:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function w(e){return I.apply(this,arguments)}function I(){return I=Object(h["a"])(regeneratorRuntime.mark((function e(t){var a,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.paths,n=t.deviceId,i=t.channelInfoId,e.abrupt("return",Object(p["f"])("pcap-log/log/batch-delete?paths=".concat(a,"&deviceId=").concat(n,"&channelInfoId=").concat(i),p["a"].DELETE));case 2:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}var S={name:"AuditSendLogDialog",components:{},mixins:[c["a"]],filters:{},props:{},data:function(){return{zhCN:f["a"],spinning:!1,state:"",params:"",parent:"",form:{delete:{title:"删除",width:420,isDelete:!0,request:v,show:!0,confirmLoading:!1,data:{path:"",deviceId:"",channelInfoId:""},rules:{}},batchDelete:{title:"批量删除",width:700,isDelete:!0,show:!0,data:{msg:"",rows:[]},rules:{}},view:{title:"详情",width:900,request:"",show:!0,data:{sendType:"",haName:"",visitName:"",deviceName:"",strategyName:"",userName:"",state:"",errorMsg:"",sendTime:"",sendContent:"",resultContent:""},rules:{}},export:{title:"导出",width:420,request:"",show:!0,exportUrl:"send-log/export-data",timeRange:[o()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),o()().format("YYYY-MM-DD HH:mm:ss")],ranges:{},data:{startDate:o()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),endDate:o()().format("YYYY-MM-DD HH:mm:ss"),limit:1,offset:0},rules:{}}}}},created:function(){this.showDialog(this.state,this.params)},methods:{beforeShowDialog:function(){},beforeSave:function(){},close:function(){this.form.init.show=!1},disabledDate:function(e){return e>o()().endOf("day")},dateChange:function(e){this.form.init.data.startDate=e[0].format("YYYY-MM-DD HH:mm:ss"),this.form.init.data.endDate=e[1].format("YYYY-MM-DD HH:mm:ss")},exportData:function(){var e=this;if(/^[0-9]+?$/.test(e.form.init.data.limit))if(e.form.init.data.limit>1e4||e.form.init.data.limit<1)e.$message.error("导出条数应在[1~10000]内");else{var t=e.params.search.fieldName,a=e.params.search.search||"",n=e.form.init.data.offset,i=e.form.init.data.limit,r=e.params.search.startDate,o=e.params.search.endDate,s="".concat(e.BASE_URL).concat(e.form.export.exportUrl,"?search=").concat(a,"&fieldName=").concat(t,"&offset=").concat(n,"&limit=").concat(i,"&startDate=").concat(r,"&endDate=").concat(o);window.open(s,"_blank"),this.close()}else this.$message.error("导出条数请输入正整数")},update:function(){var e=this;e.parent.update()}}},_=S,D=(a("7af7"),a("2877")),x=Object(D["a"])(_,m,u,!1,null,"dc8f67d2",null),C=x.exports,N=new d["a"](C),k=a("d9f9"),Y=a("10d2"),O=[{title:"时间",dataIndex:"time"},{title:"文件名称",dataIndex:"name"},{title:"事件描述",dataIndex:"detail"},{title:"大小",dataIndex:"fileSize"},{title:"操作",scopedSlots:{customRender:"operations"}}],T={name:"AuditSendLog",components:{BFixedTable:l["a"],BDateRange:s["a"],BCascader:Y["a"]},mixins:[c["a"]],filters:{convertTime:k["C"]},props:{},data:function(){return{readOnly:!1,columns:O,loading:!1,exportUrl:"obtain-evidence/export-data",dialog:N,tableList:b,batchDeleteUrl:w,userName:"",logCanDeleted:!1,dateValue:[o()().startOf("day"),o()()],search:{deviceId:"",channelInfoId:"",fieldName:"",detail:"",startDate:o()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),endDate:o()().format("YYYY-MM-DD HH:mm:ss")},table:{data:[],total:0}}},created:function(){this.readOnly=JSON.parse(localStorage.getItem("obtain-evidence"))||!1;var e=JSON.parse(localStorage.getItem("app.user"));this.userName=e.name,this.logCanDeleted=e.logCanDeleted},computed:{},mounted:function(){},methods:{moment:o.a,dateRangeChange1:function(e){this.search.startDate=e.dateStrings[0],this.search.endDate=e.dateStrings[1],this.dateValue=e.dateStrings},download:function(e){var t="".concat(this.BASE_URL,"pcap-log/log/download?path=").concat(e,"&deviceId=").concat(this.search.deviceId,"&channelInfoId=").concat(this.search.channelInfoId);window.open(t,"_blank")},deleteRecord:function(e){this.dialog.open({state:"delete",parent:this,params:{path:e,deviceId:this.search.deviceId,channelInfoId:this.search.channelInfoId}})},exports:function(){this.dialog.open({state:"export",parent:this,params:{search:this.search}})},choseFieldName:function(){this.search.search=""},cascaderHandler:function(e){this.search.deviceId=e[0],this.search.channelInfoId=e[1],this.clickSearch()},resetSearch:function(){this.$refs.cascaderRef&&this.$refs.cascaderRef.resetSelection(),this.search.fieldName="",this.search.detail="",this.search.startDate=o()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),this.search.endDate=o()().format("YYYY-MM-DD HH:mm:ss"),this.dateValue=[o()().startOf("day"),o()()],1==this.dmsType&&this.clickSearch()},tableParamChanged:function(e){var t=e.page,a=e.pageSize;this.update(t,a)},update:function(e,t){var a=this;this.page=e||this.page,this.pageSize=t||this.pageSize,this.loading=!0,this.table.total=0,this.table.data=[],this.operations={selectedRowKeys:[],page:1,selectedRows:[],state:!0,loading:!1},this.tableList(this.page,this.pageSize,this.searchParams,this.table.total).then((function(e){var t=e.data;t&&(a.table.total=null==t.total?0:t.total,a.table.data=t.rows),a.loading=!1})).catch((function(){a.loading=!1}))},batchDelete:function(){var e=this,t="".concat(e.operations.selectedRowKeys)||"";if(!t)return e.$message.warn("请选择需要批删除的项！");e.$confirm({content:"确认批量删除吗？",okText:"确认",cancelText:"取消",onOk:function(){e.batchDeleteUrl({paths:t,deviceId:e.search.deviceId,channelInfoId:e.search.channelInfoId}).then((function(t){t.data;var a=t.state,n=t.msg;"SUCCESS"==a?(e.$message.success("批量删除成功！"),e.update(1)):e.$message.error(n)}))},onCancel:function(){}})},exportData:function(){var e=this,t="".concat(e.operations.selectedRowKeys)||"";if(!t)return e.$message.warn("请选择需要导出的项！");var a="".concat(this.BASE_URL,"pcap-log/log/batch-download?paths=").concat(t,"&deviceId=").concat(e.search.deviceId,"&channelInfoId=").concat(e.search.channelInfoId);window.open(a,"_blank")}},watch:{$route:function(e,t){var a=this;t.path!==e.path&&this.$nextTick((function(){a.dialog&&a.dialog.close()}))}},beforeDestroy:function(){this.dialog&&this.dialog.close()}},V=T,R=(a("7f25"),Object(D["a"])(V,n,i,!1,null,"4b0e668c",null));t["default"]=R.exports}}]);