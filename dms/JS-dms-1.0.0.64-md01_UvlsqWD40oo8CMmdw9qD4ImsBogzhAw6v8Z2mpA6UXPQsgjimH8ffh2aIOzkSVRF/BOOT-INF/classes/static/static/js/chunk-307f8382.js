(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-307f8382"],{"4d8c6":function(e,t,a){"use strict";a("69b8")},5624:function(e,t,a){},6485:function(e,t,a){},"69b8":function(e,t,a){},7136:function(e,t,a){},a575:function(e,t,a){"use strict";a("5624")},d301:function(e,t,a){"use strict";a("7136")},da75:function(e,t,a){"use strict";a("6485")},ec3a:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"page-menu"},[a("a-radio-group",{attrs:{value:e.menu},on:{change:e.handleMenuChange}},[e._l(e.menuLists,(function(t,n){return[e.permissionDeviceMenu.includes(t.value)?a("a-radio-button",{key:n,attrs:{value:t.value}},[e._v(e._s(t.menuName))]):e._e()]}))],2)],1),"1"==e.menu?a("BtransDb",{key:"transDb"}):"2"==e.menu?a("BstrategyDb",{key:"strategyDb"}):"3"==e.menu?a("BusinessDbThrid",{key:"BusinessDbThrid"}):e._e()],1)},r=[],i=(a("d3b7"),a("159b"),a("25f0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("bdata-show",{attrs:{columns:e.columns,rowKey:"id",data:e.table.data,total:e.table.total,loading:e.loading,readOnly:e.readOnly,importDataUrl:e.importDataUrl,exportDataUrl:e.exportDataUrl,templateUrl:e.templateUrl,importAndExport:!0,searchs:e.search,activeKeyFlag:"no","init-page":e.page,"init-pageSize":e.pageSize},on:{change:e.tableParamChanged,create:e.openDialog,handleImportChange:e.handleImportChange},scopedSlots:e._u([{key:"search",fn:function(){return[a("div",[a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入资源名称"},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.update}},[e._v("查询")])],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",on:{click:e.resetUpdate}},[e._v("重置")])],1)])]},proxy:!0},{key:"dbType",fn:function(t){var n=t.record;return["dameng"==n.dbType?a("span",{attrs:{title:"达梦"}},[e._v("达梦")]):a("span",{attrs:{title:n.dbType}},[e._v(e._s(n.dbType))])]}},{key:"operations",fn:function(t){var n=t.record;return[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.tranDbView(n.id)}}},[e._v("查看详情")])]),3!=e.user.type?[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.tranDbModify(n.id)}}},[e._v("修改")])]),"true"!=e.readOnly?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red",on:{click:function(t){return e.tranDbDelect(n.id)}}},[e._v("删除")])]):e._e()]:e._e()]}}])}),a("a-modal",{attrs:{title:e.title,closable:!0,"confirm-loading":e.confirmLoading,"mask-closable":!1,footer:"view"===e.dialogType?null:void 0},on:{cancel:e.clickCancel,ok:function(t){return e.saveClick()}},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},["delete"===e.dialogType?a("div",[e._v("确定删除？")]):"create"==e.dialogType||"modify"==e.dialogType||"view"==e.dialogType?a("a-form-model",{ref:"form",attrs:{model:e.form.data,rules:e.form.rules,"label-col":{span:e.form.labelSpan||6},"wrapper-col":{span:e.form.wrapperSpan||18}}},[void 0!==e.form.data.name?a("a-form-model-item",{attrs:{label:"数据库资源名",prop:"name"}},[a("a-input",{attrs:{placeholder:"请输入名称",disabled:"create"!=e.dialogType,maxLength:20},model:{value:e.form.data.name,callback:function(t){e.$set(e.form.data,"name",t)},expression:"form.data.name"}})],1):e._e(),void 0!==e.form.data.dbType?a("a-form-model-item",{attrs:{label:"数据库类型",prop:"dbType"}},[a("a-select",{attrs:{optionFilterProp:"text",disabled:"create"!=e.dialogType},model:{value:e.form.data.dbType,callback:function(t){e.$set(e.form.data,"dbType",t)},expression:"form.data.dbType"}},e._l(e.dbList,(function(t,n){return a("a-select-option",{key:n,attrs:{value:t.value,text:t.name}},[e._v(e._s(t.name))])})),1)],1):e._e(),void 0!==e.form.data.dbIp?a("a-form-model-item",{attrs:{label:"数据库地址",prop:"dbIp"}},[a("a-input",{attrs:{placeholder:"请输入",maxLength:255},model:{value:e.form.data.dbIp,callback:function(t){e.$set(e.form.data,"dbIp",t)},expression:"form.data.dbIp"}})],1):e._e(),void 0!==e.form.data.dbPort?a("a-form-model-item",{attrs:{label:"数据库端口",prop:"dbPort"}},[a("a-input",{staticStyle:{width:"100%"},attrs:{maxLength:10,precision:0,placeholder:"请输入"},model:{value:e.form.data.dbPort,callback:function(t){e.$set(e.form.data,"dbPort",t)},expression:"form.data.dbPort"}})],1):e._e(),void 0!==e.form.data.dbName?a("a-form-model-item",{attrs:{label:"数据库名称",prop:"dbName"}},[a("a-input",{attrs:{placeholder:"请输入数据库名称",maxLength:128},model:{value:e.form.data.dbName,callback:function(t){e.$set(e.form.data,"dbName",t)},expression:"form.data.dbName"}})],1):e._e(),void 0!==e.form.data.userName?a("a-form-model-item",{attrs:{label:"用户名",prop:"userName"}},[a("a-input",{attrs:{placeholder:"请输入用户名",maxLength:128},model:{value:e.form.data.userName,callback:function(t){e.$set(e.form.data,"userName",t)},expression:"form.data.userName"}})],1):e._e(),void 0!==e.form.data.userPwd?a("a-form-model-item",{attrs:{label:"密码",prop:"userPwd"}},[a("a-input-password",{attrs:{placeholder:"请输入密码",maxLength:128},model:{value:e.form.data.userPwd,callback:function(t){e.$set(e.form.data,"userPwd",t)},expression:"form.data.userPwd"}})],1):e._e()],1):e._e()],1),a("a-modal",{attrs:{closable:!0,title:"导入","mask-closable":!1,footer:null},on:{cancel:e.clickCancelImport},model:{value:e.importVisible,callback:function(t){e.importVisible=t},expression:"importVisible"}},[a("div",{staticStyle:{height:"50px","line-height":"50px","font-size":"16px",color:"#0ab1c5"}},[a("span",[e._v(e._s(e.importFailedData.msg))])]),a("a-table",{attrs:{pagination:{pageSize:20,size:"small"},rowKey:"number",columns:e.importColumns,"data-source":e.importFailedData.rows}})],1)],1)}),s=[],o=a("5530"),l=(a("99af"),a("b0c0"),a("ac1f"),a("841c"),a("2f62")),c=a("ba79"),d=a("a00a"),u=a("ca6b"),p=a("b775"),m=a("c2f2"),f=[{title:"数据库资源名",dataIndex:"name"},{title:"数据库类型",scopedSlots:{customRender:"dbType"}},{title:"数据库地址",dataIndex:"dbIp"},{title:"数据库端口",dataIndex:"dbPort"},{title:"用户名",dataIndex:"userName"},{title:"操作",scopedSlots:{customRender:"operations"}}],b="trans-db",v="".concat(c["b"]).concat(b,"/trans-db/import-data"),h="".concat(c["b"]).concat(b,"/trans-db/export-data"),g="single/trans-db.xlsx",y={components:{BdataShow:u["a"]},mixins:[m["a"]],comments:{},props:{},data:function(){return{readOnly:"false",importDataUrl:v,exportDataUrl:h,templateUrl:g,columns:f,page:1,pageSize:10,search:{name:""},table:{data:[],total:0},loading:!1,confirmLoading:!1,importFailedData:{},importVisible:!1,visible:!1,title:"",dialogType:"",dbList:[{value:"dameng",name:"达梦"},{value:"kingbase8",name:"人大金仓"},{value:"Oracle",name:"Oracle"},{value:"MySQL",name:"MySQL"},{value:"SQLServer",name:"SQLServer"},{value:"DB2",name:"DB2"},{value:"Sybase",name:"Sybase"}],form:{data:{id:"",name:"",dbType:"",dbIp:"",dbPort:"",userName:"",userPwd:"",dbName:""},rules:{name:d["a"].name,dbType:d["a"].select,dbIp:d["a"].ip1,dbPort:d["a"].format,userName:d["a"].name,userPwd:d["a"].input,dbName:d["a"].name}}}},filters:{},created:function(){this.readOnly=localStorage.getItem("trans-db")},computed:Object(o["a"])({},Object(l["b"])("account",["user"])),mounted:function(){},methods:{resetUpdate:function(){this.search.name="",this.update()},update:function(){this.page=1,this.pageSize=10,this.uploadList(data.page,data.pageSize,this.search)},tableParamChanged:function(e){this.page=e.page,this.pageSize=e.pageSize,this.uploadList(e.page,e.pageSize,this.search)},uploadList:function(e,t,a){var n=this;this.loading=!0,Object(p["b"])("trans-db/trans-dbs?offset=".concat((e-1)*t,"&limit=").concat(t,"&search=").concat(a.name),p["a"].GET).then((function(e){e.rows.length>0?(n.table.data=e.rows,n.table.total=e.total,n.loading=!1):(n.table.data=[],n.table.total=0,n.loading=!1)})).catch((function(){n.table.data=[],n.table.total=0,n.loading=!1}))},tranDbModify:function(e){var t=this;Object(p["b"])("trans-db/trans-db/".concat(e),p["a"].GET).then((function(e){t.form.data=e})),this.openDialog("modify")},tranDbView:function(e){var t=this;Object(p["b"])("trans-db/trans-db/".concat(e),p["a"].GET).then((function(e){t.form.data=e})),this.openDialog("view")},tranDbDelect:function(e){this.form.data.id=e,this.openDialog("delete")},handleImportChange:function(e){this.importFailedData=e,this.importVisible=!0},clickCancelImport:function(){var e=this;this.importVisible=!1,setTimeout((function(){e.importFailedData={}}),200)},openDialog:function(e){this.dialogType="","create"==e?this.title="新建":"modify"==e?this.title="修改":"view"==e?this.title="查看详情":"delete"==e&&(this.title="删除"),this.dialogType=e,this.visible=!0},saveClick:function(){var e=this;e.confirmLoading=!0;var t=p["a"].POST;"modify"==e.dialogType&&(t=p["a"].PUT),"create"==e.dialogType||"modify"==e.dialogType?e.$refs["form"].validate((function(a){if(!a)return e.confirmLoading=!1,!1;var n=!0;n&&Object(p["b"])("trans-db/trans-db",t,e.form.data).then((function(){e.clickCancel(),e.uploadList(e.page,e.pageSize,e.search)})).catch((function(){e.confirmLoading=!1}))})):"delete"==e.dialogType&&Object(p["b"])("trans-db/trans-db/".concat(e.form.data.id),p["a"].DELETE).then((function(t){t&&(e.clickCancel(),e.uploadList(e.page,e.pageSize,e.search))})).catch((function(){e.confirmLoading=!1}))},clickCancel:function(){this.visible=!1,this.confirmLoading=!1,this.$refs["form"]&&this.$refs["form"].clearValidate(),this.form.data={id:"",name:"",dbType:"",dbIp:"",dbPort:"",userName:"",userPwd:"",dbName:""}}},destroyed:function(){},watch:{},beforeDestroy:function(){}},S=y,D=(a("4d8c6"),a("2877")),T=Object(D["a"])(S,i,s,!1,null,"e6dfb822",null),k=T.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("bdata-show",{attrs:{columns:e.columns,rowKey:"id",data:e.table.data,total:e.table.total,loading:e.loading,readOnly:e.readOnly,searchs:e.search,activeKeyFlag:"no",importDataUrl:e.importDataUrl,exportDataUrl:e.exportDataUrl,templateUrl:e.templateUrl,importAndExport:!0,"init-page":e.page,"init-pageSize":e.pageSize},on:{change:e.tableParamChanged,create:e.openDialog,handleImportChange:e.handleImportChange},scopedSlots:e._u([{key:"search",fn:function(){return[a("div",[a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入策略名称"},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.update}},[e._v("查询")])],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",on:{click:e.resetUpdate}},[e._v("重置")])],1)])]},proxy:!0},{key:"transmitType",fn:function(t){var n=t.record;return["Total"==n.transmitType?a("span",{attrs:{title:"全表更新"}},[e._v("全表更新")]):"Increment"==n.transmitType?a("span",{attrs:{title:"增量更新"}},[e._v("增量更新")]):"Copy"==n.transmitType?a("span",{attrs:{title:"全表复制"}},[e._v("全表复制")]):a("span",[e._v("-")])]}},{key:"transmitOperation",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertTransmitOperation")(n.transmitOperation)))])]}},{key:"conflictStrategy",fn:function(t){var n=t.record;return["1"==n.conflictStrategy?a("span",{attrs:{title:"覆盖"}},[e._v("覆盖")]):"0"==n.conflictStrategy?a("span",{attrs:{title:"不覆盖"}},[e._v("不覆盖")]):a("span",[e._v("-")])]}},{key:"contentCheck",fn:function(t){var n=t.record;return["1"==n.contentCheck?a("span",{attrs:{title:"检查"}},[e._v("检查")]):"0"==n.contentCheck?a("span",{attrs:{title:"不检查"}},[e._v("不检查")]):a("span",[e._v("-")])]}},{key:"securityRank",fn:function(t){var n=t.record;return["1"==n.securityRank?a("span",{attrs:{title:"信息级"}},[e._v("信息级")]):"2"==n.securityRank?a("span",{attrs:{title:"低危级"}},[e._v("低危级")]):"3"==n.securityRank?a("span",{attrs:{title:"中危级"}},[e._v("中危级")]):"4"==n.securityRank?a("span",{attrs:{title:"高危级"}},[e._v("高危级")]):"5"==n.securityRank?a("span",{attrs:{title:"严重级"}},[e._v("严重级")]):a("span",[e._v("-")])]}},{key:"operations",fn:function(t){var n=t.record;return[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.strategyTrDbView(n.id)}}},[e._v("查看详情")])]),3!=e.user.type?["true"!=e.readOnly?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.strategyTrDbModify(n.id)}}},[e._v("修改")])]):e._e(),"true"!=e.readOnly?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red",on:{click:function(t){return e.strategyTrDbDelete(n.id)}}},[e._v("删除")])]):e._e()]:e._e()]}}])}),a("a-modal",{attrs:{title:e.title,closable:!0,"mask-closable":!1,"confirm-loading":e.confirmLoading,footer:"view"===e.dialogType?null:void 0},on:{cancel:e.clickCancel,ok:e.saveClick},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},["delete"===e.dialogType?a("div",[e._v("确定删除？")]):"create"==e.dialogType||"modify"==e.dialogType||"view"==e.dialogType?a("a-form-model",{ref:"form",attrs:{model:e.form.data,rules:e.form.rules,"label-col":{span:e.form.labelSpan||8},"wrapper-col":{span:e.form.wrapperSpan||16}}},[void 0!==e.form.data.name?a("a-form-model-item",{attrs:{label:"策略名称",prop:"name"}},[a("a-input",{attrs:{placeholder:"请输入名称",disabled:"create"!=e.dialogType,maxLength:20},model:{value:e.form.data.name,callback:function(t){e.$set(e.form.data,"name",t)},expression:"form.data.name"}})],1):e._e(),void 0!==e.form.data.transmitType?a("a-form-model-item",{attrs:{label:"同步方式",prop:"transmitType"}},[a("a-select",{on:{change:e.changeTransmitType},model:{value:e.form.data.transmitType,callback:function(t){e.$set(e.form.data,"transmitType",t)},expression:"form.data.transmitType"}},[a("a-select-option",{attrs:{value:""}},[e._v("请选择")]),a("a-select-option",{attrs:{value:"Copy"}},[e._v("全表复制")]),a("a-select-option",{attrs:{value:"Increment"}},[e._v("增量更新")]),a("a-select-option",{attrs:{value:"Total"}},[e._v("全表更新")])],1)],1):e._e(),void 0!==e.form.data.transmitOperation?a("a-form-model-item",{attrs:{label:"同步操作",prop:"transmitOperation"}},[a("a-checkbox-group",{attrs:{name:"checkboxgroup",disabled:"Total"!=e.form.data.transmitType,options:e.transmitList},on:{change:e.changeOperation},model:{value:e.form.data.transmitOperation,callback:function(t){e.$set(e.form.data,"transmitOperation",t)},expression:"form.data.transmitOperation"}})],1):e._e(),void 0!==e.form.data.contentCheck?a("a-form-model-item",{attrs:{label:"内容完整性检查",prop:"contentCheck"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:e.form.data.contentCheck,callback:function(t){e.$set(e.form.data,"contentCheck",t)},expression:"form.data.contentCheck"}},[a("a-select-option",{attrs:{value:1}},[e._v("检查")]),a("a-select-option",{attrs:{value:0}},[e._v("不检查")])],1)],1):e._e(),void 0!==e.form.data.securityRank?a("a-form-model-item",{attrs:{label:"威胁安全等级",prop:"securityRank"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:e.form.data.securityRank,callback:function(t){e.$set(e.form.data,"securityRank",t)},expression:"form.data.securityRank"}},[a("a-select-option",{attrs:{value:1}},[e._v("信息级")]),a("a-select-option",{attrs:{value:2}},[e._v("低危级")]),a("a-select-option",{attrs:{value:3}},[e._v("中危级")]),a("a-select-option",{attrs:{value:4}},[e._v("高危级")]),a("a-select-option",{attrs:{value:5}},[e._v("严重级")])],1)],1):e._e()],1):e._e()],1),a("a-modal",{attrs:{closable:!0,title:"导入","mask-closable":!1,footer:null},on:{cancel:e.clickCancelImport},model:{value:e.importVisible,callback:function(t){e.importVisible=t},expression:"importVisible"}},[a("div",{staticStyle:{height:"50px","line-height":"50px","font-size":"16px",color:"#0ab1c5"}},[a("span",[e._v(e._s(e.importFailedData.msg))])]),a("a-table",{attrs:{pagination:{pageSize:20,size:"small"},rowKey:"number",columns:e.importColumns,"data-source":e.importFailedData.rows}})],1)],1)},w=[],_=(a("a15b"),a("1276"),a("e9c4"),a("d9f9")),I=[{title:"策略名称",dataIndex:"name"},{title:"同步方式",scopedSlots:{customRender:"transmitType"}},{title:"同步操作",scopedSlots:{customRender:"transmitOperation"}},{title:"内容完整性检查",scopedSlots:{customRender:"contentCheck"}},{title:"威胁安全等级",scopedSlots:{customRender:"securityRank"}},{title:"操作",scopedSlots:{customRender:"operations"}}],O="strategy",L="".concat(c["b"]).concat(O,"/strategy-db/import-data"),R="".concat(c["b"]).concat(O,"/strategy-db/export-data"),C="single/strategy-db.xlsx",N={components:{BdataShow:u["a"]},mixins:[m["a"]],comments:{},props:{},data:function(){return{readOnly:!1,importFailedData:{},importVisible:!1,confirmLoading:!1,transmitList:[{value:"Insert",label:"插入"},{value:"Update",label:"更新"},{value:"Delete",label:"删除"}],matchTypeList:[{id:1,name:"忽略大小写"},{id:2,name:"包含换行符"},{id:3,name:"多行锚定"},{id:4,name:"仅匹配模式"},{id:5,name:"逻辑组合"}],importDataUrl:L,exportDataUrl:R,templateUrl:C,columns:I,page:1,pageSize:10,search:{name:""},table:{data:[],total:0},loading:!1,visible:!1,title:"",dialogType:"",form:{data:{id:"",type:"",name:"",transmitType:"",transmitOperation:[],operationName:"",securityRank:1,conflictStrategy:1,contentCheck:1},rules:{name:d["a"].name,transmitType:d["a"].select,securityRank:d["a"].select,contentCheck:d["a"].select,conflictStrategy:d["a"].select,transmitOperation:d["a"].select}}}},filters:{convertSecurityRank:_["x"],convertCodeFormatState:_["h"],convertCommand:_["i"],convertStrategyList:_["A"],convertMatchType:_["u"],convertExecAction:_["n"],convertTransmitOperation:_["E"]},created:function(){},watch:{},mounted:function(){},computed:Object(o["a"])({},Object(l["b"])("account",["user"])),methods:{resetUpdate:function(){this.search.name="",this.update()},update:function(){this.page=1,this.pageSize=10,this.uploadList(data.page,data.pageSize,this.search)},tableParamChanged:function(e){this.page=e.page,this.pageSize=e.pageSize,this.uploadList(e.page,e.pageSize,this.search)},uploadList:function(e,t,a){var n=this;this.loading=!0,Object(p["b"])("strategy/strategy-dbs?offset=".concat((e-1)*t,"&limit=").concat(t,"&search=").concat(a.name),p["a"].GET).then((function(e){e.rows.length>0?(n.table.data=e.rows,n.table.total=e.total,n.loading=!1):(n.table.data=[],n.table.total=0,n.loading=!1)})).catch((function(){n.table.data=[],n.table.total=0,n.loading=!1}))},initMenu:function(){this.columns=dbSenderColumns,this.uploadList(this.page,this.pageSize,this.search)},handleImportChange:function(e){this.importFailedData=e,this.importVisible=!0},clickCancelImport:function(){var e=this;this.importVisible=!1,setTimeout((function(){e.importFailedData={}}),200)},openDialog:function(e){this.dialogType="","create"==e?this.title="新建":"modify"==e?this.title="修改":"delete"==e?this.title="删除":"view"==e&&(this.title="查看详情"),this.dialogType=e,this.visible=!0},changeTransmitType:function(e){"Copy"==e?(this.form.data.transmitOperation=["Insert","Update","Delete"],this.form.data.operationName="插入;更新;删除"):"Increment"==e?(this.form.data.transmitOperation=["Insert"],this.form.data.operationName="插入"):this.form.data.transmitOperation=[]},changeOperation:function(e){var t=this;if(this.form.data.transmitOperation=e||[],e.length<1)this.form.data.operationName="";else{var a=[];e.forEach((function(e){t.transmitList.forEach((function(t){t.value==e&&a.push(t.label)}))})),this.form.data.operationName=a.join(",")}this.$forceUpdate()},strategyTrDbDelete:function(e){this.form.data.id=e,this.openDialog("delete")},strategyTrDbView:function(e){var t=this;Object(p["b"])("strategy/strategy-db/".concat(e),p["a"].GET).then((function(e){t.form.data=e,""==t.form.data.transmitOperation?t.form.data.transmitOperation=[]:t.form.data.transmitOperation=t.form.data.transmitOperation.split(",")})),this.openDialog("view")},strategyTrDbModify:function(e){var t=this;t.$confirm({content:"如当前策略已与已下发的服务关联，保存后将自动下发，确定修改？",okText:"确认",cancelText:"取消",onOk:function(){Object(p["b"])("strategy/strategy-db/".concat(e),p["a"].GET).then((function(e){t.form.data=e,""==t.form.data.transmitOperation?t.form.data.transmitOperation=[]:t.form.data.transmitOperation=t.form.data.transmitOperation.split(",")})),t.openDialog("modify")},onCancel:function(){}})},saveClick:function(){var e=this;e.confirmLoading=!0;var t=p["a"].POST;"modify"==e.dialogType&&(t=p["a"].PUT),"create"==e.dialogType||"modify"==e.dialogType?(e.form.data.conflictStrategy=null,e.$refs["form"].validate((function(a){if(!a)return e.confirmLoading=!1,!1;var n=!0;if(n){var r=JSON.parse(JSON.stringify(e.form.data));r.transmitOperation=r.transmitOperation.toString(),Object(p["b"])("strategy/strategy-db",t,r).then((function(){e.clickCancel(),e.uploadList(e.page,e.pageSize,e.search)})).catch((function(){e.confirmLoading=!1}))}}))):"delete"==e.dialogType&&Object(p["b"])("strategy/strategy-db/".concat(e.form.data.id),p["a"].DELETE).then((function(){e.clickCancel(),e.uploadList(e.page,e.pageSize,e.search)})).catch((function(){e.confirmLoading=!1}))},clickCancel:function(){this.visible=!1,this.confirmLoading=!1,"modify"!=this.dialogType&&"create"!=this.dialogType||this.$refs["form"].clearValidate(),this.form.data={id:"",type:"",name:"",transmitType:"",transmitOperation:[],operationName:"",securityRank:1,conflictStrategy:1,contentCheck:1}}},destroyed:function(){},beforeDestroy:function(){}},F=N,j=(a("da75"),Object(D["a"])(F,x,w,!1,null,"4a0b7bee",null)),$=j.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("bdata-show",{attrs:{columns:e.columns,rowKey:"id",data:e.table.data,total:e.table.total,"init-page":e.page,"init-pageSize":e.pageSize,depatch:!0,readOnly:e.readOnly,loading:e.loading,importAndExport:!1,approver:!0,needDeviece:!0,activeKeyFlag:"no",searchs:e.search,linkState:!0},on:{batchDispatch:e.batchDispatch,batchDelete:e.batchDelete,batchRemove:e.batchRemove,batchDispatchApproval:e.batchDispatchApproval,batchRemoveApproval:e.batchRemoveApproval,linkDetection:e.linkDetection,change:e.tableParamChanged,create:e.openDialog},scopedSlots:e._u([{key:"search",fn:function(){return[a("div",[1!=e.dmsType?a("span",{staticClass:"inner"},[a("b-cascader",{ref:"cascaderRef",attrs:{"show-all-channels":!0,"clear-on-init":!0},on:{change:e.cascaderHandler}})],1):e._e(),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入服务名称"},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入服务ID"},model:{value:e.search.businessId,callback:function(t){e.$set(e.search,"businessId",t)},expression:"search.businessId"}})],1),a("span",{staticClass:"inner"},[a("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择位置"},model:{value:e.search.type,callback:function(t){e.$set(e.search,"type",t)},expression:"search.type"}},[a("a-select-option",{attrs:{value:"sender"}},[e._v("发送端")]),a("a-select-option",{attrs:{value:"receiver"}},[e._v("接收端")])],1)],1),a("span",{staticClass:"inner"},[a("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择数据库类型"},model:{value:e.search.transmitModel,callback:function(t){e.$set(e.search,"transmitModel",t)},expression:"search.transmitModel"}},[a("a-select-option",{attrs:{value:"dameng"}},[e._v("达梦")]),a("a-select-option",{attrs:{value:"kingbase8"}},[e._v("人大金仓")]),a("a-select-option",{attrs:{value:"Oracle"}},[e._v("Oracle")]),a("a-select-option",{attrs:{value:"MySQL"}},[e._v("MySQL")]),a("a-select-option",{attrs:{value:"SQLServer"}},[e._v("SQLServer")]),a("a-select-option",{attrs:{value:"DB2"}},[e._v("DB2")]),a("a-select-option",{attrs:{value:"Sybase"}},[e._v("Sybase")])],1)],1),a("span",{staticClass:"inner"},[a("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择下发状态"},model:{value:e.search.workState,callback:function(t){e.$set(e.search,"workState",t)},expression:"search.workState"}},[a("a-select-option",{attrs:{value:"-1"}},[e._v("未下发")]),a("a-select-option",{attrs:{value:"1"}},[e._v("已下发")]),a("a-select-option",{attrs:{value:"2"}},[e._v("未生效")]),a("a-select-option",{attrs:{value:"3"}},[e._v("已生效")]),a("a-select-option",{attrs:{value:"4"}},[e._v("已移除")]),a("a-select-option",{attrs:{value:"11"}},[e._v("下发失败")]),a("a-select-option",{attrs:{value:"12"}},[e._v("移除失败")])],1)],1),a("span",{staticClass:"inner"},[a("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择审批状态"},model:{value:e.search.approvalState,callback:function(t){e.$set(e.search,"approvalState",t)},expression:"search.approvalState"}},[a("a-select-option",{attrs:{value:"5"}},[e._v("下发审批中")]),a("a-select-option",{attrs:{value:"6"}},[e._v("下发审批不通过")]),a("a-select-option",{attrs:{value:"7"}},[e._v("下发审批通过")]),a("a-select-option",{attrs:{value:"8"}},[e._v("移除审批中")]),a("a-select-option",{attrs:{value:"9"}},[e._v("移除审批不通过")]),a("a-select-option",{attrs:{value:"10"}},[e._v("移除审批通过")]),a("a-select-option",{attrs:{value:"13"}},[e._v("未审批")]),a("a-select-option",{attrs:{value:"14"}},[e._v("申请下发撤回")]),a("a-select-option",{attrs:{value:"15"}},[e._v("申请移除撤回")])],1)],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.update}},[e._v("查询")])],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",on:{click:e.resetUpdate}},[e._v("重置")])],1)])]},proxy:!0},{key:"workState",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertWorkState")(n.workState)))])]}},{key:"businessId",fn:function(t){var n=t.record;return["sender"==n.type?a("span",[e._v(e._s(n.id))]):e._e(),"receiver"==n.type?a("span",[e._v(e._s(n.businessId))]):e._e()]}},{key:"approvalState",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertWorkState")(n.approvalState)))])]}},{key:"deleting",fn:function(t){var n=t.record;return[0==n.deleting?a("span",{staticStyle:{color:"#47b596"}},[e._v("正常")]):a("span",{staticClass:"oper red"},[e._v("删除中")])]}},{key:"operations",fn:function(t){var n=t.record;return[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbView(n.id)}}},[e._v("查看详情")])]),3==e.user.type?[5==n.approvalState||8==n.approvalState?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessApproval(n)}}},[e._v("审批")])]):e._e(),a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.showApprovalOpinion(n.id)}}},[e._v("审批意见")])])]:[e.readOnly||0!=n.deleting?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbConnect(n.id)}}},[e._v("服务测试")])]),e.readOnly?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.showApprovalOpinion(n.id)}}},[e._v("审批意见")])]),e.readOnly||0!=n.deleting||"sender"!=n.type?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbTransmit(n.id)}}},[e._v("传输配置")])]),"-1"==n.workState&&(13==n.approvalState||6==n.approvalState||7==n.approvalState||10==n.approvalState||14==n.approvalState)||(1==n.workState||2==n.workState)&&7==n.approvalState?[e.readOnly?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbDispatch(n.id)}}},[e._v("申请下发")])])]:e._e(),"-1"==n.workState&&5==n.approvalState||3==n.workState&&8==n.approvalState?[e.readOnly?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbRevoke(n.id)}}},[e._v("撤回")])])]:e._e(),3!=n.workState||7!=n.approvalState&&9!=n.approvalState&&10!=n.approvalState&&15!=n.approvalState?e._e():[e.readOnly?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbMove(n.id)}}},[e._v("申请移除")])])],e.readOnly||0!=n.deleting||"sender"!=n.type?e._e():a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbManual(n)}}},[e._v("手动同步")])]),"-1"==n.workState&&(13==n.approvalState||6==n.approvalState||7==n.approvalState||10==n.approvalState||14==n.approvalState)||2==n.workState&&7==n.approvalState?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(t){return e.businessTransDbModify(n)}}},[e._v("修改")])]):e._e(),"-1"==n.workState&&(13==n.approvalState||6==n.approvalState||7==n.approvalState||10==n.approvalState||14==n.approvalState)||2==n.workState&&7==n.approvalState?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red",on:{click:function(t){return e.businessTransDbDelete(n)}}},[e._v("删除")])]):e._e()]]}}])}),a("a-modal",{attrs:{width:e.getDialogWidth,closable:!0,title:e.title,"mask-closable":!1,"confirm-loading":e.confirmLoading,footer:"view"==e.dialogType?null:void 0},on:{cancel:e.closeDialog,ok:e.handleSave},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-spin",{attrs:{spinning:e.spinning}},[e.isSimpleDialog?a("div",["delete"==e.dialogType?a("div",[e._v("确定删除？")]):"dispatch"==e.dialogType?a("div",[e._v("确定申请下发？")]):"retract"==e.dialogType?a("div",[e._v("确定撤回？")]):"remove"==e.dialogType?a("div",[e._v("确定申请移除？")]):"manual"==e.dialogType?a("div",[e._v("确定手动同步？")]):"config"==e.dialogType?a("div",[e._v("此操作将发送端配置信息发送到接收端服务,确定传输配置？")]):e._e()]):a("a-form-model",{ref:"form",attrs:{model:e.form.data,rules:e.form.rules,"label-col":{span:8},"wrapper-col":{span:16}}},[a("a-form-model",{ref:"form",attrs:{model:e.form.data,rules:e.form.rules,"label-col":{span:8},"wrapper-col":{span:16}}},[a("a-row",{attrs:{gutter:8}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"位置",prop:"type"}},[a("a-select",{attrs:{placeholder:"请选择",disabled:"create"!=e.dialogType||1==e.form.data.channelType},on:{change:e.choseType},model:{value:e.form.data.type,callback:function(t){e.$set(e.form.data,"type",t)},expression:"form.data.type"}},[a("a-select-option",{attrs:{value:"sender"}},[e._v("发送端")]),a("a-select-option",{attrs:{value:"receiver"}},[e._v("接收端")])],1)],1)],1),"receiver"==e.form.data.type?a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"源端服务",prop:"businessId"}},[a("a-select",{attrs:{disabled:"create"!=e.dialogType,"option-label-prop":"label"},on:{change:e.choseBusiness},model:{value:e.form.data.businessId,callback:function(t){e.$set(e.form.data,"businessId",t)},expression:"form.data.businessId"}},e._l(e.selectOptions.dbReceiverList,(function(t){return a("a-select-option",{key:t.businessId,attrs:{value:t.businessId,label:t.name}},[e._v(" "+e._s(t.name)+" "),t.businessId&&e.form.data.businessId!=t.businessId?a("a-icon",{staticStyle:{position:"absolute",top:"30%",right:"10%"},attrs:{type:"delete"},on:{click:function(a){return a.stopPropagation(),e.deleteDbItem(t.businessId)}}}):e._e()],1)})),1)],1)],1):a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"服务名称",prop:"name",rules:e.nameRule}},[a("a-input",{attrs:{placeholder:"请输入",disabled:"modify"==e.dialogType||""==e.form.data.type,maxLength:20},model:{value:e.form.data.name,callback:function(t){e.$set(e.form.data,"name",t)},expression:"form.data.name"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"数据库资源名",prop:"transmitDbId"}},[a("a-select",{attrs:{disabled:"modify"==e.dialogType,placeholder:"请选择"},on:{change:e.choseDbName},model:{value:e.form.data.transmitDbId,callback:function(t){e.$set(e.form.data,"transmitDbId",t)},expression:"form.data.transmitDbId"}},e._l(e.selectOptions.dbList,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"业务用户",prop:"createUser"}},[a("a-input",{attrs:{placeholder:"请输入业务用户",disabled:"modify"==e.dialogType},model:{value:e.form.data.createUser,callback:function(t){e.$set(e.form.data,"createUser",t)},expression:"form.data.createUser"}})],1)],1)],1),a("div",{staticClass:"section-title"},[e._v("数据库资源信息")]),a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{span:24}},[a("a-row",{staticClass:"inner-block",staticStyle:{padding:"8px 10px 0 10px"}},[a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"IP地址"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbInfoList.dbIp,callback:function(t){e.$set(e.dbInfoList,"dbIp",t)},expression:"dbInfoList.dbIp"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"端口"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbInfoList.dbPort,callback:function(t){e.$set(e.dbInfoList,"dbPort",t)},expression:"dbInfoList.dbPort"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"数据库名"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbInfoList.dbName,callback:function(t){e.$set(e.dbInfoList,"dbName",t)},expression:"dbInfoList.dbName"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"用户名"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbInfoList.userName,callback:function(t){e.$set(e.dbInfoList,"userName",t)},expression:"dbInfoList.userName"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"密码"}},[a("a-input-password",{attrs:{disabled:""},model:{value:e.dbInfoList.userPwd,callback:function(t){e.$set(e.dbInfoList,"userPwd",t)},expression:"dbInfoList.userPwd"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"数据库类型"}},[a("a-input",{attrs:{disabled:""},model:{value:e.form.data.dbType,callback:function(t){e.$set(e.form.data,"dbType",t)},expression:"form.data.dbType"}})],1)],1)],1)],1)],1),a("div",{staticClass:"section-title"},[e._v("单向数据库同步配置")]),a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{span:24}},[a("a-row",{staticClass:"inner-block",staticStyle:{padding:"8px 10px 0 10px"}},[a("div",{staticClass:"sub-section-title"},[e._v("同步服务配置")]),a("a-row",{staticClass:"inner-block",attrs:{gutter:15}},[a("a-col",{attrs:{span:24}},[a("a-row",{staticStyle:{padding:"8px 10px 0 10px"}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"设备",prop:"deviceId"}},[a("a-select",{attrs:{"show-search":!0,"filter-option":e.filterOption,disabled:""},model:{value:e.form.data.deviceId,callback:function(t){e.$set(e.form.data,"deviceId",t)},expression:"form.data.deviceId"}},e._l(e.selectOptions.deviceList,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),8==e.form.data.deviceType?a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"通道",prop:"deviceId"}},[a("a-select",{attrs:{"show-search":!0,"filter-option":e.filterOption,disabled:"",placeholder:"请选择"},model:{value:e.form.data.channelInfoId,callback:function(t){e.$set(e.form.data,"channelInfoId",t)},expression:"form.data.channelInfoId"}},e._l(e.selectOptions.channelList,(function(t,n){return a("a-select-option",{key:n,attrs:{text:t.name,value:t.id}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1):e._e()],1),"sender"==e.form.data.type?a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"数据库同步策略",prop:"strategyId"}},[a("a-select",{attrs:{"show-search":!0,disabled:"modify"==e.dialogType,"filter-option":e.filterOption},on:{change:e.choseDbStrategy},model:{value:e.form.data.strategyId,callback:function(t){e.$set(e.form.data,"strategyId",t)},expression:"form.data.strategyId"}},e._l(e.selectOptions.strategyDbList,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"延迟同步时间(s)",prop:"delaySync",rules:e.format17}},[a("a-input",{attrs:{placeholder:"请输入",maxLength:4},model:{value:e.form.data.delaySync,callback:function(t){e.$set(e.form.data,"delaySync",t)},expression:"form.data.delaySync"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"调度时间",prop:"businessTimeId"}},[a("a-select",{attrs:{"show-search":!0,"filter-option":e.filterOption},model:{value:e.form.data.businessTimeId,callback:function(t){e.$set(e.form.data,"businessTimeId",t)},expression:"form.data.businessTimeId"}},e._l(e.selectOptions.timeList,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"流量控制(条/s)",prop:"maxFlow"}},[a("a-input",{attrs:{placeholder:"输入0表示不限速",maxLength:4},model:{value:e.form.data.maxFlow,callback:function(t){e.$set(e.form.data,"maxFlow",t)},expression:"form.data.maxFlow"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"启用",prop:"virus"}},[a("a-checkbox",{model:{value:e.form.data.virus,callback:function(t){e.$set(e.form.data,"virus",t)},expression:"form.data.virus"}},[e._v("病毒防护")])],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"关键字",prop:"keywords1"}},[a("LazyLoadingMultipleSelect",{attrs:{value:e.form.data.keywords1,strategyData:e.contentStrategiesList,mode:"multiple",dialogType:e.dialogType,"max-tag-count":2,"option-key":"id",placeholder:"请选择"},on:{change:e.handleKeywordsChange}})],1)],1)],1):e._e()],1)],1),"sender"==e.form.data.type?a("div",{staticClass:"sub-section-title"},[e._v("同步策略详情")]):e._e(),"sender"==e.form.data.type?a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{span:24}},[a("a-row",{staticClass:"inner-block",staticStyle:{padding:"8px 10px 0 10px"}},[a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"同步方式"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbStrategyList.transmitTypeName,callback:function(t){e.$set(e.dbStrategyList,"transmitTypeName",t)},expression:"dbStrategyList.transmitTypeName"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"同步操作"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbStrategyList.operationName,callback:function(t){e.$set(e.dbStrategyList,"operationName",t)},expression:"dbStrategyList.operationName"}})],1)],1),a("a-col",{attrs:{span:8}},[a("a-form-model-item",{attrs:{label:"内容完整性检查"}},[a("a-input",{attrs:{disabled:""},model:{value:e.dbStrategyList.contentCheckName,callback:function(t){e.$set(e.dbStrategyList,"contentCheckName",t)},expression:"dbStrategyList.contentCheckName"}})],1)],1)],1)],1)],1):e._e(),"sender"==e.form.data.type?a("div",{staticClass:"sub-section-title"},[e._v("源表选择")]):e._e(),"sender"==e.form.data.type?a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{span:24}},[a("a-row",{staticClass:"inner-block",staticStyle:{padding:"8px 10px 0 10px"}},[a("div",{staticClass:"tableClass"},[a("a-table",{attrs:{"row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},pagination:!1,rowKey:"name",columns:e.tableColumns1,"data-source":e.tabledata},scopedSlots:e._u([{key:"operations",fn:function(t){return[a("a-button",{attrs:{type:"primary"},on:{click:function(a){return e.choseWord(t.name)}}},[e._v("字段选择")])]}}],null,!1,449179350)})],1)])],1)],1):e._e(),"receiver"==e.form.data.type?a("div",{staticClass:"sub-section-title"},[e._v("源表选择")]):e._e(),"receiver"==e.form.data.type?a("a-row",{attrs:{gutter:15}},[a("a-col",{attrs:{span:24}},[a("a-row",{staticClass:"inner-block",staticStyle:{padding:"8px 10px 8px 10px"}},[a("div",{staticClass:"receiverTable"},[a("a-table",{attrs:{pagination:!1,columns:e.tableColumns2,rowKey:"sourceTableName","data-source":e.dbTableData,bordered:""},scopedSlots:e._u([{key:"destTableName",fn:function(t){return[a("a-select",{attrs:{optionFilterProp:"text",showSearch:!0},on:{change:function(a){return e.choseFristDesName(t)}},model:{value:t.destTableName,callback:function(a){e.$set(t,"destTableName",a)},expression:"a.destTableName"}},e._l(e.selectOptions.DesList,(function(t){return a("a-select-option",{key:t.name,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)]}},{key:"operations",fn:function(t){return[a("a-button",{attrs:{type:"primary"},on:{click:function(a){return e.choseWord1(t)}}},[e._v("字段选择")])]}}],null,!1,3652562612)})],1)])],1)],1):e._e()],1)],1)],1)],1)],1)],1)],1),a("a-modal",{attrs:{closable:!0,width:"sender"==e.form.data.type?"70%":"95%",title:"字段选择","mask-closable":!1},on:{cancel:e.closeFieldDialog,ok:e.saveFieldSelection},model:{value:e.visibleSecond,callback:function(t){e.visibleSecond=t},expression:"visibleSecond"}},[a("div",{staticClass:"inner-block",staticStyle:{padding:"8px 10px 0 10px"}},["sender"==e.form.data.type?a("div",[a("a-textarea",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"请输入过滤字",rows:2},model:{value:e.filterField,callback:function(t){e.filterField=t},expression:"filterField"}}),a("a-table",{staticClass:"AStockOutDetailTable",attrs:{size:"small","row-selection":{selectedRowKeys:e.selectedRowKeys1,onChange:e.onSelectChange1},pagination:!1,columns:e.fieldSenderColumns,rowKey:"FieldName","data-source":e.innerTableData,bordered:""},scopedSlots:e._u([{key:"FieldPrimary",fn:function(t){return[a("a-select",{staticStyle:{width:"100%"},model:{value:t.FieldPrimary,callback:function(a){e.$set(t,"FieldPrimary",a)},expression:"a.FieldPrimary"}},[a("a-select-option",{attrs:{value:"0"}},[e._v("否")]),a("a-select-option",{attrs:{value:"1"}},[e._v("是")])],1)]}},{key:"FieldIncrement",fn:function(t){return[a("a-select",{staticStyle:{width:"100%"},model:{value:t.FieldIncrement,callback:function(a){e.$set(t,"FieldIncrement",a)},expression:"a.FieldIncrement"}},[a("a-select-option",{attrs:{value:"0"}},[e._v("否")]),a("a-select-option",{attrs:{value:"1"}},[e._v("是")])],1)]}},{key:"NullField",fn:function(t){return["N"==t.NullField?a("span",[e._v("否")]):a("span",[e._v("是")])]}},{key:"UniqueField",fn:function(t){return["Y"==t.UniqueField?a("span",[e._v("唯一")]):a("span",[e._v("不唯一")])]}}],null,!1,788725626)})],1):"receiver"==e.form.data.type?a("div",[a("a-table",{staticClass:"AStockOutDetailTable",attrs:{size:"small",pagination:!1,columns:e.fieldReceiverColumns,rowKey:"SField","data-source":e.innerTableData,bordered:""},scopedSlots:e._u([{key:"SPrimary",fn:function(t){return["1"==t.SPrimary?a("span",[e._v("主键")]):e._e()]}},{key:"DPrimary",fn:function(t){return["1"==t.DPrimary?a("span",[e._v("主键")]):e._e()]}},{key:"SIncrement",fn:function(t){return["1"==t.SIncrement?a("span",[e._v("增量字段")]):e._e()]}},{key:"DIncrement",fn:function(t){return["1"==t.DIncrement?a("span",[e._v("增量字段")]):e._e()]}},{key:"SNullField",fn:function(t){return["N"==t.SNullField?a("span",[e._v("否")]):a("span",[e._v("是")])]}},{key:"DNullField",fn:function(t){return["N"==t.DNullField?a("span",[e._v("否")]):a("span",[e._v("是")])]}},{key:"SUniqueField",fn:function(t){return["Y"==t.SUniqueField?a("span",[e._v("唯一")]):a("span",[e._v("不唯一")])]}},{key:"DUniqueField",fn:function(t){return["Y"==t.DUniqueField?a("span",[e._v("唯一")]):a("span",[e._v("不唯一")])]}},{key:"DField",fn:function(t){return[a("a-select",{staticStyle:{width:"100%"},attrs:{optionFilterProp:"text",showSearch:!0},on:{change:function(a){return e.choseDesName(t)}},model:{value:t.DField,callback:function(a){e.$set(t,"DField",a)},expression:"a.DField"}},e._l(e.innerDesNameList,(function(t){return a("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)]}}])})],1):e._e()])]),a("a-modal",{attrs:{closable:!0,width:500,title:e.testTitle,"mask-closable":!1,footer:null},on:{cancel:e.cancelTest},model:{value:e.visibleTest,callback:function(t){e.visibleTest=t},expression:"visibleTest"}},["服务测试"==e.testTitle?a("div",[a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",[e._v("服务名称:")]),null!=e.testData.name&&""!=e.testData.name?a("span",{staticStyle:{"margin-left":"50px"}},[e._v(e._s(e.testData.name))]):a("span",{staticStyle:{"margin-left":"50px"}},[e._v("请求中")])]),a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",[e._v("数据库连接状态:")]),null!=e.testData.connectStatus&&""!=e.testData.connectStatus?a("span",{staticStyle:{"margin-left":"50px"}},[e._v(" "+e._s(e.testData.connectStatus)+" ")]):a("span",{staticStyle:{"margin-left":"50px"}},[e._v("请求中")])]),a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",[e._v("表存在状态:")]),null!=e.testData.tableExist&&""!=e.testData.tableExist?a("span",{staticStyle:{"margin-left":"50px"}},[e._v(" "+e._s(e.testData.tableExist)+" ")]):a("span",{staticStyle:{"margin-left":"50px"}},[e._v("请求中")])]),a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",[e._v("字段存在状态:")]),null!=e.testData.fieldExist&&""!=e.testData.fieldExist?a("span",{staticStyle:{"margin-left":"50px"}},[e._v(" "+e._s(e.testData.fieldExist)+" ")]):a("span",{staticStyle:{"margin-left":"50px"}},[e._v("请求中")])]),a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",[e._v("权限状态:")]),null!=e.testData.competence&&""!=e.testData.competence?a("span",{staticStyle:{"margin-left":"50px"}},[e._v(" "+e._s(e.testData.competence)+" ")]):a("span",{staticStyle:{"margin-left":"50px"}},[e._v("请求中")])]),a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",[e._v("数据库同步状态:")]),null!=e.testData.syncStatus&&""!=e.testData.syncStatus?a("span",{staticStyle:{"margin-left":"50px"}},[e._v(" "+e._s(e.testData.syncStatus)+" ")]):a("span",{staticStyle:{"margin-left":"50px"}},[e._v("请求中")])])]):"同步记录"==e.testTitle?a("div",[null!=e.recordData&&0!=e.recordData.length?a("div",e._l(e.recordData,(function(t,n){return a("div",{key:n},[a("div",{staticStyle:{"border-bottom":"1px dotted grey"}},[a("span",{staticStyle:{"margin-rght":"20px"}},[e._v("同步时间：")]),a("span",[e._v(e._s(t.time))]),e._l(t.res,(function(t,n){return a("div",{key:n},[e._v(e._s(n+1)+"-"+e._s(t))])}))],2)])})),0):a("div",[e._v("暂无数据")])]):e._e()])],1)},P=[],U=a("b85c"),z=a("3835"),A=a("2909"),K=a("1da1"),M=(a("96cf"),a("caad"),a("3ca3"),a("ddb0"),a("d81d"),a("25eb"),a("a9e3"),a("a434"),a("7db0"),a("2532"),a("4de4"),a("d9e2"),a("b64b"),a("ae699")),G=a("8449"),V=a("a9af"),B=a("10d2"),J=[{title:"设备名称",dataIndex:"deviceName"},{title:"服务ID",scopedSlots:{customRender:"businessId"}},{title:"服务名称",dataIndex:"name"},{title:"数据库类型",width:"10%",dataIndex:"dbType"},{title:"数据库资源名",width:"10%",dataIndex:"transmitDbName"},{title:"下发状态",ellipsis:!0,scopedSlots:{customRender:"workState"}},{title:"审批状态",ellipsis:!0,scopedSlots:{customRender:"approvalState"}},{title:"用户",dataIndex:"createUser"},{title:"操作",width:400,scopedSlots:{customRender:"operations"}}],q=[{title:"源表名称",dataIndex:"name"},{title:"字段选择",scopedSlots:{customRender:"operations"}}],W=[{title:"源表名称",dataIndex:"sourceTableName"},{title:"目的表名称",scopedSlots:{customRender:"destTableName"}},{title:"字段选择",scopedSlots:{customRender:"operations"}}],Q=[{title:"字段名称",dataIndex:"FieldName"},{title:"字段类型",dataIndex:"FieldType"},{title:"字段长度",dataIndex:"FieldLength"},{title:"主键",scopedSlots:{customRender:"FieldPrimary"}},{title:"增量字段",scopedSlots:{customRender:"FieldIncrement"}},{title:"可空",scopedSlots:{customRender:"NullField"}},{title:"唯一",scopedSlots:{customRender:"UniqueField"}}],H=[{title:"源名称",width:120,dataIndex:"SField"},{title:"目的名称",width:150,scopedSlots:{customRender:"DField"}},{title:"源类型",dataIndex:"SType"},{title:"目的类型",dataIndex:"DType"},{title:"源长度",dataIndex:"SLength"},{title:"目的长度",dataIndex:"DLength"},{title:"源主键",scopedSlots:{customRender:"SPrimary"}},{title:"源增量",scopedSlots:{customRender:"SIncrement"}},{title:"源表可空",scopedSlots:{customRender:"SNullField"}},{title:"目的表可空",scopedSlots:{customRender:"DNullField"}},{title:"源唯一",scopedSlots:{customRender:"SUniqueField"}},{title:"目的唯一",scopedSlots:{customRender:"DUniqueField"}}],Y={name:"BusinessDbThrid",components:{BdataShow:u["a"],LazyLoadingMultipleSelect:V["a"],BCascader:B["a"]},mixins:[m["a"]],filters:{convertWorkState:_["H"]},data:function(){return{table:{data:[],total:0},loading:!1,columns:J,page:1,pageSize:10,search:this.getInitialSearchParams(),dialog:G["a"],visible:!1,visibleSecond:!1,visibleTest:!1,strategyStateVisible:!1,importVisible:!1,title:"",testTitle:"",dialogType:"",confirmLoading:!1,spinning:!1,form:{data:this.getInitialFormData(),rules:this.getFormRules()},selectOptions:{dbList:[],strategyDbList:[],deviceList:[],channelList:[],timeList:[],dbReceiverList:[],DesList:[]},readOnly:!1,filterField:"",tabledata:[],innerTableData:[],selectedRowKeys:[],selectedRowKeys1:[],sName:"",innerDesNameList:[],innerDesList:[],dbTableData:[],testData:{},recordData:[],dbInfoList:this.getInitialDbInfo(),dbStrategyList:this.getInitialDbStrategy(),importFailedData:{},contentStrategiesList:[],format17:d["a"].format17,nameRule:d["a"].name,tableColumns1:q,tableColumns2:W,fieldSenderColumns:Q,fieldReceiverColumns:H,ApprovalDialog:M["a"]}},computed:Object(o["a"])(Object(o["a"])({},Object(l["b"])("account",["user"])),{},{isSimpleDialog:function(){return!["create","modify","view"].includes(this.dialogType)},getDialogWidth:function(){return this.isSimpleDialog?"500px":"1200px"}}),watch:{},created:function(){},mounted:function(){this.detectDeviceType()},methods:{cascaderHandler:function(e){this.search.deviceId=e[0],this.search.channelInfoId=e[1]},getInitialSearchParams:function(){return{name:"",businessId:"",deviceId:"",channelInfoId:"",type:void 0,transmitModel:void 0,workState:void 0,approvalState:void 0}},getInitialFormData:function(){return{id:"",type:"",createUser:"",businessId:"",name:"",dbType:"",transmitDbId:"",transmitDbName:"",deviceId:"",deviceName:"",channelInfoId:"",deviceType:"",strategyId:"",delaySync:60,businessTimeId:"",maxFlow:"",virus:!1,keywords1:[],keywords:"",dbTables:[]}},getFormRules:function(){return{businessId:d["a"].select,dbType:d["a"].select,transmitDbId:d["a"].select,deviceId:d["a"].select,strategyId:d["a"].select,businessTimeId:d["a"].select,createUser:d["a"].input,maxFlow:d["a"].format22}},getInitialDbInfo:function(){return{dbIp:"",dbName:"",dbPort:"",dbType:"",id:"",name:"",networkAreaId:"",networkAreaName:"",userName:"",userPwd:"",linkState:""}},getInitialDbStrategy:function(){return{operationName:"",transmitType:"",transmitTypeName:"",contentCheck:"",contentCheckName:"",contentCheckSize:"",conflictStrategy:"",conflictStrategyName:""}},update:function(){this.page=1,this.loadTableData()},resetUpdate:function(){this.$refs.cascaderRef&&this.$refs.cascaderRef.resetSelection(),this.search=this.getInitialSearchParams(),this.update()},loadTableData:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,a=encodeURIComponent(JSON.stringify(e.search)),t.prev=2,t.next=5,Object(p["b"])("single-db/single-dbs?offset=".concat((e.page-1)*e.pageSize,"&limit=").concat(e.pageSize,"&search=").concat(a),p["a"].GET);case 5:n=t.sent,e.table.data=n.rows||[],e.table.total=n.total||0,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](2),e.table.data=[],e.table.total=0;case 14:return t.prev=14,e.loading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,10,14,17]])})))()},tableParamChanged:function(e){this.page=e.page,this.pageSize=e.pageSize,this.loadTableData()},resetTable:function(){this.$refs.cascaderRef&&this.$refs.cascaderRef.resetSelection(),this.table.data=[],this.table.total=0,this.page=1,this.pageSize=10,this.search=this.getInitialSearchParams()},batchRemove:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.handleBatchOperation(e,"single-db/single-db/batch-remove","申请批量移除");case 2:case"end":return a.stop()}}),a)})))()},batchDispatch:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.handleBatchOperation(e,"single-db/single-db/batch-send","申请批量下发");case 2:case"end":return a.stop()}}),a)})))()},batchDelete:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.handleBatchOperation(e,"single-db/single-db/batch-delete","批量删除",p["a"].DELETE);case 2:case"end":return a.stop()}}),a)})))()},handleBatchOperation:function(e,t,a){var n=arguments,r=this;return Object(K["a"])(regeneratorRuntime.mark((function i(){var s,o,l,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=n.length>3&&void 0!==n[3]?n[3]:p["a"].PUT,i.prev=1,i.next=4,r.$confirm({content:"确认".concat(a,"吗？"),okText:"确认",cancelText:"取消"});case 4:return i.next=6,Object(p["b"])("".concat(t,"?ids=").concat(e),s);case 6:o=i.sent,l=o.rows,c=o.msg,(null===l||void 0===l?void 0:l.length)>0?r.showImportResult(a,l,c):r.$message.success("".concat(a,"成功！")),r.loadTableData(),i.next=15;break;case 13:i.prev=13,i.t0=i["catch"](1);case 15:case"end":return i.stop()}}),i,null,[[1,13]])})))()},batchDispatchApproval:function(){this.ApprovalDialog.open({state:"approval",parent:this,params:{businessId:void 0,businessIds:[],type:5,location:"",busiType:"single-db"}})},batchRemoveApproval:function(){this.ApprovalDialog.open({state:"approval",parent:this,params:{businessId:void 0,businessIds:[],type:8,location:"",busiType:"single-db"}})},linkDetection:function(e,t){var a=JSON.parse(JSON.stringify(t));a.type="DX",this.dialog.open({state:"link",params:a})},showImportResult:function(e,t,a){this.title=e,this.importFailedData={rows:t,msg:a},this.importVisible=!0},openDialog:function(e,t){this.dialogType=e,this.title=this.getDialogTitle(e),this.visible=!0,this.isSimpleDialog||this.initDialogData(t)},getDialogTitle:function(e){var t={create:"新建",modify:"修改",view:"详情",delete:"删除",dispatch:"下发",remove:"移除",manual:"手动同步",config:"传输配置",retract:"撤回"};return t[e]||""},closeDialog:function(){this.visible=!1,this.confirmLoading=!1,this.resetForm()},businessTransDbView:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.loadRecordData(e,"view");case 2:case"end":return a.stop()}}),a)})))()},businessTransDbModify:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.loadRecordData(e.id,"modify");case 2:case"end":return a.stop()}}),a)})))()},businessTransDbDispatch:function(e){this.openSimpleDialog(e,"dispatch")},businessTransDbMove:function(e){this.openSimpleDialog(e,"remove")},businessTransDbRevoke:function(e){this.openSimpleDialog(e,"retract")},businessTransDbDelete:function(e){this.form.data.id=e.id,this.form.data.deviceType=e.deviceType,this.openDialog("delete")},businessTransDbTransmit:function(e){this.openSimpleDialog(e,"config")},businessTransDbManual:function(e){3==e.workState?this.openSimpleDialog(e.id,"manual"):this.$message.error("当前服务未生效，不能手动同步")},openSimpleDialog:function(e,t){this.form.data.id=e,this.openDialog(t)},loadRecordData:function(e,t){var a=this;return Object(K["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(p["b"])("single-db/single-db/".concat(e),p["a"].GET);case 3:i=n.sent,a.form.data=i,null===(r=a.form.data.dbTables)||void 0===r||r.forEach((function(e){e.fieldList=JSON.parse(e.fieldList)})),a.initReceiverData(),a.openDialog(t),n.next=12;break;case 10:n.prev=10,n.t0=n["catch"](0);case 12:case"end":return n.stop()}}),n,null,[[0,10]])})))()},initDialogData:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Promise.all([t.getDeviceList(e),t.getChannelList(),t.getDbList()]);case 3:if(!["modify","view"].includes(t.dialogType)){a.next=6;break}return a.next=6,t.handleEditMode();case 6:a.next=10;break;case 8:a.prev=8,a.t0=a["catch"](0);case 10:case"end":return a.stop()}}),a,null,[[0,8]])})))()},choseType:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.$refs["form"].clearValidate(),"sender"!=e){a.next=6;break}return a.next=4,t.initSenderData();case 4:a.next=8;break;case 6:return a.next=8,t.initReceiverData();case 8:case"end":return a.stop()}}),a)})))()},getDeviceList:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t,a.next=3,Object(p["b"])("device/device-info/all",p["a"].GET);case 3:if(r=a.sent,n.selectOptions.deviceList=r||[],"create"!==n.dialogType){a.next=23;break}if(n.form.data.deviceId=(null===e||void 0===e?void 0:e.deviceId)||"",n.form.data.channelInfoId=(null===e||void 0===e?void 0:e.channelInfoId)||"",n.form.data.sn=(null===e||void 0===e?void 0:e.sn)||"",n.form.data.channelName=(null===e||void 0===e?void 0:e.channelName)||"",n.form.data.channelType=(null===e||void 0===e?void 0:e.channelType)||"",n.form.data.deviceNodeName=(null===e||void 0===e?void 0:e.deviceNodeName)||"",n.form.data.deviceType=(null===e||void 0===e?void 0:e.deviceType)||"",1!=n.form.data.channelType||"A"!=n.form.data.deviceNodeName){a.next=19;break}return n.form.data.type="sender",a.next=17,t.initSenderData();case 17:a.next=23;break;case 19:if(1!=n.form.data.channelType||"B"!=n.form.data.deviceNodeName){a.next=23;break}return n.form.data.type="receiver",a.next=23,t.initReceiverData();case 23:case"end":return a.stop()}}),a)})))()},getChannelList:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["b"])("device/channel-info/all",p["a"].GET);case 2:a=t.sent,e.selectOptions.channelList=a||[];case 4:case"end":return t.stop()}}),t)})))()},getDbList:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["b"])("trans-db/trans-db/all",p["a"].GET);case 2:a=t.sent,e.selectOptions.dbList=[{id:"",name:"请选择"}].concat(Object(A["a"])(a||[]));case 4:case"end":return t.stop()}}),t)})))()},initSenderData:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([Object(p["b"])("time-config/config/all?mode=3",p["a"].GET),Object(p["b"])("strategy/strategy-db/all",p["a"].GET),Object(p["b"])("strategy/strategy-trcontent/all",p["a"].GET)]);case 2:a=t.sent,n=Object(z["a"])(a,3),r=n[0],i=n[1],s=n[2],e.selectOptions.timeList=[{id:"",name:"请选择"}].concat(Object(A["a"])(r||[])),e.selectOptions.strategyDbList=[{id:"",name:"请选择"}].concat(Object(A["a"])(i||[])),e.contentStrategiesList=s||[];case 10:case"end":return t.stop()}}),t)})))()},initReceiverData:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["b"])("single-db/single-db/all?type=recSender&sn=".concat(e.form.data.sn,"&channelName=").concat(e.form.data.channelName),p["a"].GET);case 2:a=t.sent,e.selectOptions.dbReceiverList=Object(A["a"])(a||[]);case 4:case"end":return t.stop()}}),t)})))()},handleEditMode:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDbInfo(e.form.data.transmitDbId);case 2:if("sender"!==e.form.data.type){t.next=9;break}return t.next=5,e.handleSenderEdit();case 5:return t.next=7,e.initSenderData();case 7:t.next=11;break;case 9:return t.next=11,e.handleReceiverEdit();case 11:case"end":return t.stop()}}),t)})))()},getDbInfo:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(p["b"])("trans-db/trans-db/".concat(e),p["a"].GET);case 2:n=a.sent,t.dbInfoList=n;case 4:case"end":return a.stop()}}),a)})))()},handleSenderEdit:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.selectedRowKeys=[],e.form.data.keywords?e.form.data.keywords1=e.form.data.keywords.split(",").map((function(e){return Number.parseInt(e)})):e.form.data.keywords1=[],null===(a=e.form.data.dbTables)||void 0===a||a.forEach((function(t){e.selectedRowKeys.push(t.sourceTableName)})),t.next=5,e.fetchTableData(e.form.data.transmitDbId,e.form.data.channelInfoId,e.form.data.id,e.tabledata);case 5:if(!e.form.data.strategyId){t.next=10;break}return t.next=8,Object(p["b"])("strategy/strategy-db/".concat(e.form.data.strategyId),p["a"].GET);case 8:n=t.sent,e.dbStrategyList=e.convertStrategyStatus(n);case 10:case"end":return t.stop()}}),t)})))()},handleReceiverEdit:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["b"])("single-db/single-db/".concat(e.form.data.businessId,"?type=recSender"),p["a"].GET);case 2:return a=t.sent,e.handleSourceTableData(a.dbTables),t.next=6,e.fetchTableData(e.form.data.transmitDbId,e.form.data.channelInfoId,e.form.data.id,e.selectOptions.DesList);case 6:case"end":return t.stop()}}),t)})))()},fetchTableData:function(e,t,a,n){return Object(K["a"])(regeneratorRuntime.mark((function r(){var i,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e&&t){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,Object(p["b"])("single-db/single-db/tables?id=".concat(e,"&channelInfoId=").concat(t,"&dbAppId=").concat(a),p["a"].GET);case 4:i=r.sent,i&&(s=JSON.parse(i).map((function(e){return{name:e}})),n.splice.apply(n,[0,n.length].concat(Object(A["a"])(s))));case 6:case"end":return r.stop()}}),r)})))()},handleSourceTableData:function(e){var t=this;this.dbTableData=e.map((function(e){var a,n=JSON.parse(e.fieldList),r=[];return null===(a=t.form.data.dbTables)||void 0===a||a.forEach((function(t){e.sourceTableName===t.sourceTableName&&(e.destTableName=t.destTableName,n.forEach((function(e){var a,n=null===(a=t.fieldList)||void 0===a?void 0:a.find((function(t){return t.SField===e.SField}));r.push(n||e)})))})),Object(o["a"])(Object(o["a"])({},e),{},{fieldList1:n,fieldList:r})})),this.$nextTick((function(){t.dbTableData.forEach((function(e){e.destTableName||(e.destTableName=e.sourceTableName)}))}))},choseDbName:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,Object(p["b"])("trans-db/trans-db/".concat(e),p["a"].GET);case 4:if(n=a.sent,t.dbInfoList=n,r=t.selectOptions.dbList.find((function(t){return t.id==e})),r&&(t.form.data.transmitDbName=r.name,t.form.data.dbType="sender"===t.form.data.type?t.dbInfoList.dbType:r.dbType),!t.form.data.channelInfoId){a.next=11;break}return a.next=11,t.loadTableDataByDb(e);case 11:case"end":return a.stop()}}),a)})))()},loadTableDataByDb:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(p["b"])("single-db/single-db/tables?id=".concat(e,"&channelInfoId=").concat(t.form.data.channelInfoId,"&dbAppId=0"),p["a"].GET);case 2:n=a.sent,n&&(r=JSON.parse(n).map((function(e){return{name:e}})),"sender"===t.form.data.type?t.tabledata=r:t.selectOptions.DesList=r);case 4:case"end":return a.stop()}}),a)})))()},choseBusiness:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(null===(n=t.$refs.form)||void 0===n||n.clearValidate(),t.form.data.dbTables=[],t.dbTableData=[],t.form.data.name="",e){a.next=6;break}return a.abrupt("return");case 6:return r=t.selectOptions.dbReceiverList.find((function(t){return t.businessId==e})),r&&(t.form.data.name=r.name),a.next=10,Object(p["b"])("single-db/single-db/".concat(e,"?type=recSender"),p["a"].GET);case 10:i=a.sent,t.dbTableData=i.dbTables.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{fieldList1:JSON.parse(e.fieldList),fieldList:[]})}));case 12:case"end":return a.stop()}}),a)})))()},choseDbStrategy:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=3;break}return t.resetDbStrategy(),a.abrupt("return");case 3:return a.next=5,Object(p["b"])("strategy/strategy-db/".concat(e),p["a"].GET);case 5:n=a.sent,t.dbStrategyList=t.convertStrategyStatus(n);case 7:case"end":return a.stop()}}),a)})))()},convertStrategyStatus:function(e){var t={Copy:"全表复制",Increment:"增量更新",Total:"全表更新"},a={1:"检查",0:"不检查"},n={1:"覆盖",0:"不覆盖"};return Object(o["a"])(Object(o["a"])({},e),{},{transmitTypeName:t[e.transmitType]||"",contentCheckName:a[e.contentCheck]||"",conflictStrategyName:n[e.conflictStrategy]||""})},resetDbStrategy:function(){this.dbStrategyList=this.getInitialDbStrategy()},onSelectChange:function(e){this.selectedRowKeys=e,this.updateFormTables(e)},updateFormTables:function(e){var t=this;if("sender"===this.form.data.type){var a=this.form.data.dbTables.map((function(e){return e.sourceTableName}));e.forEach((function(e){a.includes(e)||t.form.data.dbTables.push({sourceTableName:e})})),this.form.data.dbTables=this.form.data.dbTables.filter((function(t){return e.includes(t.sourceTableName)}))}},choseFristDesName:function(e){e.fieldList=[]},choseWord:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.openFieldSelection(e,"sender");case 2:case"end":return a.stop()}}),a)})))()},choseWord1:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.destTableName){a.next=3;break}return t.$message.error("请先选择目的表"),a.abrupt("return");case 3:return a.next=5,t.openFieldSelection(e.sourceTableName,"receiver",e);case 5:case"end":return a.stop()}}),a)})))()},openFieldSelection:function(e,t){var a=arguments,n=this;return Object(K["a"])(regeneratorRuntime.mark((function r(){var i,s,o,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:null,n.sName=e,n.spinning=!0,r.prev=3,r.next=6,Object(p["b"])("single-db/single-db/fields?id=".concat(n.form.data.transmitDbId,"&channelInfoId=").concat(n.form.data.channelInfoId,"&tableName=").concat((null===i||void 0===i?void 0:i.destTableName)||e),p["a"].GET);case 6:if(s=r.sent,s&&"FAIL"!==s.state){r.next=9;break}throw new Error((null===s||void 0===s?void 0:s.msg)||"该表无字段，请重新选择");case 9:if(o=JSON.parse(s),l=o[0].ResData,"sender"!==t){r.next=16;break}return r.next=14,n.handleSenderFieldSelection(e,l);case 14:r.next=18;break;case 16:return r.next=18,n.handleReceiverFieldSelection(i,l);case 18:n.visibleSecond=!0,r.next=24;break;case 21:r.prev=21,r.t0=r["catch"](3),n.$message.error(r.t0.message);case 24:return r.prev=24,n.spinning=!1,r.finish(24);case 27:case"end":return r.stop()}}),r,null,[[3,21,24,27]])})))()},handleSenderFieldSelection:function(e,t){var a=this;return Object(K["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a.innerTableData=t,r=a.form.data.dbTables.find((function(t){return t.sourceTableName===e})),null!==r&&void 0!==r&&r.fieldList?(a.selectedRowKeys1=r.fieldList.map((function(e){return e.SField})),a.innerTableData.forEach((function(e){var t=r.fieldList.find((function(t){return t.SField===e.FieldName}));t&&(e.FieldPrimary=t.SPrimary,e.FieldIncrement=t.SIncrement)})),a.filterField=r.filterField||""):a.selectedRowKeys.includes(e)||(a.selectedRowKeys.push(e),a.form.data.dbTables.push({sourceTableName:e}));case 3:case"end":return n.stop()}}),n)})))()},handleReceiverFieldSelection:function(e,t){var a=this;return Object(K["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a.innerDesNameList=t.map((function(e){return e.FieldName})),a.innerDesList=t,a.innerTableData=e.fieldList.length>0?JSON.parse(JSON.stringify(e.fieldList)):JSON.parse(JSON.stringify(e.fieldList1)),a.innerTableData.forEach((function(e){if(!e.DField){var t=a.innerDesList.find((function(t){return t.FieldName===e.SField}));t&&Object.assign(e,{DField:t.FieldName,DLength:t.FieldLength,DType:t.FieldType,DPrimary:t.FieldPrimary,DIncrement:t.FieldIncrement,DUniqueField:t.UniqueField,DNullField:t.NullField})}}));case 4:case"end":return n.stop()}}),n)})))()},onSelectChange1:function(e){this.selectedRowKeys1=e},choseDesName:function(e){var t=this.innerDesList.find((function(t){return t.FieldName==e.DField}));t&&Object.assign(e,{DLength:t.FieldLength,DType:t.FieldType,DPrimary:t.FieldPrimary,DIncrement:t.FieldIncrement,DUniqueField:t.UniqueField,DNullField:t.NullField})},closeFieldDialog:function(){this.visibleSecond=!1,this.resetFieldDialog()},resetFieldDialog:function(){this.innerTableData=[],this.selectedRowKeys1=[],this.sName="",this.filterField=""},saveFieldSelection:function(){"sender"==this.form.data.type?this.saveSenderFieldSelection():this.saveReceiverFieldSelection()},saveSenderFieldSelection:function(){var e=this,t=this.form.data.dbTables.find((function(t){return t.sourceTableName==e.sName}));if(t)if(this.selectedRowKeys1.length<1)this.$message.error("至少选择一个字段");else{var a=this.selectedRowKeys1.map((function(t){var a=e.innerTableData.find((function(e){return e.FieldName==t}));return{SField:a.FieldName,SType:a.FieldType,SLength:a.FieldLength,SIncrement:a.FieldIncrement,SPrimary:a.FieldPrimary,SNullField:a.NullField,SUniqueField:a.UniqueField,DField:"",DLength:"",DType:"",DPrimary:"",DIncrement:"",DUniqueField:"",DNullField:""}}));this.validateFieldRules(a)&&(t.fieldList=a,t.filterField=this.filterField,this.visibleSecond=!1,this.resetFieldDialog())}},validateFieldRules:function(e){var t=e.filter((function(e){return"1"==e.SPrimary})).length,a=e.filter((function(e){return"1"==e.SIncrement})).length;return"全表更新"==this.dbStrategyList.transmitTypeName&&t<1?(this.$message.error("全表更新至少有一个主键"),!1):"增量更新"!=this.dbStrategyList.transmitTypeName||1==a||(this.$message.error("增量更新有且只有一个增量字段"),!1)},saveReceiverFieldSelection:function(){var e=this,t=this.innerTableData.some((function(t,a){return!t.DField&&(e.$message.error("第".concat(a+1,"行未选择目的名称")),!0)}));if(!t){var a=this.dbTableData.find((function(t){return t.sourceTableName==e.sName}));a&&(a.fieldList=this.innerTableData),this.visibleSecond=!1,this.resetFieldDialog()}},handleSave:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.confirmLoading=!0,t.prev=1,!e.isSimpleDialog){t.next=7;break}return t.next=5,e.handleSimpleAction();case 5:t.next=9;break;case 7:return t.next=9,e.handleFormSubmit();case 9:t.next=13;break;case 11:t.prev=11,t.t0=t["catch"](1);case 13:return t.prev=13,e.confirmLoading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,11,13,16]])})))()},handleSimpleAction:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a={delete:"single-db/single-db/".concat(e.form.data.id),dispatch:"single-db/single-db/apply-send/".concat(e.form.data.id),remove:"single-db/single-db/apply-remove/".concat(e.form.data.id),manual:"single-db/single-db/sync/".concat(e.form.data.id),config:"single-db/single-db/config/".concat(e.form.data.id),retract:"single-db/single-db/retract/".concat(e.form.data.id)},n={delete:p["a"].DELETE,dispatch:p["a"].POST,remove:p["a"].POST,manual:p["a"].PUT,config:p["a"].PUT,retract:p["a"].POST},r=a[e.dialogType],i=n[e.dialogType],r){t.next=7;break}return e.$message.error("未知的操作类型"),t.abrupt("return");case 7:return t.next=9,Object(p["b"])(r,i);case 9:e.$message.success("操作成功"),e.closeDialog(),e.loadTableData();case 12:case"end":return t.stop()}}),t)})))()},handleFormSubmit:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.validateForm();case 2:if(a=t.sent,a){t.next=5;break}return t.abrupt("return");case 5:return n="create"==e.dialogType?p["a"].POST:p["a"].PUT,r=e.prepareSubmitData(),t.next=9,Object(p["b"])("single-db/single-db",n,r);case 9:e.$message.success("create"==e.dialogType?"创建成功":"修改成功"),e.closeDialog(),e.loadTableData();case 12:case"end":return t.stop()}}),t)})))()},validateForm:function(){var e=this;return Object(K["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.form.validate();case 3:if("sender"!=e.form.data.type){t.next=7;break}return t.abrupt("return",e.validateSenderForm());case 7:return t.abrupt("return",e.validateReceiverForm());case 8:t.next=13;break;case 10:return t.prev=10,t.t0=t["catch"](0),t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},validateSenderForm:function(){if(this.form.data.dbTables.length<1)return this.$message.error("源表至少选择一个"),!1;var e,t=Object(U["a"])(this.form.data.dbTables);try{for(t.s();!(e=t.n()).done;){var a=e.value;if(!a.fieldList||a.fieldList.length<1)return this.$message.error("已选源表".concat(a.sourceTableName,"未选字段")),!1}}catch(n){t.e(n)}finally{t.f()}return!0},validateReceiverForm:function(){this.form.data.dbTables=JSON.parse(JSON.stringify(this.dbTableData));var e,t=Object(U["a"])(this.form.data.dbTables);try{for(t.s();!(e=t.n()).done;){var a=e.value;if(!a.destTableName)return this.$message.error("源表".concat(a.sourceTableName,"未选目的表字段")),!1;if(a.fieldList.length<1)return this.$message.error("源表".concat(a.sourceTableName,"未选字段")),!1;for(var n=0;n<a.fieldList.length;n++)if(!a.fieldList[n].DField)return this.$message.error("源表".concat(a.sourceTableName,"中第").concat(n+1,"行未选目的表字段名称")),!1}}catch(r){t.e(r)}finally{t.f()}return!0},prepareSubmitData:function(){var e=Object(o["a"])({},this.form.data);return e.keywords=this.arrayToString(e.keywords1),e.dbTables=e.dbTables.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{fieldList:JSON.stringify(e.fieldList)})})),e},arrayToString:function(e){return(null===e||void 0===e?void 0:e.length)>0?e.join(","):""},businessTransDbConnect:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.testTitle="服务测试",t.visibleTest=!0,a.prev=2,a.next=5,Object(p["b"])("single-db/single-db/status/".concat(e),p["a"].GET);case 5:n=a.sent,t.testData={name:n.name||"...",connectStatus:n.connectStatus||"...",tableExist:n.tableExist||"...",fieldExist:n.fieldExist||"...",competence:n.competence||"...",syncStatus:n.syncStatus||"..."},a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](2),t.testData={name:"连接失败",connectStatus:"连接失败",tableExist:"连接失败",fieldExist:"连接失败",competence:"连接失败",syncStatus:"连接失败"};case 12:case"end":return a.stop()}}),a,null,[[2,9]])})))()},cancelTest:function(){this.visibleTest=!1,this.testTitle="",this.testData={}},businessApproval:function(e){this.ApprovalDialog.open({state:"approval",parent:this,params:{businessId:e.id,type:e.approvalState}})},showApprovalOpinion:function(e){this.ApprovalDialog.open({state:"opinion",params:{businessId:e}})},deleteDbItem:function(e){var t=this;return Object(K["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(p["b"])("single-db/single-db/delete-cache/".concat(e),p["a"].DELETE);case 2:return t.$message.success("删除成功"),a.next=5,Object(p["b"])("single-db/single-db/all?type=recSender",p["a"].GET);case 5:n=a.sent,t.selectOptions.dbReceiverList=[{businessId:"",name:"请选择"}].concat(Object(A["a"])(n));case 7:case"end":return a.stop()}}),a)})))()},handleKeywordsChange:function(e){this.form.data.keywords1=e},resetForm:function(){var e,t=this;null===(e=this.$refs.form)||void 0===e||e.clearValidate(),this.form.data=this.getInitialFormData(),this.selectOptions.DesList=[],this.tabledata=[],this.selectedRowKeys=[],Object.keys(this.selectOptions).forEach((function(e){Array.isArray(t.selectOptions[e])&&(t.selectOptions[e]=[])})),this.dbInfoList=this.getInitialDbInfo(),this.dbStrategyList=this.getInitialDbStrategy()},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().includes(e.toLowerCase())}}},X=Y,Z=(a("d301"),Object(D["a"])(X,E,P,!1,null,"1ea599fa",null)),ee=Z.exports,te="db:m",ae={components:{BusinessDbThrid:ee,BtransDb:k,BstrategyDb:$},mixins:[],filters:{},comments:{},props:{},data:function(){return{permissionDeviceMenu:[],menuLists:[{id:1,value:"1",menuName:"数据库资源配置"},{id:2,value:"2",menuName:"数据库同步策略"},{id:3,value:"3",menuName:"数据库同步服务"}],menu:""}},created:function(){var e=this,t=JSON.parse(localStorage.getItem("db"));t.forEach((function(t){e.permissionDeviceMenu.push(t.index.toString())})),this.menu=sessionStorage.getItem(te)||this.permissionDeviceMenu[0]},watch:{},mounted:function(){},methods:{handleMenuChange:function(e){this.menu=e.target.value,sessionStorage.setItem(te,this.menu)}},destroyed:function(){},beforeDestroy:function(){}},ne=ae,re=(a("a575"),Object(D["a"])(ne,n,r,!1,null,"95fc975a",null));t["default"]=re.exports}}]);