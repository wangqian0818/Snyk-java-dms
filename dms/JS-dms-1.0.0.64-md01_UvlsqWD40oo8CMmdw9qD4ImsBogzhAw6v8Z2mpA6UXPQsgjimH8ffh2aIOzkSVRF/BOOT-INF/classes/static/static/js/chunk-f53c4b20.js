(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f53c4b20"],{"10d2":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"device-channel-selector"},[n("a-cascader",{staticStyle:{width:"100%"},attrs:{options:e.processedOptions,placeholder:"请选择设备与通道","field-names":{label:"name",value:"id",children:"children"},disabled:e.disabled,allowClear:!1},on:{change:e.handleChange},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}})],1)},i=[],r=n("3835"),c=n("b85c"),l=n("2909"),s=n("5530"),d=(n("25eb"),n("a9e3"),n("d81d"),n("99af"),n("b0c0"),n("d7b0")),o={name:"DeviceChannelSelector",props:{showAllChannels:{type:Boolean,default:!1},clearOnInit:{type:Boolean,default:!1},flag:{type:Boolean,default:!1},activeKeyFlag:{type:String,default:""}},data:function(){var e=localStorage.getItem("dmsType"),t=3;return"1"!==e&&"2"!==e||(t=Number.parseInt(e,10)),{selectedValue:[],dmsType:t,disabled:!1,loading:!1,options:[]}},created:function(){var e=this;this.loading=!0,Object(d["d"])(this.activeKeyFlag).then((function(t){var n=t.data;e.options=n||[],e.loading=!1})).catch((function(){e.options=[],e.loading=!1}))},computed:{processedOptions:function(){return this.showAllChannels&&0!==this.options.length?this.options.map((function(e){var t={id:"",name:"全部通道"};return Object(s["a"])(Object(s["a"])({},e),{},{children:e.children?[t].concat(Object(l["a"])(e.children)):[]})})):this.options}},watch:{options:{immediate:!0,handler:function(e){e&&e.length>0?this.setDefaultSelection():this.selectedValue=[]}},dmsType:function(){this.setDefaultSelection()}},methods:{findNodeById:function(e,t){var n,a=Object(c["a"])(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.id===t)return i;if(i.children&&i.children.length>0){var r=this.findNodeById(i.children,t);if(r)return r}}}catch(l){a.e(l)}finally{a.f()}return null},getChannelInfoByValue:function(e){if(!e||e.length<2)return null;var t=Object(r["a"])(e,2),n=t[0],a=t[1],i=this.findNodeById(this.options,n);if(!i||!i.children)return null;var c=this.findNodeById(i.children,a);return c?{sn:c.sn||"",channelName:c.name||"",channelType:c.channelType||"",deviceNodeName:c.deviceNodeName||"",deviceType:c.deviceType||"",deviceId:n,channelInfoId:a}:null},setDefaultSelection:function(){var e=this;this.loading=!0,this.$nextTick((function(){if(e.clearOnInit)return e.selectedValue=[],void(e.loading=!1);if(0===e.processedOptions.length)return e.selectedValue=[],void(e.loading=!1);var t=e.processedOptions[0];switch(e.dmsType){case 1:e.disabled=!0,t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;case 2:t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;case 3:t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;default:e.selectedValue=[]}if(e.loading=!1,e.selectedValue.length>0){var n=e.getChannelInfoByValue(e.selectedValue);e.$emit("change",e.selectedValue,n)}}))},resetSelection:function(){this.selectedValue=[],this.setDefaultSelection()},clearSelection:function(){this.selectedValue=[]},handleChange:function(e){this.selectedValue=e;var t=this.getChannelInfoByValue(e);this.$emit("change",e,t)},getSelectedValue:function(){return this.selectedValue},getSelectedChannelInfo:function(){return this.getChannelInfoByValue(this.selectedValue)}}},h=o,u=(n("296d"),n("2877")),f=Object(u["a"])(h,a,i,!1,null,"5ab0cc82",null);t["a"]=f.exports},2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("6b75");function i(e){if(Array.isArray(e))return Object(a["a"])(e)}n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var c=n("06c5");n("d9e2");function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e){return i(e)||r(e)||Object(c["a"])(e)||l()}},"296d":function(e,t,n){"use strict";n("e9bd")},3835:function(e,t,n){"use strict";function a(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return l}));n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");function i(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],c=!0,l=!1;try{for(n=n.call(e);!(c=(a=n.next()).done);c=!0)if(r.push(a.value),t&&r.length===t)break}catch(s){l=!0,i=s}finally{try{c||null==n["return"]||n["return"]()}finally{if(l)throw i}}return r}}var r=n("06c5");n("d9e2");function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){return a(e)||i(e,t)||Object(r["a"])(e,t)||c()}},"9ecf":function(e,t,n){"use strict";n("a197")},a197:function(e,t,n){},e98a:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-card",{staticStyle:{"margin-top":"30px"}},[n("div",{staticClass:"search"},[n("div",{staticClass:"title"},[e._v("查询条件")]),n("div",{staticClass:"content"},[n("div",{staticClass:"filter-container"},[1!=e.dmsType?n("span",{staticClass:"inner",staticStyle:{width:"200px","margin-right":"20px"}},[n("b-cascader",{ref:"cascaderRef",attrs:{activeKeyFlag:e.activeKeyFlag,"show-all-channels":!1,"clear-on-init":!1},on:{change:e.cascaderHandler}})],1):e._e(),n("a-date-picker",{staticStyle:{width:"200px","margin-right":"16px"},attrs:{format:"YYYY-MM-DD",allowClear:!1,"disabled-date":e.disabledDate,placeholder:"请选择日期"},model:{value:e.search.selectedDate,callback:function(t){e.$set(e.search,"selectedDate",t)},expression:"search.selectedDate"}}),n("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)])]),n("a-row",[n("a-col",{attrs:{span:24}},[n("a-card",{staticStyle:{"margin-top":"30px"}},[n("div",{staticClass:"chart-title"},[e._v(e._s(e.title)+"图")]),n("div",{staticClass:"chart-container"},[n("div",{ref:"trendChart",staticStyle:{width:"100%",height:"400px"}})]),n("div",{staticClass:"table-title"},[e._v(e._s(e.title)+"表")]),n("div",{staticClass:"table-container"},[n("a-table",{attrs:{columns:e.columns1,"data-source":e.tableData1,pagination:!1,scroll:{y:300},bordered:""}})],1)])],1)],1)],1)},i=[],r=(n("e9c4"),n("ac1f"),n("841c"),n("99af"),n("d81d"),n("fb6a"),n("b0c0"),n("d3b7"),n("159b"),n("c2f2")),c=n("313e"),l=n("c1df"),s=n.n(l),d=n("b775"),o=n("10d2"),h={name:"AnalysisChartTable",props:{columns:{type:Array,required:!0},keyMap:{type:Object,required:!0},url:{type:String,required:!0},title:{type:String,required:!0},unit:{type:String,required:!0},activeKeyFlag:{type:String,default:""}},components:{BCascader:o["a"]},mixins:[r["a"]],data:function(){return{search:{selectedDate:s()(),deviceId:"",channelInfoId:""},tableData1:[],trendChart:null,resizeObserver:null,columns1:JSON.parse(JSON.stringify(this.columns))}},mounted:function(){var e=this;1==this.dmsType&&(this.initCharts(),this.fetchChartData()),window.addEventListener("resize",this.handleResize),this.resizeObserver=new ResizeObserver((function(){e.handleResize()})),this.resizeObserver.observe(this.$refs.trendChart)},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize),this.resizeObserver&&this.resizeObserver.disconnect()},methods:{disabledDate:function(e){return e&&e>s()().endOf("day")},initCharts:function(){this.trendChart=this.initSingleChart("trendChart")},initSingleChart:function(e){var t=this.$refs[e],n=c["init"](t),a={title:{text:"",top:5,left:5,textStyle:{fontSize:14,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[],top:0},grid:{left:"3%",right:"2%",bottom:"8%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value",name:this.unit,nameLocation:"end",nameTextStyle:{fontSize:12,fontWeight:"bold"}},series:[]};return n.setOption(a),n},fetchChartData:function(){var e=this,t=s()(this.search.selectedDate).format("YYYY-MM-DD");Object(d["b"])("".concat(this.url,"?dayTime=").concat(t,"&deviceId=").concat(this.search.deviceId,"&channelInfoId=").concat(this.search.channelInfoId),d["a"].GET).then((function(t){t.length>=1&&e.updateChartAndTable(0,t[0],e.trendChart,"tableData1","columns1")})).catch((function(e){}))},updateChartAndTable:function(e,t,n,a,i){var r=t.xAxis,c=t.series,l=t.directionName;this[i].length>0&&(this[i][0].title=l),this.updateTableData(a,r,c),this.updateTrendChart(n,r,c,l)},updateTrendChart:function(e,t,n,a){var i=this,r={title:{text:a},xAxis:{data:t},legend:{type:"scroll",data:n.slice(1).map((function(e){return e.name}))},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){var t=e.reduce((function(e,t){return e+t.value}),0),a="<div>".concat(n[0].name,": ").concat(t,"</div>");return e.forEach((function(e){a+="<div>".concat(e.seriesName,": ").concat(e.value,"</div>")})),a}},series:n.slice(1).map((function(e){return{name:e.name,type:"bar",stack:"总量",data:e.data,emphasis:{focus:"series"},barWidth:"50%",itemStyle:{color:i.getSeriesColor(e,n)}}}))};e.setOption(r)},getSeriesColor:function(e,t){var n=["#5470C6","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#43B01E","#91CC75","#9A60B4","#EA7CCC","#1E90FF","#FF4500","#32CD32","#8A2BE2","#FF69B4","#00CED1","#FFD700","#6A5ACD","#FF6347","#20B2AA"],a=t.indexOf(e);return n[a%n.length]},updateTableData:function(e,t,n){var a=this,i=t.map((function(e,t){var i={timePeriod:e};return n.forEach((function(e){i[a.getColumnKey(e.name)]=e.data[t]})),i}));this[e]=i},getColumnKey:function(e){var t=this.keyMap;return t[e]||e},handleSearch:function(){this.fetchChartData()},handleResize:function(){this.trendChart&&this.trendChart.resize()},cascaderHandler:function(e){this.search.deviceId=e[0],this.search.channelInfoId=e[1],this.initCharts(),this.fetchChartData()}}},u=h,f=(n("9ecf"),n("2877")),p=Object(f["a"])(u,a,i,!1,null,"f056ff70",null);t["a"]=p.exports},e9bd:function(e,t,n){}}]);