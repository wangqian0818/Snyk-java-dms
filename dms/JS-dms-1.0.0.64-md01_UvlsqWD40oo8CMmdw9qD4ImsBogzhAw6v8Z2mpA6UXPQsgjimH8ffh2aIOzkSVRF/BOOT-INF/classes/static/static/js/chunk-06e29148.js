(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06e29148"],{8449:function(t,e,a){"use strict";var i=a("8cff"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.form.init.show?a("div",[a("a-modal",{attrs:{closable:!0,title:"连通性检测",width:t.form.init.width,"mask-closable":!1,footer:null},on:{cancel:t.clickCancel},model:{value:t.form.init.show,callback:function(e){t.$set(t.form.init,"show",e)},expression:"form.init.show"}},[a("a-button",{attrs:{type:"primary"},on:{click:t.detectionTest}},[t._v("链路检测")]),"1"==t.form.init.data.channelType?a("span",{staticStyle:{"margin-left":"10px","font-size":"14px",color:"red"}},[t._v("单向检测结果在对端查看，本端查看对端检测结果")]):"2"==t.form.init.data.channelType||"3"==t.form.init.data.channelType?a("span",{staticStyle:{"margin-left":"10px","font-size":"14px",color:"red"}},[t._v("双向检测结果在本端查看")]):t._e(),a("div",{staticStyle:{margin:"0px 10px 10px 0px"}},[t._v("检测结果:")]),a("a-card",[t.requestError?t._e():a("a-table",{attrs:{columns:t.detectionColumns,loading:t.loading,"data-source":t.tableData,pagination:!1}}),t.requestError?a("h3",[t._v("链路不通")]):t._e()],1)],1)],1):t._e()},s=[],o=a("1da1"),r=(a("96cf"),a("99af"),a("b775")),l=a("c2f2"),c=[{title:"开始时间",dataIndex:"startTimeStr",key:"startTimeStr"},{title:"结束时间",dataIndex:"endTimeStr",key:"endTimeStr"},{title:"方向",dataIndex:"msg",key:"msg"},{title:"类型",dataIndex:"typeStr",key:"typeStr"},{title:"检测状态",dataIndex:"status",key:"status"}],d={name:"linkDialog",mixins:[l["a"]],comments:{},filters:{},props:{},data:function(){return{detectionColumns:c,show:!1,loading:!1,requestError:!1,title:"",width:710,prop:"",form:{init:{show:!0,width:710,data:{id:"",deviceId:"",sn:"",channelName:"",channelType:"",deviceNodeName:""}}},tableData:[],timer:null,requestCount:0,maxRequestCount:30}},created:function(){this.showDialog(this.state,this.params),"1"==this.params.channelType&&this.startDetection()},methods:{close:function(){this.form.init.show=!1,this.stopDetection()},update:function(){this.parent.update()},startDetection:function(){this.tableData=[],this.requestCount=0,this.startPolling()},startPolling:function(){var t=this;this.stopDetection(),this.timer=setInterval((function(){t.fetchData()}),2e3)},stopDetection:function(){this.loading=!1,this.timer&&(clearInterval(this.timer),this.timer=null)},fetchData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,Object(r["b"])("dmsProxy/getTtestConnectionInfo?type=".concat("1"==t.form.init.data.channelType?"DX":"SX","&channelInfoId=").concat(t.form.init.data.id),r["a"].GET);case 4:a=e.sent,a?(t.tableData=[{startTimeStr:a.startTimeStr,endTimeStr:a.endTimeStr,status:a.status,msg:a.msg,typeStr:a.typeStr}],t.stopDetection()):(t.requestCount++,t.requestCount>=t.maxRequestCount&&(t.stopDetection(),t.$message.warning("未获取到检测数据"),t.requestError=!0)),e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](0),t.stopDetection(),t.$message.error("请求失败，请稍后重试。"),t.requestError=!0;case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))()},detectionTest:function(){var t=this,e="点击链路检测后，会在对端看到详情，确认点击链路检测吗？";"2"!=t.form.init.data.channelType&&"3"!=t.form.init.data.channelType||(e="确认点击链路测试吗？"),t.$confirm({content:e,okText:"确认",cancelText:"取消",onOk:function(){Object(r["b"])("dmsProxy/testConnection?type=".concat("1"==t.form.init.data.channelType?"DX":"SX","&channelInfoId=").concat(t.form.init.data.id),r["a"].POST).then((function(e){t.$message.success("开始检测"),t.startDetection()}))},onCancel:function(){}})},clickCancel:function(){this.stopDetection()}},beforeDestroy:function(){this.stopDetection()}},u=d,p=a("2877"),m=Object(p["a"])(u,n,s,!1,null,"6cdfb57a",null),h=m.exports;e["a"]=new i["a"](h)},"9c85":function(t,e,a){},a9af:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-select",{staticStyle:{height:"34px"},attrs:{filterOption:t.filterOption,"show-search":t.showSearch,disabled:t.disabled,notFoundContent:"无匹配数据",mode:"multiple",maxTagCount:t.maxTagCount,placeholder:t.placeholder,"show-arrow":!0},on:{search:function(e){return t.multipleSearch(e)},blur:t.handleOnBlur,change:t.handleChange,dropdownVisibleChange:t.dropdownVisibleChange},scopedSlots:t._u([{key:"dropdownRender",fn:function(e){return t.selectAllFlag?a("div",{},[a("v-nodes",{attrs:{vnodes:e}}),a("a-divider",{staticStyle:{margin:"4px 0"}}),a("div",{staticStyle:{padding:"0 17px",float:"right",display:"inline-block"}},[a("a",{staticClass:"ant-calendar-time-picker-btn",staticStyle:{display:"inline-block",padding:"5px 8px 6px",height:"36px"},attrs:{disabled:"view"==t.dialogType},on:{click:t.selectAll}},[t._v("全选")]),a("a",{staticClass:"margin5 ant-calendar-time-picker-btn",staticStyle:{"margin-left":"10px",display:"inline-block",padding:"5px 8px 6px",height:"36px"},attrs:{disabled:"view"==t.dialogType},on:{click:t.deselectAll}},[t._v(" 清空 ")])])],1):t._e()}}],null,!0),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},t._l(t.data_1,(function(e){return a("a-select-option",{key:e[t.optionKey],attrs:{text:e[t.titleKey],title:e[t.titleKey],value:e[t.optionKey],disabled:"view"==t.dialogType}},[t._v(" "+t._s(e[t.titleKey])+" ")])})),1)},n=[],s=a("2909"),o=(a("a9e3"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("fb6a"),a("99af"),a("d81d"),a("6062"),a("3ca3"),a("ddb0"),{name:"BMultipleSelect",props:{disabled:{type:Boolean,default:!1},dialogType:{type:String,default:""},strategyData:{type:Array,default:function(){return[]}},optionKey:{type:String,default:"id"},titleKey:{type:String,default:"name"},filterOption:{type:Function,default:function(t,e){var a=e.data,i=a.attrs;return i.text.indexOf(t)>-1}},showSearch:{type:Boolean,default:!0},maxTagCount:{type:Number,default:void 0},placeholder:{type:String,default:""},value:{},selectAllFlag:{type:Boolean,default:!0}},model:{prop:"value",event:"change"},components:{VNodes:{functional:!0,render:function(t,e){return e.props.vnodes}}},data:function(){return{data_1:[],model:[],searchValue:"",timer:null,isSearching:!1,cachedAllData:[]}},created:function(){this.model=this.value||[],this.cachedAllData=Object(s["a"])(this.strategyData),this.updateData1ForEcho()},methods:{updateData1ForEcho:function(){var t=this;this.isSearching=!1;var e=this.cachedAllData.filter((function(e){return t.model.includes(e[t.optionKey])})),a=this.cachedAllData.filter((function(e){return!t.model.includes(e[t.optionKey])})).slice(0,100-e.length);this.data_1=[].concat(Object(s["a"])(e),Object(s["a"])(a))},selectAll:function(){var t=this,e=this.data_1.map((function(e){return e[t.optionKey]}));e.length>64?(this.$message.warning("最多选64个"),this.model=e.slice(0,64)):this.model=Object(s["a"])(new Set([].concat(Object(s["a"])(this.model),Object(s["a"])(e)))),this.$emit("change",this.model,"selectAll")},deselectAll:function(){this.model=[],this.$emit("change",this.model,"deselectAll"),this.updateData1ForEcho()},handleChange:function(t){t.length>64?(this.$message.warning("最多选择64个"),this.model=t.slice(0,64)):this.model=t,this.$emit("change",this.model,"handleChange")},multipleSearch:function(t){var e=this;this.searchValue=t,this.timer||(this.timer=setTimeout((function(){e.isSearching=!0;var a=e.cachedAllData.filter((function(a){return a[e.titleKey].includes(t)}));e.data_1=a.slice(0,100),e.timer=null}),300))},dropdownVisibleChange:function(t){t||(this.searchValue="",this.updateData1ForEcho())},handleOnBlur:function(){this.searchValue="",this.updateData1ForEcho()}},watch:{value:function(t){this.model=t||[],this.updateData1ForEcho()},strategyData:function(t){this.cachedAllData=Object(s["a"])(t),this.updateData1ForEcho()}}}),r=o,l=(a("c54f"),a("2877")),c=Object(l["a"])(r,i,n,!1,null,"ca6636b8",null);e["a"]=c.exports},ae699:function(t,e,a){"use strict";var i=a("8cff"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.form.init.show?a("div",[a("a-modal",{attrs:{closable:!0,title:t.form.init.title,width:t.form.init.width,"mask-closable":!1,footer:"opinion"===t.form.name?null:void 0},model:{value:t.form.init.show,callback:function(e){t.$set(t.form.init,"show",e)},expression:"form.init.show"}},["opinion"===t.form.name?a("div",[a("a-table",{attrs:{pagination:{pageSize:15,size:"small"},rowKey:"id",columns:t.columns,"data-source":t.form.init.data.rows},scopedSlots:t._u([{key:"type",fn:function(e){return["5"==e.type?a("span",{attrs:{title:"下发"}},[t._v("下发")]):"8"==e.type?a("span",{attrs:{title:"移除"}},[t._v("移除")]):a("span",[t._v("-")])]}},{key:"gmtCreate",fn:function(e){return[e.gmtCreate?a("span",{attrs:{title:t._f("time")(e.gmtCreate,"YYYY-MM-DD HH:mm:ss")}},[t._v(t._s(t._f("time")(e.gmtCreate,"YYYY-MM-DD HH:mm:ss")))]):a("span",[t._v("-")])]}}],null,!1,198340709)})],1):a("a-form-model",{ref:"form",attrs:{model:t.form.init.data,rules:t.form.init.rules,"label-col":{span:6},"wrapper-col":{span:17}}},[""==t.form.init.data.businessId?a("a-form-model-item",{attrs:{label:"位置",prop:"location"}},[a("a-select",{attrs:{placeholder:"请选择位置"},on:{change:t.choseLocation},model:{value:t.form.init.data.location,callback:function(e){t.$set(t.form.init.data,"location",e)},expression:"form.init.data.location"}},[a("a-select-option",{attrs:{value:""}},[t._v("全部")]),"single-data"==t.form.init.data.busiType?[a("a-select-option",{attrs:{value:"Client"}},[t._v("发送端")]),a("a-select-option",{attrs:{value:"Server"}},[t._v("接收端")])]:"double-data"==t.form.init.data.busiType?[a("a-select-option",{attrs:{value:"Client"}},[t._v("客户端")]),a("a-select-option",{attrs:{value:"Server"}},[t._v("服务端")])]:[a("a-select-option",{attrs:{value:"sender"}},[t._v("发送端")]),a("a-select-option",{attrs:{value:"receiver"}},[t._v("接收端")])]],2)],1):t._e(),""==t.form.init.data.businessId?a("a-form-model-item",{attrs:{label:"服务名称",prop:"businessIds"}},[a("a-select",{attrs:{placeholder:"请选择服务",mode:"multiple",notFoundContent:"暂无数据"},scopedSlots:t._u([{key:"dropdownRender",fn:function(e){return a("div",{},[a("v-nodes",{attrs:{vnodes:e}}),a("a-divider",{staticStyle:{margin:"4px 0"}}),t.businessList.length>0?a("div",{staticStyle:{padding:"0 17px",float:"right",display:"inline-block"}},[a("a",{staticClass:"ant-calendar-time-picker-btn",staticStyle:{display:"inline-block",padding:"5px 8px 6px",height:"36px"},on:{click:t.selectAll1}},[t._v("全选")]),a("a",{staticClass:"margin5 ant-calendar-time-picker-btn",staticStyle:{"margin-left":"10px",display:"inline-block",padding:"5px 8px 6px",height:"36px"},on:{click:t.deselectAll}},[t._v("清空")])]):t._e()],1)}}],null,!1,1308062486),model:{value:t.form.init.data.businessIds,callback:function(e){t.$set(t.form.init.data,"businessIds",e)},expression:"form.init.data.businessIds"}},t._l(t.businessList,(function(e){return a("a-select-option",{key:e,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1):t._e(),a("a-form-model-item",{attrs:{label:"审批结果",prop:"result"}},[a("a-select",{attrs:{placeholder:"请选择"},on:{change:t.choseResult},model:{value:t.form.init.data.result,callback:function(e){t.$set(t.form.init.data,"result",e)},expression:"form.init.data.result"}},[a("a-select-option",{attrs:{value:"通过"}},[t._v("通过")]),a("a-select-option",{attrs:{value:"不通过"}},[t._v("不通过")])],1)],1),a("a-form-model-item",{attrs:{label:"审批意见",prop:"opinion",rules:"不通过"==t.form.init.data.result?t.input:null}},[a("a-textarea",{staticClass:"dialog-input-height",attrs:{placeholder:"请输入意见",maxLength:50,rows:4},model:{value:t.form.init.data.opinion,callback:function(e){t.$set(t.form.init.data,"opinion",e)},expression:"form.init.data.opinion"}})],1)],1),a("template",{slot:"footer"},[a("a-button",{attrs:{type:"primary",loading:t.form.init.confirmLoading},on:{click:function(e){return t.clickSave1()}}},[t._v("确定")]),a("a-button",{on:{click:function(e){return t.clickCancel()}}},[t._v("取消")])],1)],2)],1):t._e()},s=[],o=a("2909"),r=(a("99af"),a("d81d"),a("1da1")),l=(a("96cf"),a("b775"));function c(t){return d.apply(this,arguments)}function d(){return d=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(l["f"])("tool/business/approval",l["a"].POST,e));case 1:case"end":return t.stop()}}),t)}))),d.apply(this,arguments)}function u(t){return p.apply(this,arguments)}function p(){return p=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(l["f"])("tool/business/approval-opinion/".concat(e),l["a"].GET));case 1:case"end":return t.stop()}}),t)}))),p.apply(this,arguments)}var m=a("c2f2"),h=a("a00a"),f=a("ca00"),b=[{title:"类型",scopedSlots:{customRender:"type"}},{title:"意见",dataIndex:"opinion",width:"20%"},{title:"结果",dataIndex:"result"},{title:"时间",ellipsis:!0,scopedSlots:{customRender:"gmtCreate"}}],v={name:"ApprovalDialog",mixins:[m["a"]],comments:{},components:{VNodes:{functional:!0,render:function(t,e){return e.props.vnodes}}},filters:{time:f["n"]},props:{},data:function(){return{show:!1,title:"",width:710,prop:"",id:-1,columns:b,input:h["a"].input,businessList:[],form:{opinion:{title:"审批意见",width:700,show:!0,confirmLoading:!1,data:{businessId:"",rows:[]}},approval:{title:"审批",width:450,request:c,show:!0,confirmLoading:!1,data:{businessId:"",businessIds:[],opinion:"",result:void 0,busiType:"",type:"",location:""},rules:{result:h["a"].select,businessIds:h["a"].select}}}}},watch:{},created:function(){var t=this;this.showDialog(this.state,this.params),"approval"==this.state&&this.params.busiType&&Object(l["b"])("".concat(this.params.busiType,"/").concat(this.params.busiType,"/approval-all?busiState=").concat(this.params.type,"&location=").concat(this.params.location||""),l["a"].GET).then((function(e){t.businessList=Object(o["a"])(e)||[]})).catch((function(){t.businessList=[]}))},methods:{beforeShowDialog:function(t,e){var a=this;"opinion"==t?u(e.data.businessId).then((function(t){a.form.init.data.rows=t.data})):"approval"==t&&(5==e.data.type?this.form.init.data.businessId?this.form.init.title="下发审批":this.form.init.title="批量下发审批":8==e.data.type&&(this.form.init.data.businessId?this.form.init.title="移除审批":this.form.init.title="批量移除审批"))},choseResult:function(){this.$refs["form"].clearValidate()},choseLocation:function(){var t=this;this.businessList,this.form.init.data.businessIds=[],Object(l["b"])("".concat(this.form.init.data.busiType,"/").concat(this.form.init.data.busiType,"/approval-all?busiState=").concat(this.form.init.data.type,"&location=").concat(this.form.init.data.location||""),l["a"].GET).then((function(e){t.businessList=Object(o["a"])(e)||[]})).catch((function(){t.businessList=[]}))},selectAll1:function(){this.businessList&&this.businessList.length>0&&(this.form.init.data.businessIds=this.businessList.map((function(t){return t.id})))},deselectAll:function(){this.form.init.data.businessIds=[]},clickSave1:function(){var t=this;t.$refs["form"].validate((function(e){e&&(t.form.init.confirmLoading=!0,c(t.form.init.data).then((function(e){e.msg?(t.$message.warn(e.msg),t.form.init.show=!1,t.update()):(t.form.init.confirmLoading=!1,t.form.init.show=!1,t.update())})).catch((function(){t.form.init.confirmLoading=!1})))}))},close:function(){this.form.init.show=!1},update:function(){this.parent.update()}}},g=v,y=a("2877"),w=Object(y["a"])(g,n,s,!1,null,"c759ed6c",null),x=w.exports;e["a"]=new i["a"](x)},c54f:function(t,e,a){"use strict";a("9c85")}}]);