(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7df0f41a"],{"0c49":function(t,e,a){},"2cde":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-spin",{staticStyle:{"margin-left":"10px"},attrs:{spinning:t.spinning}},[a("div",{staticClass:"search",staticStyle:{"padding-left":"0"}},[a("a-card",{staticStyle:{"margin-top":"30px"},attrs:{loading:t.loading,bordered:!1}},[a("div",{staticClass:"body"},[a("div",{staticClass:"buttons"}),a("a-row",{staticClass:"table"},[a("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[a("a-card-grid",{staticClass:"grid-title",attrs:{hoverable:!1}},[t._v("系统信息")]),a("a-card-grid",{staticClass:"grid-content",attrs:{hoverable:!1}},[t.form.data.productModel&&t.form.data.productVersion?a("span",{staticStyle:{cursor:"pointer"}},[t._v(t._s(t.form.data.name)+" "+t._s(t.form.data.productModel)+" "+t._s(t.form.data.productVersion))]):a("span",{staticStyle:{cursor:"pointer"}},[t._v(t._s(t.form.data.name||"-"))])]),a("a-card-grid",{staticClass:"grid-title",attrs:{hoverable:!1}},[t._v("管控系统版本")]),a("a-card-grid",{staticClass:"grid-content",attrs:{hoverable:!1}},[a("span",{staticStyle:{cursor:"pointer"}},[t._v(t._s(t.form.data.code||"-"))]),a("span",{staticStyle:{"margin-left":"10px"}},[a("a-upload",{attrs:{name:"file",accept:".zip","show-upload-list":!1,action:t.BASE_URL+"system/dms-update"},on:{change:t.changeUpload}},[a("a-button",{attrs:{type:"primary"}},[a("a-icon",{attrs:{type:"cloud-upload"}}),t._v(" 管控升级 ")],1)],1)],1)])],1)],1)],1)])],1)]),a("a-modal",{attrs:{closable:!0,title:"更改系统名","destroy-on-close":!0,afterClose:t.clickCancel1,"mask-closable":!1},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("a-form-model",{ref:"form",attrs:{model:t.form.data1,rules:t.form.rules,"label-col":{span:t.form.init.labelSpan||5},"wrapper-col":{span:t.form.init.wrapperSpan||19}}},[a("a-form-model-item",{attrs:{label:"设备主名称",prop:"primaryName"}},[a("a-input",{attrs:{placeholder:"请输入设备主名称",maxLength:13},model:{value:t.form.data1.primaryName,callback:function(e){t.$set(t.form.data1,"primaryName",e)},expression:"form.data1.primaryName"}})],1),a("a-form-model-item",{attrs:{label:"设备子名称",prop:"subName"}},[a("a-input",{attrs:{placeholder:"请输入设备子名称",maxLength:13},model:{value:t.form.data1.subName,callback:function(e){t.$set(t.form.data1,"subName",e)},expression:"form.data1.subName"}})],1)],1),a("template",{slot:"footer"},[a("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.clickSave1()}}},[t._v("确定")]),a("a-button",{on:{click:function(e){return t.clickCancel1()}}},[t._v("取消")])],1)],2),a("a-modal",{attrs:{title:"重启管控","mask-closable":!1,keyboard:!1,closable:!1},model:{value:t.visible2,callback:function(e){t.visible2=e},expression:"visible2"}},[a("p",[t._v("上传成功，请重启管控")]),a("template",{slot:"footer"},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.clickSave2()}}},[t._v("重启")])],1)],2),a("a-modal",{attrs:{title:"客户端状态",width:"80%","mask-closable":!1,keyboard:!1,footer:null},model:{value:t.visible3,callback:function(e){t.visible3=e},expression:"visible3"}},[a("a-table",{attrs:{pagination:{pageSize:16,size:"small"},rowKey:"id",columns:t.clientColumns,"data-source":t.clientDate},scopedSlots:t._u([{key:"updateTime",fn:function(e){return[null!=e.updateTime?a("span",{attrs:{title:t._f("time")(e.updateTime,"YYYY-MM-DD HH:mm:ss")}},[t._v(t._s(t._f("time")(e.updateTime,"YYYY-MM-DD HH:mm:ss")))]):a("span",[t._v("-")])]}},{key:"updateState",fn:function(e){return[e.updateState?a("span",{attrs:{title:e.updateState}},[t._v(t._s(e.updateState))]):a("span",[t._v("未知状态")])]}},{key:"operations",fn:function(e){return[a("div",{staticStyle:{display:"flex","flex-wrap":"wrap",gap:"4px"}},[a("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.connectionTest(e)}}},[t._v("连接测试")]),a("a-button",{staticClass:"oper-margin",attrs:{type:"primary",size:"small"},on:{click:function(a){return t.manualUpgrade(e)}}},[t._v("手动升级")]),a("a-button",{staticClass:"oper-margin",attrs:{type:"danger",size:"small"},on:{click:function(a){return t.deleteClientIp(e.ip)}}},[t._v("删除")])],1)]}}])})],1)],1)},s=[],n=(a("ac1f"),a("841c"),a("b0c0"),a("caad"),a("2532"),a("1276"),a("a00a")),o=a("bc3a"),r=a.n(o),l=a("905c"),c=a("ca00"),d=a("c2f2"),m=a("ba79"),u=a("b775"),f=[{title:"客户端IP",width:"15%",dataIndex:"ip"},{title:"客户端端口",width:"15%",dataIndex:"port"},{title:"版本",width:"15%",dataIndex:"version"},{title:"更新时间",width:"15%",scopedSlots:{customRender:"updateTime"}},{title:"更新状态",width:"15%",scopedSlots:{customRender:"updateState"}},{title:"操作",width:"25%",scopedSlots:{customRender:"operations"}}],p={name:"SystemInfo",mixins:[d["a"]],components:{},data:function(){return{visible:!1,visible2:!1,visible3:!1,clientColumns:f,spinning:!1,loading:!1,systemNameList:[],clientDate:[],form:{url:"".concat(m["b"],"system/license-update"),file:{},data:{},data1:{name:void 0,primaryName:"",subName:""},rules:{primaryName:n["a"].input}}}},filters:{time:c["n"],shortText:c["m"]},created:function(){var t=this;this.getLicense(),Object(l["c"])().then((function(e){t.systemNameList=e.data.configVOs}))},methods:{getLicense:function(){var t=this;t.loading=!0,Object(l["b"])().then((function(e){var a=e.data;t.form.data=a,t.loading=!1}))},handleClick:function(){this.disabled||this.$refs.input.click()},handleChange:function(t){var e=this,a=this,i=t.target.files;if(i&&0!==i.length){a.form.file=i[0];var s=new FormData;s.append("file",a.form.file),r()({method:"POST",url:a.form.url,data:s,transformRequest:[function(t){return t}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){"SUCCESS"==t.state?(a.$message.success("升级成功！",3),a.update()):(e.$message.error(t.msg),e.form.file={})})).catch((function(){a.form.file={}}))}},changeUpload:function(t){"done"==t.file.status?"FAIL"==t.file.response.state?this.$message.error(t.file.response.msg):"SUCCESS"==t.file.response.state?this.visible2=!0:this.$message.error(t.file.response.state):"error"==t.file.status&&this.$message.error(t.file.response)},changeClientUpload:function(t){this.spinning=!0,"done"==t.file.status?(this.spinning=!1,"FAIL"==t.file.response.state?this.$message.error(t.file.response.msg):"SUCCESS"==t.file.response.state?(this.$message.success("客户端文件上传成功！"),this.getLicense()):this.$message.error(t.file.response.state)):"error"==t.file.status&&(this.spinning=!1,this.$message.error(t.file.response))},clickSave2:function(){this.visible2=!1,this.$message.success("正在更新和重启，请稍后"),this.$router.push("/login")},manualUpgrade:function(t){var e=this;Object(u["b"])("system/notify-update?clientIp=".concat(t.ip),u["a"].POST).then((function(t){e.$confirm({content:t,cancelButtonProps:{style:{display:"none"}},onOk:function(){}})})).catch((function(){}))},connectionTest:function(t){var e=this.$createElement,a=this;Object(u["b"])("client/ping?clientIp=".concat(t.ip),u["a"].GET).then((function(t){a.$confirm({icon:function(){return null},content:e("div",{style:"font-size: 16px;"},[t]),cancelButtonProps:{style:{display:"none"}},onOk:function(){Object(l["a"])().then((function(t){t&&(a.clientDate=t.data)}))}})})).catch((function(){}))},deleteClientIp:function(t){var e=this;e.$confirm({content:"确认删除吗？",onOk:function(){Object(u["b"])("client/delclient?clientIp=".concat(t),u["a"].POST).then((function(t){t&&(e.$message.success("删除成功"),e.search={clientIp:"",search:""},Object(l["a"])().then((function(t){t&&(e.clientDate=t.data)})))}))}})},viewAllClient:function(){var t=this;this.clientDate=[],this.visible3=!0,Object(l["a"])().then((function(e){e&&(t.clientDate=e.data)}))},update:function(){var t=this;t.loading=!0,t.form={file:{name:""},data:{}},Object(l["b"])().then((function(e){var a=e.data;t.form.data=a,t.loading=!1}))},changeName:function(){this.visible=!0;var t=this.form.data.name;if(0!=t.length)if(t.includes("-",0)){var e=t.split("-");this.form.data1.primaryName=e[0],this.form.data1.subName=e[1]}else this.form.data1.primaryName=t},clickSave1:function(){var t=this,e=this;e.$refs["form"].validate((function(a){if(a){e.loading=!0;var i={};i=""==e.form.data1.subName?{name:e.form.data1.primaryName}:{name:e.form.data1.primaryName+"-"+e.form.data1.subName},Object(l["d"])(i).then((function(a){"success"==a.data.msg?(e.visible=!1,e.loading=!1,e.$refs["form"].resetFields(),t.$router.go(0)):(e.$message.error(a.data.msg),e.loading=!1)})).catch((function(){e.visible=!1,e.loading=!1}))}}))},clickCancel1:function(){this.visible=!1,this.$refs["form"].resetFields()}}},h=p,b=(a("db75"),a("2877")),g=Object(b["a"])(h,i,s,!1,null,"2ab1079d",null);e["default"]=g.exports},db75:function(t,e,a){"use strict";a("0c49")}}]);