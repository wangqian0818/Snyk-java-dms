(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72bb3389"],{"0618":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-table",{ref:"table",staticClass:"AStockOutDetailTable",attrs:{columns:e.columns,dataSource:e.data,rowKey:e.rowKey,bordered:e.bordered,loading:e.loading,size:e.size,"row-selection":e.rowSelection,pagination:{current:e.page,pageSize:e.pageSize,total:e.total,pageSizeOptions:e.pageSizeOptions,onChange:e.onPageChange,onShowSizeChange:e.onShowSizeChange,showSizeChanger:e.showSizeChanger,showQuickJumper:e.showQuickJumper,hideOnSinglePage:e.hideOnSinglePage,showTotal:e.showTotal,size:e.size,showLessItems:e.showLessItems},scroll:{y:e.tableHeight}},scopedSlots:e._u([{key:"number",fn:function(t,n,a){return e.showIndex?[e._v(" "+e._s(a+1)+" ")]:void 0}},e._l(Object.keys(e.$scopedSlots).filter((function(e){return"expandedRowRender"!==e})),(function(t){return{key:t,fn:function(n,a,i){return[e._t(t,null,null,{text:n,record:a,index:i})]}}})),{key:e.$scopedSlots.expandedRowRender?"expandedRowRender":"",fn:function(t,n,a,i){return[e._t(e.$scopedSlots.expandedRowRender?"expandedRowRender":"",null,null,{record:t,index:n,indent:a,expanded:i})]}}],null,!0)},[e._l(Object.keys(e.$slots),(function(t){return n("template",{slot:t},[e._t(t)],2)}))],2)],1)},i=[],r=(n("a9e3"),n("9b10")),o={name:"BFixedTable",mixins:[r["a"]],props:{columns:{type:Array,required:!0},pageSizeOptions:{type:Array,default:function(){return["10","20","50","100","200"]}},showIndex:{type:Boolean,default:!0},rowKey:String,tableHeight:{type:Number,default:550},beautyScroller:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},total:{type:Number,default:0},bordered:{type:Boolean,default:!0},initPage:{type:Number,default:1},initPageSize:{type:Number,default:10},showOuterBorder:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},showTotal:{type:Function,default:function(e){return"总共".concat(e,"条")}},showQuickJumper:{type:Boolean,default:!0},showSizeChanger:{type:Boolean,default:!0},hideOnSinglePage:{type:Boolean,default:!1},showLessItems:{type:Boolean,default:!1},size:{type:String,default:"default"},rootData:{type:Object,default:function(){}},rowSelection:{type:Object,default:function(){return null}}},data:function(){return{page:1,pageSize:10}},mounted:function(){this.fixedHeight(),this.updateData(),this.addIndex(),this.beautyScroller&&this.beautyScroll(),this.showOuterBorder&&this.setOutBorder(),this.page=this.initPage,this.pageSize=this.initPageSize},watch:{initPage:function(e){this.page!==e&&(this.page=e,this.updateData())},initPageSize:function(e){this.pageSize!==e&&(this.pageSize=e,this.updateData())},columns:function(){this.addIndex()},total:function(){this.fixedHeight()},tableHeight:function(){this.fixedHeight()}},methods:{addIndex:function(){this.showIndex&&this.columns.length>0&&"序号"!==this.columns[0].title&&this.columns.unshift({title:"序号",scopedSlots:{customRender:"number"},width:80})},fixedHeight:function(){var e=this,t=this.$refs.table.$el;this.total>0?this.modifyStyleByClass(t,"ant-table-body",{"min-height":"".concat(this.tableHeight,"px"),"max-height":"".concat(this.tableHeight,"px")}):(this.modifyStyleByClass(t,"ant-table-body",{"min-height":"0px","max-height":"".concat(this.tableHeight,"px")}),this.$nextTick((function(){e.modifyStyleByClass(t,"ant-table-placeholder",{"min-height":"".concat(e.tableHeight,"px"),"max-height":"".concat(e.tableHeight,"px")})})))},setOutBorder:function(){var e;null===(e=this.$refs.table.$el.classList)||void 0===e||e.add("ant-card-bordered")},beautyScroll:function(){var e=this.$refs.table.$el.querySelector(".ant-table-hide-scrollbar");e&&(e.classList.add("beauty-scroll"),e.style["margin-bottom"]="",e.style["padding-bottom"]="",e.style["min-width"]="");var t=this.$refs.table.$el.querySelector(".ant-table-body");null===t||void 0===t||t.classList.add("beauty-scroll")},onPageChange:function(e,t){this.page=e,this.pageSize=t,this.updateData()},onShowSizeChange:function(e,t){this.page=1,this.pageSize=t,this.updateData()},updateData:function(){this.$emit("change",{page:this.page,pageSize:this.pageSize,rootData:this.rootData})}}},s=o,c=(n("156c"),n("2877")),l=Object(c["a"])(s,a,i,!1,null,"eb2634aa",null);t["a"]=l.exports},"0fa0":function(e,t,n){"use strict";n("c71e")},"156c":function(e,t,n){"use strict";n("1bbf")},"1bbf":function(e,t,n){},2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("6b75");function i(e){if(Array.isArray(e))return Object(a["a"])(e)}n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var o=n("06c5");n("d9e2");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return i(e)||r(e)||Object(o["a"])(e)||s()}},"56cf":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"h",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return g})),n.d(t,"a",(function(){return b})),n.d(t,"f",(function(){return w}));var a=n("1da1"),i=(n("96cf"),n("99af"),n("e9c4"),n("b775"));function r(e,t,n){return o.apply(this,arguments)}function o(){return o=Object(a["a"])(regeneratorRuntime.mark((function e(t,n,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["f"])("protection/intrusion-configs?offset=".concat((t-1)*n,"&limit=").concat(n).concat(a||""),i["a"].GET));case 1:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function s(e,t,n){return c.apply(this,arguments)}function c(){return c=Object(a["a"])(regeneratorRuntime.mark((function e(t,n,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["f"])("protection/device-ddoses?offset=".concat((t-1)*n,"&limit=").concat(n).concat(a||""),i["a"].GET));case 1:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function l(e,t,n){return u.apply(this,arguments)}function u(){return u=Object(a["a"])(regeneratorRuntime.mark((function e(t,n,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["f"])("protection/waf-configs?offset=".concat((t-1)*n,"&limit=").concat(n,"&search=").concat(a||""),i["a"].GET));case 1:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function d(e){return f.apply(this,arguments)}function f(){return f=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["f"])("protection/waf-config/".concat(t),i["a"].GET));case 1:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return h=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=JSON.parse(JSON.stringify(t)),e.abrupt("return",Object(i["f"])("device/border-device-security",i["a"].PUT,n));case 2:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return m=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.id,e.abrupt("return",Object(i["f"])("device/border-device-security/send/".concat(n),i["a"].PUT));case 2:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function b(e){return y.apply(this,arguments)}function y(){return y=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["f"])("protection/device-ddos/ddos-config/".concat(t),i["a"].GET));case 1:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function w(e){return v.apply(this,arguments)}function v(){return v=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i["f"])("tool/border-device-net-iface/raw-ifaces?deviceId=".concat(t,"&type=1"),i["a"].GET));case 1:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}},"61f9":function(e,t,n){},8313:function(e,t,n){},a1d7:function(e,t,n){},ac68:function(e,t,n){"use strict";n.r(t);var a,i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"page-menu"},[n("a-radio-group",{attrs:{value:e.menu},on:{change:e.handleMenuChange}},[e._l(e.menuLists,(function(t,a){return[e.permissionDeviceMenu.includes(t.value)?n("a-radio-button",{key:a,attrs:{value:t.value}},[e._v(e._s(t.menuName))]):e._e()]}))],2)],1),n("a-card",{staticStyle:{clear:"both"}},[1==e.menu?n("BWafConfig"):2==e.menu?n("BWafUpgrade"):e._e()],1)],1)},r=[],o=n("ade3"),s=(n("d3b7"),n("159b"),n("25eb"),n("a9e3"),n("c2f2")),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-spin",{staticStyle:{"margin-left":"10px"},attrs:{spinning:e.spinning,tip:"正在升级，请稍后！"}},[n("div",{staticClass:"search",staticStyle:{"padding-left":"0"}},[n("a-card",{staticStyle:{"margin-top":"30px"},attrs:{loading:e.loading,bordered:!1}},[n("div",{staticClass:"body"},[n("div",{staticClass:"buttons"}),n("a-row",{staticClass:"table"},[n("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[n("a-card-grid",{staticClass:"grid-title",attrs:{hoverable:!1}},[e._v("WAF更新时间")]),n("a-card-grid",{staticClass:"grid-content",attrs:{hoverable:!1}},[n("span",{staticStyle:{cursor:"pointer"}},[e._v(e._s(e._f("time")(e.form.data.beginTimestamp,"YYYY-MM-DD HH:mm:ss")))])]),n("a-card-grid",{staticClass:"grid-title",attrs:{hoverable:!1}},[e._v("WAF版本")]),n("a-card-grid",{staticClass:"grid-content",attrs:{hoverable:!1}},[n("span",{staticStyle:{cursor:"pointer"}},[e._v(e._s(e.form.data.version||"-"))]),e.readOnly?e._e():n("span",{staticStyle:{"margin-left":"10px"}},[n("a-upload",{attrs:{name:"file",accept:".gz","show-upload-list":!1,action:e.BASE_URL+"protection/waf-upgrade"},on:{change:e.changeUpload}},[n("a-button",{attrs:{type:"primary"}},[n("a-icon",{attrs:{type:"cloud-upload"}}),e._v(" WAF升级 ")],1)],1)],1)])],1)],1)],1)])],1)])],1)},l=[],u=(n("4de4"),n("b0c0"),n("a00a"),n("bc3a"),n("ca00")),d=(n("ba79"),n("b775")),f={name:"SystemInfo",mixins:[s["a"]],components:{},data:function(){return{readOnly:!1,spinning:!1,loading:!1,systemNameList:[],clientDate:[],form:{file:{},data:{}}}},filters:{time:u["n"],shortText:u["m"]},created:function(){this.readOnly=JSON.parse(JSON.parse(localStorage.getItem("waf")).filter((function(e){return"waf-upgrade"==e.name}))[0].readonly)||!1,this.update()},methods:{update1:function(){var e=this;e.loading=!0,Object(d["b"])("protection/waf-upgrades",d["a"].GET).then((function(t){e.form.data=t,e.loading=!1})).catch((function(){e.loading=!1}))},changeUpload:function(e){this.spinning=!0,"done"==e.file.status?"FAIL"==e.file.response.state?(this.$message.error(e.file.response.msg),this.spinning=!1):"SUCCESS"==e.file.response.state?(this.$message.success("操作成功，正在升级WAF，请稍后查看"),this.spinning=!1,this.update()):(this.$message.error(e.file.response.state),this.spinning=!1):"error"==e.file.status&&(this.$message.error(e.file.response),this.spinning=!1)},update:function(){var e=this;e.loading=!0,e.form={file:{name:""},data:{}},this.update1()}}},p=f,h=(n("fd99"),n("2877")),g=Object(h["a"])(p,c,l,!1,null,"2218cc1a",null),m=g.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-card",{staticStyle:{"margin-top":"30px"}},[n("div",{staticClass:"body"},[n("a-spin",{attrs:{spinning:e.spinning,tip:"正在导入数据，请稍等！"}},[n("div",{staticClass:"buttons"},[n("a-button",{attrs:{type:"primary",icon:"sync"},on:{click:function(t){return e.clickSearch(1)}}},[e._v("刷新")])],1),n("div",{staticClass:"title"},[e._v("查询结果")]),n("a-row",{staticClass:"table"},[n("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[n("b-fixed-table",{attrs:{columns:e.columns,rowKey:"id",data:e.table.data,total:e.table.total,loading:e.loading,"init-page":e.page},on:{change:e.tableParamChanged},scopedSlots:e._u([{key:"operations",fn:function(t){var a=t.record;return[n("span",{staticClass:"oper-margin"},[e.readOnly?e._e():n("span",{staticClass:"oper",on:{click:function(t){return e.config(a)}}},[e._v("配置")])])]}}])})],1)],1)],1)],1)]),n("a-modal",{attrs:{width:"800px","body-style":{maxHeight:"800px",overflowY:"auto"},closable:!0,title:"配置","mask-closable":!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("a-form-model",{ref:"form",attrs:{model:e.form.data,rules:e.form.rules,"label-col":{span:e.form.labelSpan||8},"wrapper-col":{span:e.form.wrapperSpan||16}}},[n("a-form-model-item",{attrs:{label:"配置规则",prop:"wafConfigs"}},[n("a-tree",{attrs:{"tree-data":e.form.data.wafConfigs,checkedKeys:e.selectedRowKeys,replaceFields:{children:"children",title:"zhName",key:"name"},checkable:""},on:{check:e.onTreeCheck}})],1),n("a-form-model-item",{attrs:{label:"是否封锁IP地址",prop:"wafAction"}},[n("a-checkbox",{model:{value:e.form.data.wafAction,callback:function(t){e.$set(e.form.data,"wafAction",t)},expression:"form.data.wafAction"}},[e._v("封锁IP地址")])],1),n("a-form-model-item",{attrs:{label:"是否只检测不阻断",prop:"detectionOnly"}},[n("a-checkbox",{model:{value:e.form.data.detectionOnly,callback:function(t){e.$set(e.form.data,"detectionOnly",t)},expression:"form.data.detectionOnly"}},[e._v("只检测不阻断")])],1)],1),n("template",{slot:"footer"},[n("a-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:function(t){return e.clickSave()}}},[e._v("保存及下发")]),n("a-button",{on:{click:function(t){return e.clickCancel()}}},[e._v("取消")])],1)],2)],1)},y=[],w=n("2909"),v=n("5530"),S=(n("7db0"),n("ac1f"),n("1276"),n("99af"),n("6062"),n("3ca3"),n("ddb0"),n("caad"),n("2532"),n("a15b"),n("0618")),x=n("56cf"),O=[{title:"设备名称",dataIndex:"deviceName"},{title:"操作",scopedSlots:{customRender:"operations"}}],k={name:"securityMgr",components:{BFixedTable:S["a"]},mixins:[s["a"]],data:function(){return{readOnly:!1,columns:O,loading:!1,confirmLoading:!1,spinning:!1,visible:!1,search:{deviceId:"",channelInfoId:""},table:{data:[],total:0},selectedRowKeys:[],expandedKeys:[],form:{data:{id:"",names:[],wafAction:!1,detectionOnly:!1,wafBlockTime:"",wafBlockUnit:"",wafConfigs:[]},rules:{}}}},created:function(){try{var e=localStorage.getItem("waf");if(e){var t=JSON.parse(e),n=t.find((function(e){return"waf-config"===e.name}));this.readOnly=!!n&&JSON.parse(n.readonly)}else this.readOnly=!1}catch(a){this.readOnly=!1}this.clickSearch(1)},mounted:function(){this.detectDeviceType()},methods:{tableParamChanged:function(e){this.page=e.page,this.pageSize=e.pageSize,this.update(e.page,e.pageSize)},clickSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.update(e,this.pageSize||10)},update:function(e,t){var n=this;this.page=e||1,this.pageSize=t||10,this.loading=!0,Object(x["h"])(this.page,this.pageSize).then((function(e){var t=e.data;t&&(n.table.total=t.total||0,n.table.data=t.rows||[]),n.loading=!1})).catch((function(){n.loading=!1}))},config:function(e){var t=this,n=this,a=e.id;this.loading=!0,this.expandedKeys=[],Object(x["g"])(a).then((function(e){e.data&&(n.form.data=Object(v["a"])({},e.data),e.data.names?n.selectedRowKeys=e.data.names.split(","):n.selectedRowKeys=[]),n.visible=!0})).finally((function(){t.loading=!1}))},onTreeCheck:function(e){this.selectedRowKeys=e},clickCancel:function(){this.visible=!1,this.$refs["form"]&&this.$refs["form"].clearValidate(),this.form.data={id:"",names:[],wafAction:!1,detectionOnly:!1,wafBlockTime:"",wafBlockUnit:"",wafConfigs:[]},this.selectedRowKeys=[],this.expandedKeys=[]},getAllLeafNodeNames:function(e){var t=this,n=[];return Array.isArray(e)?(e.forEach((function(e){e.children&&0!==e.children.length?n=n.concat(t.getAllLeafNodeNames(e.children)):n.push(e.name)})),n):n},getParentKeys:function(e,t){var n=[],a=function e(t,a){if(t.children&&t.children.length){var i=t.children.some((function(t){return t.name===a||e(t,a)}));i&&n.push(t.name)}return!1};return e.forEach((function(e){t.forEach((function(t){a(t,e)}))})),Object(w["a"])(new Set(n))},clickSave:function(){var e=this,t=this;if(0!==this.selectedRowKeys.length){var n=this.getAllLeafNodeNames(t.form.data.wafConfigs),a=t.selectedRowKeys.filter((function(e){return n.includes(e)})),i=Object(v["a"])({},t.form.data);i.names=a.join(","),this.confirmLoading=!0,Object(d["b"])("protection/put/waf-config/config",d["a"].POST,i).then((function(){t.$message.success("保存成功，如果当前无开启WAF的HTTP业务，配置不下发"),t.clickCancel(),t.clickSearch(1)})).catch((function(e){t.$message.error("配置失败，请重试")})).finally((function(){e.confirmLoading=!1}))}else this.$message.warning("请至少选择一条规则！")}},watch:{$route:function(e,t){var n=this;t.path!==e.path&&this.$nextTick((function(){n.dialog&&n.dialog.close()}))}},beforeDestroy:function(){this.dialog&&this.dialog.close()}},C=k,_=(n("cd85"),n("0fa0"),Object(h["a"])(C,b,y,!1,null,"52bf2558",null)),j=_.exports,R="waf:m",z=(a={name:"",components:{BWafUpgrade:m,BWafConfig:j},mixins:[s["a"]],filters:{},props:{},data:function(){return{permissionDeviceMenu:[],menuLists:[{id:1,value:1,menuName:"WAF配置"},{id:2,value:2,menuName:"WAF升级"}],menu:""}},created:function(){var e=this,t=JSON.parse(localStorage.getItem("waf"));t.forEach((function(t){var n="";n=Number.parseInt(t.index),e.permissionDeviceMenu.push(n)})),this.menu=+sessionStorage.getItem(R)||Number.parseInt(this.permissionDeviceMenu[0]),this.switchMenu(this.menu)},computed:{},mounted:function(){},watch:{$route:function(e,t){var n=this;t.path!==e.path&&this.$nextTick((function(){n.dialog&&n.dialog.close()}))},menu:function(e){var t=this,n=JSON.parse(localStorage.getItem("waf"));n.forEach((function(n){Number.parseInt(n.index)==e&&(t.readOnly=n.readonly)}))}},methods:{handleMenuChange:function(e){this.switchMenu(e.target.value)},switchMenu:function(e){this.menu=e,sessionStorage.setItem(R,this.menu)}}},Object(o["a"])(a,"watch",{$route:function(e,t){var n=this;t.path!==e.path&&this.$nextTick((function(){n.dialog&&n.dialog.close()}))}}),Object(o["a"])(a,"beforeDestroy",(function(){this.dialog&&this.dialog.close()})),a),$=z,T=(n("bff3"),n("d31a"),Object(h["a"])($,i,r,!1,null,"565b7ff8",null));t["default"]=T.exports},bf8f:function(e,t,n){},bff3:function(e,t,n){"use strict";n("61f9")},c71e:function(e,t,n){},cd85:function(e,t,n){"use strict";n("bf8f")},d31a:function(e,t,n){"use strict";n("a1d7")},fd99:function(e,t,n){"use strict";n("8313")}}]);