(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b12321a"],{"109f":function(t,a,e){},3331:function(t,a,e){},"834e":function(t,a,e){"use strict";e("109f")},ab76:function(t,a,e){"use strict";e("3331")},beff:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("a-spin",{attrs:{spinning:t.spinning}},[e("a-card",{staticStyle:{"margin-top":"30px"}},[e("div",{staticClass:"search"},[e("div",{staticClass:"title"},[t._v("查询条件")]),e("div",{staticClass:"content"},[e("span",{staticClass:"outer"},[t._v("查询字段:")]),e("span",{staticClass:"inner"},[e("a-select",{staticStyle:{width:"130px"},on:{change:t.choseFieldName},model:{value:t.search.fieldName,callback:function(a){t.$set(t.search,"fieldName",a)},expression:"search.fieldName"}},t._l(t.fieldNameList,(function(a,i){return e("a-select-option",{key:i,attrs:{value:a.value}},[t._v(t._s(a.name))])})),1)],1),e("span",{staticClass:"outer"},[t._v("关键字:")]),e("span",{staticClass:"inner"},[e("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入关键字"},on:{pressEnter:t.clickSearch},model:{value:t.search.search,callback:function(a){t.$set(t.search,"search",a)},expression:"search.search"}})],1),e("span",{staticClass:"outer"},[e("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:function(a){return t.clickSearch(1)}}},[t._v("查询")])],1),e("span",{staticClass:"outer"},[e("a-button",{staticClass:"button",on:{click:t.resetSearch}},[t._v("重置")])],1)])]),e("div",{staticClass:"body"},[e("div",{staticClass:"buttons"},[e("b-date-range",{attrs:{value:t.dateValue},on:{change:t.dateRangeChange1}}),t.readOnly||"logadmin"!=t.userName?t._e():e("a-button",{attrs:{type:"primary",icon:"export"},on:{click:function(a){return t.exports()}}},[t._v("批量导出")]),"logadmin"==t.userName&&"true"==t.logCanDeleted?[e("a-button",{attrs:{type:"primary",icon:"delete"},on:{click:function(a){return t.deleteLog()}}},[t._v("删除")])]:t._e(),e("a-button",{attrs:{type:"primary",icon:"sync"},on:{click:function(a){return t.clickSearch1()}}},[t._v("刷新")])],2),e("div",{staticClass:"title"},[t._v("查询结果")]),e("a-row",{staticClass:"table"},[e("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[e("b-fixed-table",{attrs:{columns:t.columns,rowKey:"key",data:t.table.data,total:t.table.total,loading:t.loading,"init-page":t.page},on:{change:t.tableParamChanged},scopedSlots:t._u([{key:"time",fn:function(a){var i=a.record;return[e("span",[t._v(t._s(t._f("convertTime")(i.time)))])]}},{key:"action",fn:function(a){var i=a.record;return["Drop"==i.action?e("span",[t._v("丢弃")]):"Forward"==i.action?e("span",[t._v("通过")]):e("span",[t._v(t._s(i.action))])]}},{key:"srFlow",fn:function(a){var i=a.record;return[e("span",[t._v(t._s(i.upBytes||"0")+"/"+t._s(i.downBytes||"0"))])]}},{key:"srPackage",fn:function(a){var i=a.record;return[e("span",[t._v(t._s(i.upPkts||"0")+"/"+t._s(i.downPkts||"0"))])]}},{key:"operations",fn:function(a){var i=a.record;return[e("span",{staticClass:"oper"},[e("span",{on:{click:function(a){return t.view(i)}}},[t._v("详情")])])]}}])})],1)],1)],1)])],1)],1)},n=[],r=(e("b0c0"),e("ac1f"),e("841c"),e("c1df")),s=e.n(r),o=e("e6e5"),c=e("c2f2"),l=e("0618"),m=e("8cff"),d=function(){var t=this,a=t.$createElement,e=t._self._c||a;return t.form.init.show?e("div",[e("a-modal",{attrs:{closable:!0,title:t.form.init.title,width:t.form.init.width,"mask-closable":!1},model:{value:t.form.init.show,callback:function(a){t.$set(t.form.init,"show",a)},expression:"form.init.show"}},["delete"===t.form.name?e("div",[t._v(" 确定删除？ ")]):e("a-form-model",{ref:"form",class:{views:"view"===t.form.name},attrs:{model:t.form.init.data,rules:t.form.init.rules,"label-col":{span:t.form.init.labelSpan||6},"wrapper-col":{span:t.form.init.wrapperSpan||18}}},[void 0!==t.form.init.data.sip?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"源地址",prop:"sip"}},[e("span",[t._v(t._s(t.form.init.data.sip||"-"))])]):t._e(),void 0!==t.form.init.data.dip?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"目的地址",prop:"dip"}},[e("span",[t._v(t._s(t.form.init.data.dip||"-"))])]):t._e(),void 0!==t.form.init.data.protocol?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"IP协议",prop:"protocol"}},[e("span",[t._v(t._s(t.form.init.data.protocol||"-"))])]):t._e(),void 0!==t.form.init.data.time?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"时间",prop:"time"}},[e("span",[t._v(t._s(t._f("convertTime")(t.form.init.data.time)))])]):t._e(),void 0!==t.form.init.data.appProtocol?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"应用层协议",prop:"appProtocol"}},[e("span",[t._v(t._s(t.form.init.data.appProtocol||"-"))])]):t._e(),void 0!==t.form.init.data.ruleName?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"规则名称",prop:"ruleName"}},[e("span",[t._v(t._s(t.form.init.data.ruleName||"-"))])]):t._e(),void 0!==t.form.init.data.action?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"动作",prop:"action"}},[e("span",[t._v(t._s(t.form.init.data.action||"-"))])]):t._e(),void 0!==t.form.init.data.limit?e("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"条数",prop:"limit"}},[e("a-input",{staticStyle:{width:"100%"},attrs:{maxLength:10},model:{value:t.form.init.data.limit,callback:function(a){t.$set(t.form.init.data,"limit",a)},expression:"form.init.data.limit"}})],1):t._e()],1),e("template",{slot:"footer"},["export"===t.form.name?e("a-button",{attrs:{type:"primary"},on:{click:function(a){return t.exportData()}}},[t._v("导出")]):t._e(),e("a-button",{on:{click:function(a){return t.clickCancel()}}},[t._v("关闭")])],1)],2)],1):t._e()},p=[],f=(e("00b4"),e("99af"),e("eb60")),u=e("d9f9"),h={name:"AuditTrafficLogDialog",components:{},mixins:[c["a"]],filters:{convertSecurityRank:u["x"],convertTime:u["C"],convertAuditEventLogExceptionType:u["e"],convertNoticeType:u["v"],convertDisposeType:u["k"]},props:{},data:function(){return{zhCN:f["a"],spinning:!1,state:"",params:"",parent:"",form:{view:{title:"详情",width:750,request:"",show:!0,data:{sip:"",dip:"",protocol:"",time:"",appProtocol:"",ruleName:"",action:""},rules:{}},export:{title:"导出",width:500,request:"",show:!0,exportUrl:"traffic-log/export-data",timeRange:[s()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),s()().format("YYYY-MM-DD HH:mm:ss")],ranges:{},data:{startDate:s()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),endDate:s()().format("YYYY-MM-DD HH:mm:ss"),limit:1,offset:0,search:""},rules:{}}}}},created:function(){this.showDialog(this.state,this.params)},methods:{beforeShowDialog:function(){},beforeSave:function(){},close:function(){this.form.init.show=!1},disabledDate:function(t){return t>s()().endOf("day")},dateChange:function(t){this.form.init.data.startDate=t[0].format("YYYY-MM-DD HH:mm:ss"),this.form.init.data.endDate=t[1].format("YYYY-MM-DD HH:mm:ss")},exportData:function(){var t=this;if(/^[0-9]+?$/.test(t.form.init.data.limit))if(t.form.init.data.limit>1e4||t.form.init.data.limit<1)t.$message.error("导出条数应在[1~10000]内");else{var a=t.params.search.fieldName,e=t.params.search.search||"",i=t.form.init.data.offset,n=t.form.init.data.limit,r=t.params.search.startDate,s=t.params.search.endDate,o="".concat(t.BASE_URL).concat(t.form.export.exportUrl,"?search=").concat(e,"&fieldName=").concat(a,"&offset=").concat(i,"&limit=").concat(n,"&startDate=").concat(r,"&endDate=").concat(s);window.open(o,"_blank"),this.close()}else this.$message.error("导出条数请输入正整数")},update:function(){var t=this;t.parent.update()}}},g=h,v=(e("ab76"),e("2877")),b=Object(v["a"])(g,d,p,!1,null,"4dbf2714",null),_=b.exports,D=new m["a"](_),y=e("1da1"),w=(e("96cf"),e("b775"));function Y(t,a,e,i){return x.apply(this,arguments)}function x(){return x=Object(y["a"])(regeneratorRuntime.mark((function t(a,e,i,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(w["f"])("traffic-log/logs?offset=".concat((a-1)*e,"&limit=").concat(e).concat(i,"&total=").concat(n),w["a"].GET));case 1:case"end":return t.stop()}}),t)}))),x.apply(this,arguments)}function S(t,a,e,i){return k.apply(this,arguments)}function k(){return k=Object(y["a"])(regeneratorRuntime.mark((function t(a,e,i,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(w["f"])("traffic-log/del-logs?search=".concat(a,"&fieldName=").concat(e,"&startDate=").concat(i,"&endDate=").concat(n),w["a"].DELETE));case 1:case"end":return t.stop()}}),t)}))),k.apply(this,arguments)}function C(t){return H.apply(this,arguments)}function H(){return H=Object(y["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(w["f"])("traffic-log/log",w["a"].GET,a));case 1:case"end":return t.stop()}}),t)}))),H.apply(this,arguments)}var M=[{title:"设备",dataIndex:"deviceName"},{title:"源地址",dataIndex:"sip"},{title:"目的地址",dataIndex:"dip"},{title:"源端口",dataIndex:"sport"},{title:"目的端口",dataIndex:"dport"},{title:"传输层协议",dataIndex:"protocol"},{title:"发送/接收流量(B)",scopedSlots:{customRender:"srFlow"},width:150},{title:"发包/接包(个)",scopedSlots:{customRender:"srPackage"}},{title:"时间",ellipsis:!0,scopedSlots:{customRender:"time"}},{title:"动作",scopedSlots:{customRender:"action"}}],N={name:"AuditTrafficLog",components:{BFixedTable:l["a"],BDateRange:o["a"]},mixins:[c["a"]],filters:{convertTime:u["C"]},props:{},data:function(){return{readOnly:!1,columns:M,loading:!1,spinning:!1,exportUrl:"traffic-log/export-data",dialog:D,getRecord:C,tableList:Y,deleteList:S,userName:"",logCanDeleted:!1,dateValue:[s()().startOf("day"),s()()],search:{startDate:s()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),endDate:s()().format("YYYY-MM-DD HH:mm:ss")},fieldNameList:[{name:"设备",value:"deviceName"},{name:"源地址",value:"sip"},{name:"目的地址",value:"dip"},{name:"源端口",value:"sport"},{name:"目的端口",value:"dport"},{name:"传输层协议",value:"protocol"},{name:"动作",value:"action"}],table:{data:[],total:0}}},created:function(){this.readOnly=JSON.parse(localStorage.getItem("traffic-log"))||!1;var t=JSON.parse(localStorage.getItem("app.user"));this.userName=t.name,this.logCanDeleted=t.logCanDeleted},computed:{},mounted:function(){},methods:{dateRangeChange1:function(t){this.search.startDate=t.dateStrings[0],this.search.endDate=t.dateStrings[1],this.dateValue=t.dateStrings},view:function(t){var a=this;this.getRecord?this.getRecord({id:t.id,time:t.time}).then((function(t){var e=t.data;a.dialog.open({state:"view",parent:a,params:e})})):this.dialog.open({state:"view",parent:this,params:t})},exports:function(){this.dialog.open({state:"export",parent:this,params:{search:this.search}})},update:function(t,a){var e=this,i=this;this.page=t||this.page,this.pageSize=a||this.pageSize,this.spinning=!0,i.$message.warning("正在查询，请稍后！"),this.tableList(this.page,this.pageSize,this.searchParams,this.table.total).then((function(t){var a=t.data;a?(i.table.total=null==a.total?0:a.total,i.table.data=a.rows,i.loading=!1,i.spinning=!1):null!=a&&void 0!=a||(i.table.total=0,i.table.data=[],i.loading=!1,i.spinning=!1),a.msg&&"sort"!=a.msg&&e.$message.warn(a.msg)})).catch((function(){i.loading=!1,i.spinning=!1}))},choseFieldName:function(){this.search.search=""},resetSearch:function(){for(var t in this.search)"startDate"===t||"endDate"===t?(this.search.startDate=s()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),this.search.endDate=s()().format("YYYY-MM-DD HH:mm:ss"),this.dateValue=[s()().startOf("day"),s()()]):"searchs"==t&&(this.search["searchs"]="");this.afterClearSearchParams(),this.buildSearchParams(),this.update(1)},clickSearch1:function(){this.search.startDate=s()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),this.search.endDate=s()().format("YYYY-MM-DD HH:mm:ss"),this.dateValue=[s()().startOf("day"),s()()],this.clickSearch(1)},deleteLog:function(){var t=this,a=t.search.search||"",e=t.search.startDate,i=t.search.endDate;t.$confirm({content:"此操作将删除符合查询条件的所有日志内容，请确认是否删除！",okText:"确认",cancelText:"取消",onOk:function(){t.loading=!0,t.deleteList(a,e,i).then((function(a){"SUCCESS"==a.state&&(t.$message.success(a.msg),t.update(),t.loading=!1)})).catch((function(){t.loading=!1}))},onCancel:function(){}})}},watch:{$route:function(t,a){var e=this;a.path!==t.path&&this.$nextTick((function(){e.dialog&&e.dialog.close()}))}},beforeDestroy:function(){this.dialog&&this.dialog.close()}},O=N,R=(e("834e"),Object(v["a"])(O,i,n,!1,null,"38fc5ac4",null));a["default"]=R.exports}}]);