(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71bd9be4"],{"10d2":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"device-channel-selector"},[a("a-cascader",{staticStyle:{width:"100%"},attrs:{options:e.processedOptions,placeholder:"请选择设备与通道","field-names":{label:"name",value:"id",children:"children"},disabled:e.disabled,allowClear:!1},on:{change:e.handleChange},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}})],1)},i=[],r=a("3835"),s=a("b85c"),o=a("2909"),l=a("5530"),c=(a("25eb"),a("a9e3"),a("d81d"),a("99af"),a("b0c0"),a("d7b0")),d={name:"DeviceChannelSelector",props:{showAllChannels:{type:Boolean,default:!1},clearOnInit:{type:Boolean,default:!1},flag:{type:Boolean,default:!1},activeKeyFlag:{type:String,default:""}},data:function(){var e=localStorage.getItem("dmsType"),t=3;return"1"!==e&&"2"!==e||(t=Number.parseInt(e,10)),{selectedValue:[],dmsType:t,disabled:!1,loading:!1,options:[]}},created:function(){var e=this;this.loading=!0,Object(c["d"])(this.activeKeyFlag).then((function(t){var a=t.data;e.options=a||[],e.loading=!1})).catch((function(){e.options=[],e.loading=!1}))},computed:{processedOptions:function(){return this.showAllChannels&&0!==this.options.length?this.options.map((function(e){var t={id:"",name:"全部通道"};return Object(l["a"])(Object(l["a"])({},e),{},{children:e.children?[t].concat(Object(o["a"])(e.children)):[]})})):this.options}},watch:{options:{immediate:!0,handler:function(e){e&&e.length>0?this.setDefaultSelection():this.selectedValue=[]}},dmsType:function(){this.setDefaultSelection()}},methods:{findNodeById:function(e,t){var a,n=Object(s["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.id===t)return i;if(i.children&&i.children.length>0){var r=this.findNodeById(i.children,t);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null},getChannelInfoByValue:function(e){if(!e||e.length<2)return null;var t=Object(r["a"])(e,2),a=t[0],n=t[1],i=this.findNodeById(this.options,a);if(!i||!i.children)return null;var s=this.findNodeById(i.children,n);return s?{sn:s.sn||"",channelName:s.name||"",channelType:s.channelType||"",deviceNodeName:s.deviceNodeName||"",deviceType:s.deviceType||"",deviceId:a,channelInfoId:n}:null},setDefaultSelection:function(){var e=this;this.loading=!0,this.$nextTick((function(){if(e.clearOnInit)return e.selectedValue=[],void(e.loading=!1);if(0===e.processedOptions.length)return e.selectedValue=[],void(e.loading=!1);var t=e.processedOptions[0];switch(e.dmsType){case 1:e.disabled=!0,t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;case 2:t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;case 3:t.children&&t.children.length>0&&(e.selectedValue=[t.id,t.children[0].id]);break;default:e.selectedValue=[]}if(e.loading=!1,e.selectedValue.length>0){var a=e.getChannelInfoByValue(e.selectedValue);e.$emit("change",e.selectedValue,a)}}))},resetSelection:function(){this.selectedValue=[],this.setDefaultSelection()},clearSelection:function(){this.selectedValue=[]},handleChange:function(e){this.selectedValue=e;var t=this.getChannelInfoByValue(e);this.$emit("change",e,t)},getSelectedValue:function(){return this.selectedValue},getSelectedChannelInfo:function(){return this.getChannelInfoByValue(this.selectedValue)}}},u=d,m=(a("296d"),a("2877")),f=Object(m["a"])(u,n,i,!1,null,"5ab0cc82",null);t["a"]=f.exports},2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a("6b75");function i(e){if(Array.isArray(e))return Object(n["a"])(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var s=a("06c5");a("d9e2");function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return i(e)||r(e)||Object(s["a"])(e)||o()}},"296d":function(e,t,a){"use strict";a("e9bd")},3835:function(e,t,a){"use strict";function n(e){if(Array.isArray(e))return e}a.d(t,"a",(function(){return o}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function i(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],s=!0,o=!1;try{for(a=a.call(e);!(s=(n=a.next()).done);s=!0)if(r.push(n.value),t&&r.length===t)break}catch(l){o=!0,i=l}finally{try{s||null==a["return"]||a["return"]()}finally{if(o)throw i}}return r}}var r=a("06c5");a("d9e2");function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){return n(e)||i(e,t)||Object(r["a"])(e,t)||s()}},3854:function(e,t,a){"use strict";a("7226")},"6d8a":function(e,t,a){"use strict";a("7405")},7226:function(e,t,a){},7405:function(e,t,a){},d3d2:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",{staticStyle:{"margin-top":"30px"}},[a("div",{staticClass:"search"},[a("div",{staticClass:"title"},[e._v("查询条件")]),a("div",{staticClass:"content"},[1!=e.dmsType?[a("span",{staticClass:"outer"},[e._v("设备名称:")]),a("span",{staticClass:"inner",staticStyle:{width:"200px"}},[a("b-cascader",{ref:"cascaderRef",attrs:{"show-all-channels":!1,"clear-on-init":!0},on:{change:e.cascaderHandler}})],1)]:e._e(),a("span",{staticClass:"inner"},[a("a-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择状态"},model:{value:e.search.status,callback:function(t){e.$set(e.search,"status",t)},expression:"search.status"}},[a("a-select-option",{attrs:{value:""}},[e._v("全部")]),a("a-select-option",{attrs:{value:"等待处理"}},[e._v("等待处理")]),a("a-select-option",{attrs:{value:"成功"}},[e._v("成功")]),a("a-select-option",{attrs:{value:"失败"}},[e._v("失败")])],1)],1),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入下发类型"},model:{value:e.search.sendType,callback:function(t){e.$set(e.search,"sendType",t)},expression:"search.sendType"}})],1),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入下发用户"},model:{value:e.search.userName,callback:function(t){e.$set(e.search,"userName",t)},expression:"search.userName"}})],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.clickSearch}},[e._v("查询")])],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",on:{click:e.resetSearch}},[e._v("重置")])],1)],2)]),a("div",{staticClass:"body"},[a("div",{staticClass:"buttons"},[a("b-date-range",{attrs:{value:e.dateValue},on:{change:e.dateRangeChange1}}),e.readOnly||"logadmin"!=e.userName?e._e():a("a-button",{attrs:{type:"primary",icon:"export"},on:{click:function(t){return e.exportData(e.exportUrl,1)}}},[e._v("批量导出")]),"logadmin"==e.userName&&"true"==e.logCanDeleted?[a("a-button",{attrs:{type:"primary",icon:"delete"},on:{click:function(t){return e.deleteLog()}}},[e._v("删除")])]:e._e(),a("a-button",{attrs:{type:"primary",icon:"sync"},on:{click:function(t){return e.clickSearch1()}}},[e._v("刷新")])],2),a("div",{staticClass:"title"},[e._v("查询结果")]),a("a-row",{staticClass:"table"},[a("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[a("span",{staticStyle:{position:"absolute",top:"-25px",left:"12px",color:"#c8c8c8"}},[e.operations.selectedRowKeys.length>0?[e._v(e._s("已选中 "+e.operations.selectedRowKeys.length+" 项"))]:e._e()],2),a("b-fixed-table",{attrs:{columns:e.columns,rowKey:"id","row-selection":e.rowSelection,data:e.table.data,total:e.table.total,loading:e.loading,"init-page":e.page},on:{change:e.tableParamChanged},scopedSlots:e._u([{key:"sendTime",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertTime")(n.sendTime)))])]}},{key:"operations",fn:function(t){var n=t.record;return[a("span",{staticClass:"oper"},[a("span",{on:{click:function(t){return e.view(n)}}},[e._v("详情")])])]}}])})],1)],1)],1)])],1)},i=[],r=(a("b0c0"),a("ac1f"),a("841c"),a("e9c4"),a("d3b7"),a("c1df")),s=a.n(r),o=a("e6e5"),l=a("c2f2"),c=a("0618"),d=a("8cff"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.form.init.show?a("div",[a("a-modal",{attrs:{closable:!0,title:e.form.init.title,width:e.form.init.width,"mask-closable":!1},model:{value:e.form.init.show,callback:function(t){e.$set(e.form.init,"show",t)},expression:"form.init.show"}},["view"===e.form.name?a("a-form-model",{ref:"form",class:{views:"view"===e.form.name},attrs:{model:e.form.init.data,rules:e.form.init.rules,"label-col":{span:e.form.init.labelSpan||6},"wrapper-col":{span:e.form.init.wrapperSpan||18}}},[void 0!==e.form.init.data.sendType?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"下发类型",prop:"sendType"}},[a("span",[e._v(e._s(e.form.init.data.sendType))])]):e._e(),void 0!==e.form.init.data.visitName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"服务名称",prop:"visitName"}},[a("span",[e._v(e._s(e.form.init.data.visitName))])]):e._e(),void 0!==e.form.init.data.deviceName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"设备名称",prop:"deviceName"}},[a("span",[e._v(e._s(e.form.init.data.deviceName))])]):e._e(),void 0!==e.form.init.data.channelName&&1!=e.dmsType?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"通道名称",prop:"channelName"}},[a("span",[e._v(e._s(e.form.init.data.channelName))])]):e._e(),void 0!==e.form.init.data.strategyName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"策略名称",prop:"strategyName"}},[a("span",[e._v(e._s(e.form.init.data.strategyName))])]):e._e(),void 0!==e.form.init.data.userName?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"下发用户",prop:"userName"}},[a("span",[e._v(e._s(e.form.init.data.userName))])]):e._e(),void 0!==e.form.init.data.state?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"状态",prop:"state"}},[a("span",[e._v(e._s(e.form.init.data.state))])]):e._e(),void 0!==e.form.init.data.errorMsg?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"错误信息",prop:"errorMsg"}},[a("span",[e._v(e._s(e.form.init.data.errorMsg))])]):e._e(),void 0!==e.form.init.data.sendTime?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"下发时间",prop:"sendTime"}},[a("span",[e._v(e._s(e.form.init.data.sendTime))])]):e._e()],1):e._e(),"export"===e.form.name?a("a-form-model",{attrs:{model:e.form.init.data,rules:e.form.init.rules,"label-col":{span:e.form.init.labelSpan||6},"wrapper-col":{span:e.form.init.wrapperSpan||18}}},[void 0!==e.form.init.data.limit?a("a-form-model-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"条数",prop:"limit"}},[a("a-input",{staticStyle:{width:"100%"},attrs:{maxLength:10},model:{value:e.form.init.data.limit,callback:function(t){e.$set(e.form.init.data,"limit",t)},expression:"form.init.data.limit"}})],1):e._e()],1):e._e(),a("template",{slot:"footer"},["export"===e.form.name?a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportData()}}},[e._v("导出")]):e._e(),a("a-button",{on:{click:function(t){return e.clickCancel()}}},[e._v("关闭")])],1)],2)],1):e._e()},m=[],f=(a("00b4"),a("99af"),a("eb60")),h={name:"AuditSendLogDialog",components:{},mixins:[l["a"]],filters:{},props:{},data:function(){return{zhCN:f["a"],spinning:!1,state:"",params:"",parent:"",form:{view:{title:"详情",width:900,request:"",show:!0,data:{sendType:"",haName:"",visitName:"",deviceName:"",channelName:"",strategyName:"",userName:"",state:"",errorMsg:"",sendTime:"",sendContent:"",resultContent:""},rules:{}},export:{title:"导出",width:420,request:"",show:!0,exportUrl:"send-log/export-data",timeRange:[s()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),s()().format("YYYY-MM-DD HH:mm:ss")],ranges:{},data:{deviceId:"",channelInfoId:"",sendType:"",userName:"",status:void 0,startDate:s()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),endDate:s()().format("YYYY-MM-DD HH:mm:ss"),limit:1,offset:0},rules:{}}}}},created:function(){this.showDialog(this.state,this.params)},methods:{beforeShowDialog:function(){},beforeSave:function(){},close:function(){this.form.init.show=!1},disabledDate:function(e){return e>s()().endOf("day")},dateChange:function(e){this.form.init.data.startDate=e[0].format("YYYY-MM-DD HH:mm:ss"),this.form.init.data.endDate=e[1].format("YYYY-MM-DD HH:mm:ss")},exportData:function(){var e=this;if(/^[0-9]+?$/.test(e.form.init.data.limit))if(e.form.init.data.limit>1e4||e.form.init.data.limit<1)e.$message.error("导出条数应在[1~10000]内");else{var t=e.params.search.fieldName,a=e.params.search.search||"",n=e.form.init.data.offset,i=e.form.init.data.limit,r=e.params.search.startDate,s=e.params.search.endDate,o="".concat(e.BASE_URL).concat(e.form.export.exportUrl,"?search=").concat(a,"&fieldName=").concat(t,"&offset=").concat(n,"&limit=").concat(i,"&startDate=").concat(r,"&endDate=").concat(s);window.open(o,"_blank"),this.close()}else this.$message.error("导出条数请输入正整数")},update:function(){var e=this;e.parent.update()}}},p=h,v=(a("3854"),a("2877")),g=Object(v["a"])(p,u,m,!1,null,"69d80592",null),b=g.exports,y=new d["a"](b),w=a("1da1"),S=(a("96cf"),a("b775"));function _(e,t,a,n){return D.apply(this,arguments)}function D(){return D=Object(w["a"])(regeneratorRuntime.mark((function e(t,a,n,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(S["f"])("send-log/logs?offset=".concat((t-1)*a,"&limit=").concat(a,"&search=").concat(n,"&total=").concat(i),S["a"].GET));case 1:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function x(e,t,a,n){return N.apply(this,arguments)}function N(){return N=Object(w["a"])(regeneratorRuntime.mark((function e(t,a,n,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(S["f"])("send-log/del-logs?search=".concat(t,"&fieldName=").concat(a,"&startDate=").concat(n,"&endDate=").concat(i),S["a"].DELETE));case 1:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function C(e){return Y.apply(this,arguments)}function Y(){return Y=Object(w["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.id,e.abrupt("return",Object(S["f"])("send-log/log/".concat(a),S["a"].GET));case 2:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}var T=a("d9f9"),I=a("10d2"),k=[{title:"设备",dataIndex:"deviceName"},{title:"状态",dataIndex:"state"},{title:"下发类型",dataIndex:"sendType"},{title:"下发用户",dataIndex:"userName"},{title:"下发时间",ellipsis:!0,scopedSlots:{customRender:"sendTime"}},{title:"操作",scopedSlots:{customRender:"operations"}}],O={name:"AuditSendLog",components:{BFixedTable:c["a"],BDateRange:o["a"],BCascader:I["a"]},mixins:[l["a"]],filters:{convertTime:T["C"]},props:{},data:function(){return{readOnly:!1,columns:k,loading:!1,exportUrl:"send-log/export-data",dialog:y,tableList:_,deleteList:x,userName:"",logCanDeleted:!1,dateValue:[s()().startOf("day"),s()()],search:{deviceId:"",channelInfoId:"",sendType:"",userName:"",status:void 0,startDate:s()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),endDate:s()().format("YYYY-MM-DD HH:mm:ss")},table:{data:[],total:0}}},created:function(){this.readOnly=JSON.parse(localStorage.getItem("send-log"))||!1;var e=JSON.parse(localStorage.getItem("app.user"));this.userName=e.name,this.logCanDeleted=e.logCanDeleted},computed:{},mounted:function(){this.detectDeviceType()},methods:{moment:s.a,dateRangeChange1:function(e){this.search.startDate=e.dateStrings[0],this.search.endDate=e.dateStrings[1],this.dateValue=e.dateStrings},view:function(e){var t=this,a={id:e.id};C(a).then((function(e){var a=e.data;t.dialog.open({state:"view",parent:t,params:a})}))},cascaderHandler:function(e){this.search.deviceId=e[0],this.search.channelInfoId=e[1]},exports:function(){this.dialog.open({state:"export",parent:this,params:{search:this.search}})},choseFieldName:function(){this.search.search=""},resetSearch:function(){this.$refs.cascaderRef&&this.$refs.cascaderRef.clearSelection(),this.search={deviceId:"",channelInfoId:"",sendType:"",userName:"",status:void 0,startDate:s()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),endDate:s()().format("YYYY-MM-DD HH:mm:ss")},this.dateValue=[s()().startOf("day"),s()()],this.clickSearch()},clickSearch1:function(){this.search.startDate=s()().startOf("day").format("YYYY-MM-DD HH:mm:ss"),this.search.endDate=s()().format("YYYY-MM-DD HH:mm:ss"),this.dateValue=[s()().startOf("day"),s()()],this.clickSearch(1)},update:function(e,t){var a=this;a.operations={selectedRowKeys:[],page:1,selectedRows:[],state:!0,loading:!1},this.page=e||this.page,this.pageSize=t||this.pageSize,this.loading=!0,a.table.total=0,a.table.data=[];var n=encodeURIComponent(JSON.stringify(this.search));this.tableList(this.page,this.pageSize,n,this.table.total).then((function(e){var t=e.data;t&&(a.table.total=null==t.total?0:t.total,a.table.data=t.rows)})).finally((function(){a.loading=!1}))},deleteLog:function(){var e=this,t=e.search.fieldName,a=e.search.search||"",n=e.search.startDate,i=e.search.endDate;e.$confirm({content:"此操作将删除符合查询条件的所有日志内容，请确认是否删除！",okText:"确认",cancelText:"取消",onOk:function(){e.loading=!0,e.deleteList(a,t,n,i).then((function(t){"SUCCESS"==t.state&&(e.$message.success(t.msg),e.update(),e.loading=!1)})).catch((function(){e.loading=!1}))},onCancel:function(){}})}},watch:{$route:function(e,t){var a=this;t.path!==e.path&&this.$nextTick((function(){a.dialog&&a.dialog.close()}))}},beforeDestroy:function(){this.dialog&&this.dialog.close()}},V=O,M=(a("6d8a"),Object(v["a"])(V,n,i,!1,null,"5f5b0b22",null));t["default"]=M.exports},e9bd:function(e,t,a){}}]);