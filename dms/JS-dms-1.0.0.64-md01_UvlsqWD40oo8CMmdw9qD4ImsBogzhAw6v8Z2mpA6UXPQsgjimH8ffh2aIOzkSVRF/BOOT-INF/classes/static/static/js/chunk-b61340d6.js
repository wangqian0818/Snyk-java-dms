(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b61340d6"],{"0fd1":function(t,e,a){"use strict";a("455d")},"455d":function(t,e,a){},"5f05":function(t,e,a){"use strict";a("9859")},7387:function(t,e,a){t.exports=a.p+"static/img/login.png"},7527:function(t,e,a){"use strict";a("b62c")},"80c1":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"bs-app"}},[a("div",{ref:"content",staticStyle:{"z-index":"999"},attrs:{id:"bs-container"}},[a("common-layout",{staticStyle:{width:"100%",height:"100%"}},[a("div",{staticClass:"login-bg"},[a("div",{staticClass:"login"},[a("div",{staticClass:"top"},[a("div",{staticClass:"header tc"},[a("svg",{attrs:{width:"450",height:"80"}},[a("defs",[a("linearGradient",{attrs:{id:"g34",x1:"0%",y1:"0%",x2:"0%",y2:"100%"}},[a("stop",{attrs:{offset:"0%","stop-color":"#bbf9f8"}}),a("stop",{attrs:{offset:"50%","stop-color":"#8aebf1"}}),a("stop",{attrs:{offset:"51%","stop-color":"#57d9ee"}}),a("stop",{attrs:{offset:"100%","stop-color":"#288da2"}})],1)],1),a("text",{staticClass:"tc",staticStyle:{"letter-spacing":"4px","text-anchor":"middle"},attrs:{"font-size":t.dynamicFontSize,x:"50%",y:"38",fill:"url(#g34)"}},[t._v(t._s(t.primaryName||"-"))])])])]),a("div",{staticStyle:{"text-align":"center",color:"#fff","font-size":"24px","margin-bottom":"20px"}},[t._v("用户登录")]),a("a-form",{attrs:{form:t.form}},[a("a-form-item",{staticClass:"b-input"},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入账户名",whitespace:!0},{validator:t.validator}]}],expression:"['name', {rules: [{ required: true, message: '请输入账户名', whitespace: true}, {validator: validator}]}]"}],staticClass:"font-color l-input username-input",attrs:{autocomplete:"off",size:"large",placeholder:"请输入用户名"}},[a("a-icon",{staticStyle:{"font-size":"20px",color:"#a8c3d3"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),a("a-form-item",{staticClass:"b-input"},[a("a-input-password",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码",whitespace:!0},{validator:t.validator}]}],expression:"['password', {rules: [{ required: true, message: '请输入密码', whitespace: true}, {validator: validator}]}]"}],staticClass:"l-input username-input",attrs:{size:"large",placeholder:"请输入密码",autocomplete:"off",type:"password"}},[a("a-icon",{staticStyle:{"font-size":"20px",color:"#a8c3d3"},attrs:{slot:"prefix",type:"lock",theme:"filled"},slot:"prefix"})],1)],1),t.asyncRoutes?a("a-form-item",[a("a-row",{attrs:{gutter:16}},[a("a-col",{staticClass:"gutter-row",attrs:{span:12}},[a("a-form-item",{staticClass:"c-input"},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["code",{rules:[{required:!0,message:t.$t("user.verification-code.required")}],validateTrigger:"blur"}],expression:"['code', {rules: [{ required: true, message: $t('user.verification-code.required') }], validateTrigger: 'blur'}]"}],staticClass:"l-input username-input",attrs:{size:"large",type:"text",placeholder:t.$t("user.login.code.placeholder")},on:{focus:t.kaptchaFocused}},[a("a-icon",{staticStyle:{"font-size":"20px",color:"#a8c3d3"},attrs:{slot:"prefix",type:"safety-certificate"},slot:"prefix"})],1)],1)],1),a("a-col",{staticClass:"gutter-row",attrs:{span:12}},[a("img",{ref:"kaptcha",staticClass:"kaptcha c-input",attrs:{src:t.baseUrl+"kaptcha",alt:t.$t("user.login.code.placeholder")},on:{click:t.getKaptcha}})])],1)],1):t._e(),a("a-form-item",[a("a-row",{attrs:{gutter:16}},[t.isEnable?a("a-col",{staticClass:"gutter-row",attrs:{span:12}},[a("div",{staticStyle:{position:"relative"}},[a("a-button",{staticClass:"cert",attrs:{size:"large"},on:{click:t.handleClick}},[a("a-icon",{attrs:{type:"cloud-upload"}}),t._v(" 导入证书 ")],1),a("span",{staticClass:"white",staticStyle:{left:"10px",position:"absolute",top:"-35px"}},[t._v(t._s(t.file.name))]),a("input",{ref:"input",class:"ant-input",attrs:{type:"file",hidden:"",multiple:!1,accept:".crt"},on:{change:t.handleChange}})],1)]):t._e(),a("a-col",{staticClass:"gutter-row",attrs:{span:t.isEnable?12:24}},[a("a-button",{staticClass:"enter",staticStyle:{width:"100%"},attrs:{loading:t.logging,size:"large",htmlType:"submit",type:"primary"},on:{click:t.onSubmit}},[t._v("登录")])],1)],1)],1)],1)],1)])])],1),a("a-modal",{attrs:{width:500,title:"在线用户","mask-closable":!1,closable:!1},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("template",{slot:"footer"},[a("a-table",{attrs:{pagination:!1,rowKey:"id",columns:t.tableColumns,"data-source":t.onlineSubRoleList},scopedSlots:t._u([{key:"operations",fn:function(e){return[a("a-button",{attrs:{type:"primary"},on:{click:function(a){return t.offLine(e.name)}}},[t._v("下线")])]}}])}),a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveClick()}}},[t._v("确定")])],1)],2)],1)},i=[],o=a("5530"),n=(a("caad"),a("2532"),a("ac1f"),a("1276"),a("d3b7"),a("159b"),a("b64b"),a("4d63"),a("c607"),a("2c3e"),a("25f0"),a("00b4"),a("e9c4"),a("99af"),a("bc3a")),r=a.n(n),c=a("b775"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"common-layout"},[a("div",{staticClass:"content"},[t._t("default")],2),t.footerLinks.length>0?a("page-footer",{attrs:{"link-list":t.footerLinks,copyright:t.copyright}}):t._e()],1)},u=[],d=a("613e"),p=a("2f62"),f={name:"CommonLayout",components:{PageFooter:d["a"]},computed:Object(o["a"])({},Object(p["d"])("setting",["footerLinks","copyright"]))},m=f,g=(a("7527"),a("2877")),h=Object(g["a"])(m,l,u,!1,null,"039e8f06",null),b=h.exports,y=a("93d6"),v=a("d7b0"),w=a("89a5"),S=a("1748"),x=a.n(S),C=a("a78e"),k=a.n(C),T=a("ba79"),O=a("c249"),$=a("9002"),F=a("0829"),j=a("322e"),L=[{title:"用户名",ellipsis:!0,dataIndex:"name"},{title:"姓名",ellipsis:!0,dataIndex:"nickName"},{title:"操作",ellipsis:!0,scopedSlots:{customRender:"operations"}}],E={name:"Login",components:{AFormItem:j["a"],AInputPassword:F["a"],CommonLayout:b},mixins:[$["a"]],i18n:{messages:{CN:{"user.login.code.placeholder":"验证码","user.verification-code.required":"请输入验证码"}}},data:function(){var t=this;return{visible:!1,isclick:!0,baseUrl:T["b"],isEnable:!1,file:"",formData:"",style:{input:!1},logging:!1,error:"",form:this.$form.createForm(this),errMsgs:{},validator:function(e,a,s){s(t.errMsgs[e.field])},kaptchaLastUpdateTime:new Date,tableColumns:L,onlineSubRoleList:[],dynamicFontSize:26}},mounted:function(){this.getEnableCrt(),this.getPwdRules(),Object(O["b"])(a("7387")),window.addEventListener("resize",O["b"]),this.modifyStyleByTagName(this.$refs.content,"input",{color:"rgb(122 138 154)"}),Object(c["e"])(),this.adjustFontSizeByTextLength()},destroyed:function(){Object(O["a"])()},computed:Object(o["a"])({primaryName:function(){var t=this.$store.state.setting.systemName,e="";if(0!=t.length)if(t.includes("-",0)){var a=t.split("-");e=a[0]}else e=t;return e},subName:function(){var t=this.$store.state.setting.productModel+" "+this.$store.state.setting.productVersion;return t}},Object(p["d"])("setting",["asyncRoutes"])),watch:{primaryName:{immediate:!0,handler:function(){this.adjustFontSizeByTextLength()}}},created:function(){},methods:Object(o["a"])(Object(o["a"])({},Object(p["c"])("account",["setUser","setMenus"])),{},{adjustFontSizeByTextLength:function(){var t=this.primaryName||"-",e=t.length,a={1:28,2:28,3:28,4:28,5:28,6:28,7:26,8:26,9:26,10:26,11:26,12:24,13:24,14:24};e>=14&&(this.dynamicFontSize=a[e]||24),this.dynamicFontSize=Math.max(24,Math.min(28,this.dynamicFontSize))},getKaptcha:function(t){t&&t.preventDefault(),this.$refs.kaptcha.src="".concat(this.baseUrl,"kaptcha?_=")+(new Date).getTime(),this.kaptchaLastUpdateTime=new Date},kaptchaFocused:function(t){var e=new Date;e-this.kaptchaLastUpdateTime>58e3&&this.getKaptcha(t)},onSubmit:function(t){var e=this,a=this;t.preventDefault(),a.isclick&&(a.isclick=!1,a.form.validateFields((function(t){if(!t){a.logging=!0;var s=a.form.getFieldValue("name"),i=a.form.getFieldValue("password"),o=a.form.getFieldValue("code")||"",n={name:s,password:x.a.sm3(i),code:o},c=new FormData;a.file&&c.append("file",a.file),Object.keys(n).forEach((function(t){c.append(t,n[t])}));var l="".concat(T["b"],"login");r()({method:"POST",url:l,data:c,transformRequest:[function(t){return t}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if("SUCCESS"==t.state){var s=JSON.parse(localStorage.getItem("regex")),o=new RegExp(s);localStorage.setItem("isMatch",o.test(i)),a.afterLogin(t)}else{var n=t.msg;a.asyncRoutes&&e.getKaptcha(),a.logging=!1,n&&(-1!==n.indexOf("License")&&a.$confirm({content:n,onOk:function(){var t=a.$router.resolve({path:"/license",query:{}});window.open(t.href,"_blank")},okText:"立即更新License",cancelText:"关闭",onCancel:function(){}}),a.error=n)}})).catch((function(){a.logging=!1,a.$message({type:"error",message:"网络请求失败"})}))}})),setTimeout((function(){a.isclick=!0}),1e3))},offLine:function(t){var e=this,a={userName:t};Object(c["b"])("tool/user/unlogin",c["a"].PUT,a).then((function(t){0==t&&e.$message.success("下线成功")})),this.getUserInfo()},saveClick:function(){var t=this.getFirstPagePath();t&&(this.$message.success("登录成功",3),this.$router.push(t),Object(c["b"])("tool/system-type",c["a"].GET).then((function(t){localStorage.setItem("systemType",t)})),Object(c["b"])("tool/device-info",c["a"].GET).then((function(t){localStorage.setItem("deviceNodeType",JSON.stringify(t.channels)),localStorage.setItem("productType",t.productType),localStorage.setItem("dmsType",t.dmsType)})))},afterLogin:function(t){this.logging=!1,"SUCCESS"==t.state?(this.$store.state.setting.asyncRoutes||k.a.set(T["c"],""),this.getUserInfo()):this.$message.error(t.msg)},getUserInfo:function(){var t=this;Object(y["d"])().then((function(e){var a=e.data,s=a.user,i=a.menus,o=a.loginUser;if(t.setUser(s),t.setMenus(i),Object(w["d"])(i),null!=o&&o.length>0)t.visible=!0,t.onlineSubRoleList=o;else{t.visible=!1;var n=t.getFirstPagePath();n&&(t.$router.push(n),Object(c["b"])("tool/system-type",c["a"].GET).then((function(t){localStorage.setItem("systemType",t)})),Object(c["b"])("tool/device-info",c["a"].GET).then((function(t){localStorage.setItem("deviceNodeType",JSON.stringify(t.channels)),localStorage.setItem("productType",t.productType),localStorage.setItem("dmsType",t.dmsType)})),t.getPwdRules(),t.$message.success("登录成功",3))}})).catch((function(t){}))},getFirstPagePath:function(){var t=function t(e){return e.children&&0!==e.children.length?t(e.children[0]):e.fullPath},e=function(t,e){var a=null;return t.forEach((function(t){t.fullPath===e&&(a=t)})),a},a=e(this.$router.options.routes,"/"),s=e(this.$router.options.routes,T["a"]);if(a||s)return t(a||s);this.$message.error("没有进入系统权限")},handleClick:function(){this.disabled||this.$refs.input.click()},handleChange:function(t){var e=t.target.files;e&&0!==e.length&&(this.file=e[0])},getEnableCrt:function(){var t=this;Object(y["b"])().then((function(e){"false"==e.data?t.isEnable=!1:t.isEnable=!0}))},getPwdRules:function(){Object(v["h"])().then((function(t){var e=t.data;if(localStorage.setItem("rules",e.pwdRules),e.pwdRules){var a=JSON.parse(e.pwdRules),s=a.pwdLength[0],i=a.pwdLength[1],o="^";Object.keys(a).forEach((function(t){"upper"==t&&1==a[t]?o+="(?=.*[A-Z])":"lower"==t&&1==a[t]?o+="(?=.*[a-z])":"number"==t&&1==a[t]?o+="(?=.*\\d)":"special"==t&&1==a[t]?o+="(?=.*[!@~#$?%^&*(){}_+=|:;\\\"'<>,./-])":"pwdLength"==t&&(o+="[^\\u4e00-\\u9fa5]{".concat(s,",").concat(i,"}$"))})),localStorage.setItem("regex",JSON.stringify(o))}}))}})},z=E,_=(a("5f05"),a("0fd1"),Object(g["a"])(z,s,i,!1,null,"223aacd4",null)),N=_.exports;e["default"]=N},9002:function(t,e,a){"use strict";var s=a("9b10");e["a"]={mixins:[s["a"]],data:function(){return{style:{input:!0}}},mounted:function(){var t=this.$refs.content;this.style.input&&this.modifyStyleByClass(t,"ant-input",{backgroundColor:"transparent",border:"none",color:"#EBF1FF"}),this.modifyStyleByClass(t,"ant-calendar-picker-icon",{color:"#2A78A9",right:"-1px"}),this.modifyStyleByClass(t,"ant-calendar-range-picker-separator",{color:"#EBF1FF"}),this.modifyStyleByClass(t,"ant-select-selection--single",{background:"transparent",border:"1px solid rgb(45, 110, 160)",borderRadius:0,height:"28px"}),this.modifyStyleByClass(t,"ant-select-selection-selected-value",{color:"#d9d9d9"})}}},9859:function(t,e,a){},b62c:function(t,e,a){}}]);