(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7c7a70e"],{"3f96":function(e,t,a){},4463:function(e,t,a){},"5c7a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",{staticStyle:{"margin-top":"30px"}},[a("div",{staticClass:"search"},[a("div",{staticClass:"title"},[e._v("查询条件")]),a("div",{staticClass:"content"},[a("span",[e._v("关键字:")]),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入关键字"},on:{pressEnter:e.clickSearch},model:{value:e.search.search,callback:function(t){e.$set(e.search,"search",t)},expression:"search.search"}})],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:function(t){return e.clickSearch(1)}}},[e._v("查询")])],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",on:{click:e.resetSearch}},[e._v("重置")])],1)])]),a("div",{staticClass:"body"},[a("div",{staticClass:"buttons"},[e.readOnly?e._e():a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.deviceUpdateCreate}},[e._v("新建")]),a("a-button",{attrs:{type:"primary",icon:"sync"},on:{click:function(t){return e.clickSearch(1)}}},[e._v("刷新")])],1),a("div",{staticClass:"title"},[e._v("查询结果")]),a("a-row",{staticClass:"table"},[a("a-col",{staticStyle:{padding:"0 12px"},attrs:{xl:24,lg:24,md:24,sm:24,xs:24}},[a("b-fixed-table",{attrs:{columns:e.columns,rowKey:"id",data:e.table.data,total:e.table.total,loading:e.loading,"init-page":e.page},on:{change:e.tableParamChanged},scopedSlots:e._u([{key:"type",fn:function(t){var n=t.record;return["1"==n.type?a("span",[e._v("加固包")]):e._e(),"2"==n.type?a("span",[e._v("版本包")]):e._e(),"3"==n.type?a("span",[e._v("补丁包")]):e._e(),"4"==n.type?a("span",[e._v("病毒升级包")]):e._e()]}},{key:"gmtCreate",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertTime")(n.gmtCreate)))])]}},{key:"operations",fn:function(t){var n=t.record;return[e.readOnly?e._e():a("span",{staticClass:"oper"},[a("span",{on:{click:function(t){return e.deviceUpdateDispatch(n.id)}}},[e._v("下发")])]),a("span",{staticClass:"oper-margin oper"},[a("span",{on:{click:function(t){return e.deviceUpdateState(n.id)}}},[e._v("查看状态")])]),e.readOnly?e._e():a("span",{staticClass:"oper-margin oper"},[a("span",{on:{click:function(t){return e.download(n.fileUuid)}}},[e._v("下载")])]),e.readOnly?e._e():a("span",{staticClass:"oper-margin oper red"},[a("span",{on:{click:function(t){return e.deviceUpdateDelete(n.id)}}},[e._v("删除")])])]}}])})],1)],1)],1)])],1)},i=[],r=a("c2f2"),o=a("0618"),s=a("8cff"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.form.init.show?a("div",[a("a-config-provider",{attrs:{locale:e.zhCN}},[a("a-modal",{attrs:{closable:!0,title:e.form.init.title,width:e.form.init.width,"mask-closable":!1},model:{value:e.form.init.show,callback:function(t){e.$set(e.form.init,"show",t)},expression:"form.init.show"}},["delete"===e.form.name?a("div",[e._v("确定删除？")]):e._e(),"state"===e.form.name?a("div",{staticStyle:{"min-height":"390px"}},[a("b-fixed-table",{attrs:{size:"small",columns:e.columns,rowKey:"id",data:e.form.init.data.table.data,total:e.form.init.data.table.total,"show-index":!1,"table-height":310,"init-page-size":8,"root-data":e.form.init.data.table,"show-total":null,"show-quick-jumper":!1,"show-size-changer":!1,"show-less-items":!0},on:{change:e.tableParamChanged},scopedSlots:e._u([{key:"workState",fn:function(t){var n=t.record;return[a("span",[e._v(e._s(e._f("convertWorkState")(n.workState)))])]}}],null,!1,1031597623)})],1):a("a-form-model",{ref:"form",attrs:{model:e.form.init.data,rules:e.form.init.rules,"label-col":{span:5},"wrapper-col":{span:19}}},["dispatch"===e.form.name?a("a-form-model-item",{attrs:{label:"设备名称",prop:"devices"}},[a("a-tree",{attrs:{checkable:"","show-line":"","tree-data":e.deviceList,defaultExpandAll:!0,expandedKeys:e.expandedKeys,replaceFields:{children:"children",title:"name",key:"treeId"}},on:{check:e.onCheck,expand:e.onExpand},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1):e._e(),void 0!==e.form.init.data.fileList?a("a-form-model-item",{attrs:{label:"上传",prop:"fileList"}},[a("a-upload-dragger",{staticStyle:{width:"100%",height:"90px"},attrs:{"file-list":e.form.init.data.fileList,action:e.uploadUrl,multiple:!1,accept:".gz",disabled:"modify"===e.form.name},on:{change:e.uploadFile}},[a("div",{staticStyle:{color:"#40a9ff","font-size":"24px"}},[a("a-icon",{attrs:{type:"inbox"}})],1),a("div",[e._v("点击或拖拽文件到此处")])])],1):e._e()],1),a("template",{slot:"footer"},["state"!==e.form.name?a("a-button",{attrs:{loading:e.form.init.confirmLoading,type:"primary"},on:{click:function(t){return e.clickSave()}}},[e._v(e._s(~["delete","state"].indexOf(e.form.name)?"确定":"保存"))]):e._e(),"state"!==e.form.name?a("a-button",{on:{click:function(t){return e.clickCancel()}}},[e._v("取消")]):e._e(),"state"==e.form.name?a("a-button",{on:{click:function(t){return e.clickCancel()}}},[e._v("关闭")]):e._e()],1)],2)],1)],1):e._e()},l=[],d=(a("b0c0"),a("1da1")),u=(a("96cf"),a("99af"),a("b775"));function p(e,t,a){return f.apply(this,arguments)}function f(){return f=Object(d["a"])(regeneratorRuntime.mark((function e(t,a,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(u["f"])("device/border-device-upgrades?offset=".concat((t-1)*a,"&limit=").concat(a).concat(n),u["a"].GET));case 1:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function h(e){return m.apply(this,arguments)}function m(){return m=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(u["f"])("device/border-device-upgrade",u["a"].POST,t));case 1:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return b=Object(d["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.id,e.abrupt("return",Object(u["f"])("device/border-device-upgrade/".concat(a),u["a"].DELETE));case 2:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function g(e){return w.apply(this,arguments)}function w(){return w=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(u["f"])("device/border-device-upgrade/dispatch",u["a"].PUT,t));case 1:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function y(e,t,a){return k.apply(this,arguments)}function k(){return k=Object(d["a"])(regeneratorRuntime.mark((function e(t,a,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(u["f"])("device/border-device-upgrade/state/".concat(t,"?offset=").concat((a-1)*n,"&limit=").concat(n,"&search="),u["a"].GET));case 1:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}var _=a("a00a"),x=(a("c8f0"),a("52bd")),C=a("d9f9"),S=[{title:"设备名称",dataIndex:"deviceName"},{title:"通道名称",dataIndex:"channelName"},{title:"生效状态",ellipsis:!0,scopedSlots:{customRender:"workState"}}],O={name:"updateDialog",components:{BFixedTable:o["a"]},mixins:[r["a"]],comments:{},filters:{convertWorkState:C["H"]},props:{},watch:{},data:function(){return{Removeshow:!1,zhCN:x["default"],columns:S,deviceList:[],show:!1,title:"",width:710,prop:"",id:-1,front:!0,end:!0,checkedKeys:[],expandedKeys:[],form:{create:{id1:"",title:"新建",width:450,isCreate:!0,request:h,show:!0,confirmLoading:!1,data:{id:"",fileList:[],name:""},rules:{name:_["a"].name,fileList:_["a"].onlyOneFile}},dispatch:{title:"下发",width:420,isDelete:!0,request:g,show:!0,confirmLoading:!1,data:{id:"",devices:[],workArea:""},rules:{devices:_["a"].select}},state:{title:"状态",width:420,isDelete:!0,request:y,show:!0,data:{id:"",table:{data:[],total:0}},rules:{}},delete:{title:"删除",width:420,isDelete:!0,request:v,show:!0,confirmLoading:!1,data:{id:""},rules:{}}}}},created:function(){this.showDialog(this.state,this.params),"dispatch"===this.state&&this.updateBorderDeviceList()},methods:{close:function(){this.form.init.show=!1},update:function(){this.parent.update()},beforeSave:function(e){if("dispatch"===this.form.name);else{var t=e.fileList,a="";t&&t.length>0&&(a=t[0].uid),e.fileUuid=a,delete e.fileList}},tableParamChanged:function(e){e.rootData.page=e.page;var t=e.rootData,a=8;"page"in t||(t.page=1);var n=t.page;y(this.form.init.data.id,n,a).then((function(e){var a=e.data;t.data=a.rows,t.total=a.total}))}}},D=O,L=(a("c266"),a("2877")),R=Object(L["a"])(D,c,l,!1,null,"d1fc7b0e",null),j=R.exports,T=new s["a"](j),U=[{title:"更新包名称",dataIndex:"name"},{title:"上传时间",ellipsis:!0,scopedSlots:{customRender:"gmtCreate"}},{title:"类型",ellipsis:!0,scopedSlots:{customRender:"type"}},{title:"MD5",dataIndex:"md5"},{title:"操作",scopedSlots:{customRender:"operations"}}],z={name:"DeviceUpdate",components:{BFixedTable:o["a"]},mixins:[r["a"]],comments:{BFixedTable:o["a"]},filters:{convertTime:C["C"]},props:{},data:function(){return{readOnly:!1,dialog:T,columns:U,loading:!1,table:{data:[],total:0}}},created:function(){this.readOnly=JSON.parse(localStorage.getItem("border-device-upgrade"))||!1},watch:{$route:function(e,t){var a=this;t.path!==e.path&&this.$nextTick((function(){a.dialog&&a.dialog.close()}))}},computed:{},mounted:function(){},methods:{deviceUpdateCreate:function(){var e=this;e.$confirm({content:"新建上传的文件不得大于2G,否则可能上传失败，是否继续新建？",okText:"确认",cancelText:"取消",onOk:function(){e.dialog.open({state:"create",parent:e})},onCancel:function(){}})},deviceUpdateDispatch:function(e){var t=this;Object(u["b"])("device/border-device-upgrade/".concat(e)).then((function(a){t.dialog.open({state:"dispatch",params:{id:e,devices:a||[]},parent:t})}))},deviceUpdateState:function(e){this.dialog.open({state:"state",params:{id:e},parent:this})},deviceUpdateDelete:function(e){this.dialog.open({state:"delete",parent:this,params:{id:e}})},update:function(e,t){var a=this;this.page=e||this.page,this.pageSize=t||this.pageSize,this.loading=!0,p(this.page,this.pageSize,this.searchParams).then((function(e){var t=e.data;t?(a.table.total=null==t.total?0:t.total,a.table.data=t.rows,a.loading=!1):(a.table.total=0,a.table.data=[],a.loading=!1)})).catch((function(){a.loading=!1}))}},beforeDestroy:function(){this.dialog&&this.dialog.close()}},E=z,K=(a("b081"),Object(L["a"])(E,n,i,!1,null,"4c08562f",null));t["default"]=K.exports},b081:function(e,t,a){"use strict";a("3f96")},c266:function(e,t,a){"use strict";a("4463")}}]);