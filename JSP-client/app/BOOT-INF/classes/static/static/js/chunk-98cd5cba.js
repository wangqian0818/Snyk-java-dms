(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-98cd5cba"],{"1ed1":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.currentDetail?a("signLevelDetails",e._b({on:{back:e.handleBack}},"signLevelDetails",e.currentDetail,!1)):a("a-card",{staticStyle:{"margin-top":"30px"}},[a("div",{staticClass:"search"},[a("div",{staticClass:"title"},[e._v("查询条件")]),a("div",{staticClass:"content"},[a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{placeholder:"请输入服务名称",maxLength:20},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),a("span",{staticClass:"inner"},[a("a-select",{staticClass:"i-width",attrs:{placeholder:"请选择服务用户",getPopupContainer:function(e){return e.parentNode}},model:{value:e.search.userName,callback:function(t){e.$set(e.search,"userName",t)},expression:"search.userName"}},e._l(e.userList,(function(t){return a("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("span",{staticClass:"inner"},[a("a-select",{staticClass:"i-width",attrs:{placeholder:"请选择审批状态",getPopupContainer:function(e){return e.parentNode}},model:{value:e.search.approvalState,callback:function(t){e.$set(e.search,"approvalState",t)},expression:"search.approvalState"}},[a("a-select-option",{attrs:{value:"未审批"}},[e._v("未审批")]),a("a-select-option",{attrs:{value:"未完成"}},[e._v("未完成")]),a("a-select-option",{attrs:{value:"已审批"}},[e._v("已审批")])],1)],1),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.refresh}},[e._v("查询")]),a("a-button",{staticClass:"button oper-margin",attrs:{type:"primary"},on:{click:e.reset}},[e._v("重置")])],1)])]),a("div",{staticClass:"body"},[a("a-spin",{attrs:{spinning:e.spinning,tip:"请稍等！"}},[a("a-row",{staticClass:"table"},[a("a-table",{attrs:{columns:e.columns,dataSource:e.data,rowKey:"id",bordered:"",pagination:!1,scroll:{y:540}},scopedSlots:e._u([{key:"number",fn:function(t,a,s){return[e._v(e._s((e.page-1)*e.pageSize+s+1))]}},{key:"operations",fn:function(t){return[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red",on:{click:function(a){return e.showDetailPage(t)}}},[e._v("详情")])])]}}],null,!1,675999731)}),a("a-pagination",{staticStyle:{"margin-top":"16px","text-align":"right"},attrs:{current:e.page,pageSize:e.pageSize,total:e.total,showTotal:function(e){return"总共"+e+"条"},showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},on:{change:e.handlePageChange,showSizeChange:e.handlePageSizeChange}})],1)],1)],1)])],1)},n=[],i=(a("ac1f"),a("841c"),a("d3b7"),a("99af"),a("b0c0"),a("b775")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",{staticStyle:{"margin-top":"30px"}},[a("a-button",{staticStyle:{"margin-bottom":"16px"},attrs:{type:"primary"},on:{click:e.handleBack}},[e._v("返回")]),a("span",{staticClass:"title",staticStyle:{"margin-left":"40px","font-size":"20px","font-weight":"600",color:"#0ab1c5","letter-spacing":"1px"}},[e._v(e._s(e.name))]),a("div",{staticClass:"tabs"},[a("a-radio-group",{on:{change:function(t){return e.switchMenu(e.activeKey)}},model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},[a("a-radio-button",{attrs:{value:"未审批"}},[e._v("未审批")]),a("a-radio-button",{attrs:{value:"已审批"}},[e._v("已审批")])],1)],1),a("div",{staticClass:"search"},[a("div",{staticClass:"title"},[e._v("查询条件")]),a("div",{staticClass:"content"},[a("span",[e._v("文件名(目录):")]),a("span",{staticClass:"inner"},[a("a-input",{staticClass:"i-width",attrs:{maxLength:64,placeholder:"请输入文件名"},on:{pressEnter:e.refresh},model:{value:e.search.search,callback:function(t){e.$set(e.search,"search",t)},expression:"search.search"}})],1),"已审批"===e.activeKey?a("span",{staticClass:"inner"},[a("a-select",{staticClass:"i-width",attrs:{placeholder:"请选择审批结果",getPopupContainer:function(e){return e.parentNode}},model:{value:e.search.approveResult,callback:function(t){e.$set(e.search,"approveResult",t)},expression:"search.approveResult"}},[a("a-select-option",{attrs:{value:"pass"}},[e._v("审批通过")]),a("a-select-option",{attrs:{value:"reject"}},[e._v("审批不通过")])],1)],1):e._e(),a("span",{staticClass:"outer"},[a("a-button",{staticClass:"button outer",attrs:{type:"primary"},on:{click:e.refresh}},[e._v("查询")]),a("a-button",{staticClass:"button oper-margin",attrs:{type:"primary"},on:{click:e.reset}},[e._v("重置")])],1)])]),a("div",{staticClass:"body"},[a("a-spin",{attrs:{spinning:e.spinning,tip:"正在加载，请稍等！"}},[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("div",[a("span",{staticStyle:{"margin-right":"10px"}},[a("span",{staticClass:"title"},[e._v("当前路径:")])]),a("span",{staticClass:"content"},[a("a",{staticStyle:{"text-decoration":"underline"},on:{click:e.choseRootPath}},[e._v("根路径")]),a("span",{staticStyle:{margin:"0 5px"}},[e._v("/")]),e._l(e.pathArr,(function(t){return a("span",{key:t.path+"-"+t.updateTime},[a("a",{staticStyle:{"text-decoration":"underline"},on:{click:function(a){return e.choseSubPath(t)}}},[e._v(e._s(t.name))]),a("span",{staticStyle:{margin:"0 5px"}},[e._v("/")])])}))],2)]),a("div",{staticClass:"buttons"},["已审批"!=e.activeKey&&"approver"==e.user.name?[a("a-button",{staticClass:"button outer",attrs:{type:"primary"},on:{click:e.batchDownload}},[e._v("批量下载")]),a("a-button",{staticClass:"button outer",attrs:{type:"primary"},on:{click:e.oneClickDownload}},[e._v("一键下载")]),a("a-button",{staticClass:"button outer",attrs:{type:"primary"},on:{click:e.handleOneClickApprove}},[e._v("一键审批")]),a("a-button",{staticClass:"button outer",attrs:{type:"primary",disabled:0===e.selectedRowKeys.length},on:{click:e.handleBatchApprove}},[e._v("批量审批")])]:e._e()],2)]),a("a-row",{staticClass:"table"},[a("a-table",{attrs:{columns:e.columns,dataSource:e.data,rowKey:"path",bordered:"",rowSelection:"未审批"===e.activeKey?e.rowSelection:null,pagination:{pageSize:20,size:"small",showTotal:function(e){return"总共"+e+"条"}}},scopedSlots:e._u([{key:"number",fn:function(t,a,s){return[e._v(e._s(s+1))]}},{key:"name",fn:function(t){return["目录"==t.type?a("span",[a("a",{staticStyle:{"text-decoration":"underline"},on:{click:function(a){return e.clickPath(t)}}},[e._v(e._s(t.name))])]):a("span",{attrs:{title:t.name}},[e._v(e._s(t.name))])]}},{key:"signLevel",fn:function(t){return["目录"==t.type?a("span"):a("span",{attrs:{title:t.signLevel}},[e._v(e._s(t.signLevel))])]}},{key:"operations",fn:function(t){return["approver"!=e.user.name?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red",on:{click:function(a){return e.deleteFile(t.path)}}},[e._v("删除")])]):e._e(),"approver"==e.user.name?a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper red",on:{click:function(a){return e.approvedFile(t)}}},[e._v("审批")])]):e._e(),"目录"!=t.type?[a("span",{staticClass:"oper-margin"},[a("span",{staticClass:"oper",on:{click:function(a){return e.downloadFile(t)}}},[e._v("下载")])])]:e._e()]}}])})],1)],1)],1)],1),a("a-modal",{attrs:{title:"选择审批结果",visible:e.approveModalVisible,"mask-closable":!1,keyboard:!1},on:{ok:e.handleApproveConfirm,cancel:e.handleApproveCancel}},[a("a-radio-group",{model:{value:e.approveResult,callback:function(t){e.approveResult=t},expression:"approveResult"}},[a("a-radio",{attrs:{value:"pass"}},[e._v("审批通过")]),a("a-radio",{attrs:{value:"reject"}},[e._v("审批不通过")])],1)],1)],1)},r=[],c=a("2909"),l=a("5530"),p=(a("a9e3"),a("4de4"),a("caad"),a("2532"),a("d81d"),a("5319"),a("fb6a"),a("e9c4"),a("ba79")),h=(a("a00a"),a("2f62")),u=[{title:"文件名(目录)",width:"40%",scopedSlots:{customRender:"name"}},{title:"创建时间",dataIndex:"updateTime",key:"updateTime"},{title:"标识密级",scopedSlots:{customRender:"signLevel"}},{title:"大小(B)",dataIndex:"size",key:"size"},{title:"操作",scopedSlots:{customRender:"operations"}}],d=[{title:"文件名(目录)",width:"50%",scopedSlots:{customRender:"name"}},{title:"创建时间",dataIndex:"updateTime",key:"updateTime"},{title:"审批时间",dataIndex:"approveTime",key:"approveTime"},{title:"标识密级",key:"signLevel",scopedSlots:{customRender:"signLevel"}},{title:"审批结果",dataIndex:"approveResult"}],v={props:{id:[String,Number],name:String,type:String},data:function(){return{spinning:!1,editable:!0,columns:u,data:[],path:"",search:{search:"",approveResult:void 0},activeKey:"未审批",pathArr:[],uploadUrl:"".concat(p["b"],"trans-file/upload"),selectedRowKeys:[],selectedRows:[],approveResult:"pass",approveModalVisible:!1,approveType:"",approveRecord:null}},created:function(){this.refresh()},watch:{activeKey:function(e){this.columns="未审批"===e?u:d,this.selectedRowKeys=[],this.selectedRows=[]}},computed:Object(l["a"])(Object(l["a"])({},Object(h["b"])("account",["user"])),{},{dataSource:function(){var e=this;return this.data.filter((function(t){return t.name.includes(e.search)}))},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange,onSelectAll:this.onSelectAll,getCheckboxProps:function(e){return{disabled:"目录"===e.type,name:e.name}}}}}),methods:{refresh:function(){var e=this;this.spinning=!0,Object(i["b"])("approval-file/detail/".concat(this.id,"?path=").concat(this.path,"&approvalState=").concat(this.activeKey,"&search=").concat(this.search.search,"&approveResult=").concat(this.search.approveResult),i["a"].GET).then((function(t){e.data=t||[]})).finally((function(){e.spinning=!1}))},reset:function(){this.search={search:"",approveResult:void 0},this.refresh()},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},onSelectAll:function(e,t,a){this.selectedRowKeys=e?this.data.map((function(e){return e.path})):[],this.selectedRows=e?Object(c["a"])(this.data):[]},clickPath:function(e){this.path=e.path.replace(/\\/g,"/"),this.search.search="",this.pathArr.push(e),this.refresh()},choseRootPath:function(){this.path="",this.search.search="",this.pathArr=[],this.refresh()},choseSubPath:function(e){this.path=e.path.replace(/\\/g,"/"),this.search.search="",this.pathArr=this.pathArr.slice(0,this.pathArr.indexOf(e)+1),this.refresh()},deleteFile:function(e){var t=this;this.$confirm({content:"确认删除吗？",okText:"确认",cancelText:"取消",onOk:function(){Object(i["b"])("/trans-file/delete",i["a"].POST,{id:t.id,type:t.type,path:e}).then((function(e){t.$message.success(e),t.refresh()}))}})},downloadFile:function(e){var t=e.path.replace(/\\/g,"/"),a="".concat(p["b"],"approval-file/single-download?id=").concat(this.id,"&path=").concat(t,"&type=").concat(e.type);window.open(a,"_blank")},oneClickDownload:function(){var e="".concat(p["b"],"approval-file/one-click-download?id=").concat(this.id);window.open(e,"_blank")},batchDownload:function(){if(0!==this.selectedRowKeys.length){var e=document.createElement("form");e.method="POST",e.action="".concat(p["b"],"approval-file/batch-download"),e.target="_blank";var t=document.createElement("input");t.type="hidden",t.name="fileInfoList",t.value=JSON.stringify(this.selectedRows),e.appendChild(t),document.body.appendChild(e),e.submit(),document.body.removeChild(e)}else this.$message.warning("请先选择要审批的文件")},handleBack:function(){this.$emit("back"),this.data=[],this.path="",this.search.search="",this.pathArr=[],this.editable=!0,this.spinning=!1},switchMenu:function(e){this.activeKey=e,this.search={search:"",approveResult:void 0},this.refresh()},handleOneClickApprove:function(){var e=this;this.$confirm({title:"一键审批",content:"确定要对当前服务下的所有未审批的文件进行一键审批吗？",okText:"确认",cancelText:"取消",onOk:function(){e.showApproveResultModal("oneClick")}})},handleBatchApprove:function(){var e=this;0!==this.selectedRowKeys.length?this.$confirm({title:"批量审批",content:"确定要对选中项进行批量审批吗？",okText:"确认",cancelText:"取消",onOk:function(){e.showApproveResultModal("batch")}}):this.$message.warning("请先选择要审批的文件")},showApproveResultModal:function(e){this.approveType=e,this.approveModalVisible=!0},handleApproveConfirm:function(){this.approveResult?(this.approveModalVisible=!1,"oneClick"===this.approveType?this.oneClickApprove():"batch"===this.approveType?this.batchApprove():"single"===this.approveType&&this.singleApprove()):this.$message.warning("请选择审批结果")},handleApproveCancel:function(){this.approveModalVisible=!1,this.approveResult="pass",this.approveType="",this.approveRecord=null},approvedFile:function(e){this.approveType="single",this.approveRecord=e,this.approveModalVisible=!0},singleApprove:function(){var e=this,t=this.approveRecord,a=t.name,s=t.type,n=t.path;Object(i["b"])("/approval-file/single-approve",i["a"].POST,{id:this.id,name:a,type:s,path:n,approveResult:this.approveResult}).then((function(t){e.$message.success("审批成功"),e.refresh()})).catch((function(t){e.$message.error("审批失败")})).finally((function(){e.approveResult="pass",e.approveType="",e.approveRecord=null}))},batchApprove:function(){var e=this,t=this.selectedRows.map((function(e){return{name:e.name,type:e.type,path:e.path}}));Object(i["c"])("/approval-file/batch-approve",i["a"].POST,{files:t,approveResult:this.approveResult,id:this.id}).then((function(t){e.$message.success("批量审批成功"),e.selectedRowKeys=[],e.selectedRows=[],e.refresh()})).catch((function(t){e.$message.error("批量审批失败")})).finally((function(){e.approveResult="pass",e.approveType="",e.approveRecord=null}))},oneClickApprove:function(){var e=this;Object(i["b"])("/approval-file/one-click-approve",i["a"].POST,{id:this.id,approveResult:this.approveResult}).then((function(t){e.$message.success("一键审批成功"),e.refresh()})).catch((function(t){e.$message.error("一键审批失败")})).finally((function(){e.approveResult="pass",e.approveType="",e.approveRecord=null}))}}},f=v,m=(a("48ed"),a("2877")),g=Object(m["a"])(f,o,r,!1,null,"37e9f61f",null),b=g.exports,y={components:{signLevelDetails:b},data:function(){return{spinning:!1,data:[],columns:[{title:"序号",scopedSlots:{customRender:"number"},width:200},{title:"服务名称",dataIndex:"name",key:"name"},{title:"服务用户",dataIndex:"userName",key:"userName"},{title:"审批状态",dataIndex:"approvalState",key:"approvalState"},{title:"创建时间",dataIndex:"gmtCreateName",key:"gmtCreateName"},{title:"操作",scopedSlots:{customRender:"operations"}}],search:{name:void 0,userName:void 0,approvalState:void 0},userList:[],currentDetail:null,page:1,pageSize:10,total:0}},created:function(){var e=this;this.refresh(),Object(i["b"])("system/select-options/clientUser",i["a"].GET).then((function(t){e.userList=t||[]}))},watch:{$route:function(){this.currentDetail=null,this.search={name:void 0,location:"sender"},this.page=1,this.pageSize=10,this.total=0,this.data=[],this.spinning=!1,this.refresh()}},methods:{refresh:function(){var e=this;this.spinning=!0,Object(i["b"])("approval-file/list?offset=".concat((this.page-1)*this.pageSize,"&limit=").concat(this.pageSize,"\n      &search=").concat(this.search.name||"","&userName=").concat(this.search.userName||"","&approvalState=").concat(this.search.approvalState||""),i["a"].GET).then((function(t){e.data=t.rows||[{}],e.total=t.total||0})).finally((function(){e.spinning=!1}))},reset:function(){this.search={name:void 0,userName:void 0,approvalState:void 0},this.refresh()},handlePageChange:function(e){this.page=e,this.refresh()},handlePageSizeChange:function(e,t){this.pageSize=t,this.page=1,this.refresh()},showDetailPage:function(e){this.currentDetail={id:e.transBusiFileId,name:e.name,type:e.type,labelEnable:e.labelEnable}},handleBack:function(){this.currentDetail=null}}},k=y,C=(a("4f93"),Object(m["a"])(k,s,n,!1,null,"88762982",null));t["default"]=C.exports},"48ed":function(e,t,a){"use strict";a("e788")},"4f93":function(e,t,a){"use strict";a("6b69")},"6b69":function(e,t,a){},e788:function(e,t,a){}}]);